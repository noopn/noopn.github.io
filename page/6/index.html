<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="å‰ç«¯ web react" />
       
      <meta name="description" content="å‰ç«¯æŠ€æœ¯ä¸ç”Ÿæ´»ã€‚" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> å››æœˆå…«æ—¥</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">
 
<link rel="stylesheet" href="/css/fonts/remixicon.css">
 
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="/js/pace.min.js"></script>
       
 

      <link rel="stylesheet" href="/css/bulma.min.css" />
      <script src="/js/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <script src="https://cdn.staticfile.org/mermaid/8.14.0/mermaid.min.js"></script>
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <!-- hexo injector head_end start -->
<link rel="stylesheet" href="/css/katex.min.css">

<link rel="stylesheet" href="/css/style.css">
<!-- hexo injector head_end end --></head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">å››æœˆå…«æ—¥</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['æ„¿ä½ è¶³å¤Ÿå¼ºå¤§ï¼Œä¹Ÿè¦è¶³å¤Ÿæ¸©æŸ”', 'æœ€è½»çš„å¹¶ä¸æ˜¯ä¸€æ ¹ç¾½æ¯›ï¼Œè€Œæ˜¯ä¸€åŒé£é¸Ÿçš„ç¿…è†€', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="posts-pattern/â‘£å·¥å‚æ¨¡å¼"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/7634c4874d92/"
    >â‘£éšè—newæ“ä½œç¬¦-å·¥å‚æ¨¡å¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/7634c4874d92/" class="article-date">
  <time datetime="2023-01-04T01:36:43.000Z" itemprop="datePublished">2023-01-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="new-æœ‰ä»€ä¹ˆä¸å¯¹"><a href="#new-æœ‰ä»€ä¹ˆä¸å¯¹" class="headerlink" title="new æœ‰ä»€ä¹ˆä¸å¯¹"></a>new æœ‰ä»€ä¹ˆä¸å¯¹</h4><p><strong>å®ä¾‹åŒ–å¯¹è±¡çš„è¿‡ç¨‹ä¸åº”è¯¥æ€»æ˜¯å…¬å¼€çš„è¿›è¡Œï¼Œè¿™é‡Œé¢ä¼šæœ‰ä¸€äº›è€¦åˆçš„é—®é¢˜ã€‚</strong></p>
<p>å¯¹ new æœ¬èº«æ¥è®²å¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¯¹ï¼Œéœ€è¦é€šè¿‡ new æ“ä½œç¬¦å®ä¾‹åŒ–å¯¹è±¡ã€‚ä½†æ˜¯å¯¹äºè®¾è®¡æ¨¡å¼æ¥è®²ï¼Œnew æ“ä½œç¬¦è®©æˆ‘ä»¬é’ˆå¯¹ä¸šåŠ¡ç¼–å†™ä»£ç ï¼Œåˆå§‹åŒ–çš„é€»è¾‘å¯èƒ½åœ¨ä¸€æ®µæ¡ä»¶è¯­å¥ä¸­ï¼Œå¦‚æœæ·»åŠ äº†æ–°çš„ç±»ï¼Œå¿…é¡»ä¿®æ”¹åŸæ¥çš„ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä»£ç æ²¡æœ‰å¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<p>å½“æœ‰ä¸€äº›ç›¸å…³ç±»å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå†™å‡ºä¸‹é¢çš„ä»£ç ï¼Œæ¯å½“åŠ å…¥æ–°çš„ç±»è¿™æ®µä»£ç å°±ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±è¿åå¯¹ä¿®æ”¹å…³é—­çš„è®¾è®¡åŸåˆ™ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (picnic) &#123;duck = <span class="keyword">new</span> <span class="title class_">MallardDuck</span>();&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (hunting) (duck = <span class="keyword">new</span> <span class="title class_">DecoyDuck</span>();)</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (inBathTub) &#123;duck = <span class="keyword">new</span> <span class="title class_">RubberDuck</span>()&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h4><p>ä¸€ä¸ªæœ€ç®€å•çš„å·¥å‚å°±æ˜¯æŠŠå®ä¾‹åŒ–å¯¹è±¡çš„è¿‡ç¨‹æå–å‡ºæ¥ï¼Œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­ï¼Œå¹¶æš´éœ²æ–¹æ³•ï¼Œå…è®¸ç¬¬ä¸‰æ–¹ç±»é€šè¿‡è¿™ä¸ªæ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FruitFactory</span> &#123;</span><br><span class="line">  <span class="comment">// æŠ½è±¡å·¥å‚ç±»çš„å…¬ç”¨æ–¹æ³•</span></span><br><span class="line">  <span class="title function_">common</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// éœ€è¦å­ç±»é‡æ–°å®ç°</span></span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">createTea</span>(<span class="attr">type</span>: <span class="built_in">string</span>): <span class="title class_">AppleTea</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Type1AppleTea</span> <span class="keyword">implements</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è‹¹æœèŒ¶ç±»å‹1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Type2AppleTea</span> <span class="keyword">implements</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è‹¹æœèŒ¶ç±»å‹2&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apple</span> <span class="keyword">extends</span> <span class="title class_ inherited__">FruitFactory</span> &#123;</span><br><span class="line">  <span class="title function_">taste</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è‹¹æœå¾ˆç”œ&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">createTea</span>(<span class="attr">type</span>: <span class="built_in">string</span>): <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span> == <span class="string">&quot;appleTeaType1&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type1AppleTea</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">type</span> == <span class="string">&quot;appleTeaType1&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type2AppleTea</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type1AppleTea</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FruitStore</span> &#123;</span><br><span class="line">  <span class="attr">factory</span>: <span class="title class_">FruitFactory</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">factory</span>: <span class="title class_">FruitFactory</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">factory</span> = factory;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">makeFruitTea</span>(<span class="params"><span class="attr">type</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">factory</span>.<span class="title function_">createTea</span>(<span class="string">&quot;type1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">orderTea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tea = <span class="variable language_">this</span>.<span class="title function_">makeFruitTea</span>(<span class="string">&quot;type1&quot;</span>);</span><br><span class="line">    tea.<span class="title function_">name</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  å…¬ç”¨çš„èŒ¶çš„åˆ¶ä½œæ–¹æ³•</span></span><br><span class="line">  <span class="comment">//  ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">FruitStore</span>(<span class="keyword">new</span> <span class="title class_">Apple</span>());</span><br><span class="line">store.<span class="title function_">orderTea</span>();</span><br></pre></td></tr></table></figure>

<p><strong>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªçš„ï¼Œå·¥å‚æ–¹æ³•è®©ç±»æŠŠå®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚</strong></p>
<p>ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å·¥å‚æ˜¯å¤–éƒ¨ä¼ å…¥ï¼Œå¯ä»¥åˆ›å»ºä¸åŒç±»å‹çš„èŒ¶ï¼Œä½†æ˜¯èŒ¶çš„åˆ¶ä½œè¡Œä¸ºæ›´åƒæ˜¯ Store çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥åšä¸€ç‚¹æ”¹å˜ã€‚</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ª Store çš„æŠ½è±¡ç±»ï¼Œæ‰€æœ‰çš„ Store éƒ½è¦å®ç°è¿™ä¸ªæŠ½è±¡ç±»ã€‚</li>
<li>åœ¨ Store æŠ½è±¡ç±»ä¸­å®šä¹‰ createTea çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å†…å®¹å°±æ˜¯ä¹‹å‰å¤–éƒ¨ä¼ å…¥çš„å·¥å‚ã€‚</li>
<li>æ¢å¥è¯è¯´ï¼Œ å·¥å‚æ–¹æ³•è½¬ç§»åˆ°å­ç±»ä¸­å®ç°</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Type1AppleTea</span> <span class="keyword">implements</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è‹¹æœèŒ¶ç±»å‹1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Type2AppleTea</span> <span class="keyword">implements</span> <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è‹¹æœèŒ¶ç±»å‹2&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FruitStore</span> &#123;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">createTea</span>(<span class="attr">type</span>: <span class="built_in">string</span>): <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppleFruitStore</span> <span class="keyword">extends</span> <span class="title class_ inherited__">FruitStore</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">createTea</span>(<span class="attr">type</span>: <span class="built_in">string</span>): <span class="title class_">AppleTea</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span> == <span class="string">&quot;type1&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type1AppleTea</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">type</span> == <span class="string">&quot;type2&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type2AppleTea</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type1AppleTea</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">orderTea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> tea = <span class="variable language_">this</span>.<span class="title function_">createTea</span>(<span class="string">&quot;type1&quot;</span>);</span><br><span class="line">    tea.<span class="title function_">name</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">AppleFruitStore</span>();</span><br><span class="line">store.<span class="title function_">orderTea</span>();</span><br></pre></td></tr></table></figure>

<p><strong>æ‰€æœ‰çš„å·¥å‚æ¨¡å¼éƒ½æ˜¯ç”¨æ¥å°è£…å¯¹è±¡åˆ›å»ºçš„ã€‚</strong>ï¼Œ <strong>åˆ›å»ºè€…ç±»</strong> éœ€è¦æœ‰ä¸€ä¸ªæŠ½è±¡åˆ›å»ºè€…ç±»ï¼Œå®šä¹‰äº†ä¸€ä¸ª<strong>æŠ½è±¡å·¥å‚æ–¹æ³•</strong>ï¼Œæ‰€æœ‰å®ç°äº†æŠ½è±¡åˆ›å»ºè€…ç±»çš„å­ç±»ï¼Œéƒ½å¯ä»¥ç”¨è‡ªå·±å®ç°çš„å·¥å‚æ–¹æ³•ç”Ÿäº§äº§å“ã€‚<strong>äº§å“ç±»</strong> æ˜¯åœ¨åˆ›å»ºè€…å®ä¾‹çš„å·¥å‚æ–¹æ³•ä¸­åˆ›å»ºå‡ºæ¥çš„ã€‚</p>
<h4 id="ä¾èµ–å€’ç½®ä¸æŠ½è±¡å·¥å‚"><a href="#ä¾èµ–å€’ç½®ä¸æŠ½è±¡å·¥å‚" class="headerlink" title="ä¾èµ–å€’ç½®ä¸æŠ½è±¡å·¥å‚"></a>ä¾èµ–å€’ç½®ä¸æŠ½è±¡å·¥å‚</h4><p><strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼šè¦ä¾èµ–æŠ½è±¡ï¼Œä¸è¦ä¾èµ–å…·ä½“ç±»</strong>ï¼Œè¿™å¥è¯å¾ˆåƒæ˜¯è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚æ²¡é”™ï¼Œä½†æ˜¯è¿™å¥è¯æ›´å¼ºè°ƒï¼Œé«˜å±‚çš„ç»„ä»¶ä¸åº”è¯¥ä¾èµ–ä½å±‚çš„ç»„ä»¶ï¼Œè€Œæ˜¯åº”è¯¥ä¸¤è€…éƒ½ä¾èµ–äº <strong>æŠ½è±¡</strong>ã€‚æŠ½è±¡å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ã€‚</p>
<p><strong>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šå…·ä½“ç±»</strong>ã€‚</p>
<h4 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h4><ul>
<li>å½“åªæœ‰ä¸€ä¸ªåˆ›å»ºè€…ç±»çš„æ—¶å€™æ˜¯å¦åº”è¯¥ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå·¥å‚æ¨¡å¼è®©ä½ ä¾¿äºæ‰©å±•ï¼Œå¹¶å°†äº§å“ç±»çš„åˆ›å»ºä¸ä½¿ç”¨è§£è€¦ã€‚</li>
<li>æ‰€æœ‰çš„å·¥å‚éƒ½æ˜¯ç”¨æ¥å°è£…å¯¹è±¡çš„åˆ›å»º</li>
<li>ç®€å•å·¥å‚ï¼Œè™½ç„¶ä¸æ˜¯çœŸæ­£çš„è®¾è®¡æ¨¡å¼ï¼Œä½†ä»ä¸å¤±ä¸ºä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥å°†å®¢æˆ·ç¨‹åºä»å…·ä½“ç±»è§£è€¦ã€‚</li>
<li>å·¥å‚æ–¹æ³•ä½¿ç”¨ç»§æ‰¿:æŠŠå¯¹è±¡çš„åˆ›å»ºå§”æ‰˜ç»™å­ç±»ï¼Œå­ç±»å®ç°å·¥å‚æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚</li>
<li>æŠ½è±¡å·¥å‚ä½¿ç”¨å¯¹è±¡ç»„åˆ:å¯¹è±¡çš„åˆ›å»ºè¢«å®ç°åœ¨å·¥å‚æ¥å£æ‰€æš´éœ²å‡ºæ¥çš„æ–¹æ³•ä¸­</li>
<li>æ‰€æœ‰å·¥å‚æ¨¡å¼éƒ½é€šè¿‡å‡å°‘åº”ç”¨ç¨‹åºå’Œå…·ä½“ç±»ä¹‹é—´çš„ä¾èµ–ä¿ƒè¿›æ¾è€¦åˆã€‚</li>
<li>å·¥å‚æ–¹æ³•å…è®¸ç±»å°†å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚</li>
<li>æŠ½è±¡å·¥å‚åˆ›å»ºç›¸å…³çš„å¯¹è±¡å®¶æ—ï¼Œè€Œä¸éœ€è¦ä¾èµ–å®ƒä»¬çš„å…·ä½“ç±»ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™ï¼ŒæŒ‡å¯¼æˆ‘ä»¬é¿å…ä¾èµ–å…·ä½“ç±»å‹ï¼Œè€Œè¦å°½é‡ä¾èµ–æŠ½è±¡ã€‚</li>
<li>å·¥å‚æ˜¯å¾ˆæœ‰å¨åŠ›çš„æŠ€å·§ï¼Œå¸®åŠ©æˆ‘ä»¬é’ˆå¯¹æŠ½è±¡ç¼–ç¨‹ï¼Œè€Œä¸è¦é’ˆå¯¹å…·ä½“ç±»ç¼–ç¨‹ã€‚</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-pattern/â‘¡è§‚å¯Ÿè€…æ¨¡å¼"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/7a81d263951b/"
    >â‘¡å‘å¸ƒ+è®¢é˜…=è§‚å¯Ÿè€…æ¨¡å¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/7a81d263951b/" class="article-date">
  <time datetime="2022-12-27T04:49:16.000Z" itemprop="datePublished">2022-12-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="åƒå¹¿æ’­ä¸€æ ·å‘æ¶ˆæ¯"><a href="#åƒå¹¿æ’­ä¸€æ ·å‘æ¶ˆæ¯" class="headerlink" title="åƒå¹¿æ’­ä¸€æ ·å‘æ¶ˆæ¯"></a>åƒå¹¿æ’­ä¸€æ ·å‘æ¶ˆæ¯</h4><p>æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œå¦ä¸€ä¸ªäºº<strong>A</strong>,ä¸çŸ¥é“ä½ è¿™ä¸ªäººçš„å­˜åœ¨ï¼Œä½†æ˜¯å´å¯ä»¥ç»™ä½ å‘æ¶ˆæ¯ã€‚A å°±åƒæ˜¯ä¸€ä¸ªå¹¿æ’­ç«™ä¸€æ ·ï¼Œå°†ä½ ä»¬è”ç³»åœ¨ä¸€èµ·çš„å°±æ˜¯æ‰‹ä¸­çš„æ”¶éŸ³æœºï¼Œä½ ç­‰å¾…ç€ A å‘å¸ƒæ¶ˆæ¯ï¼Œè€Œä½ ç­‰å¾…æ¶ˆæ¯å°±æ˜¯ä¸€ä¸ªè®¢é˜…çš„è¡Œä¸ºã€‚</p>
<p>æˆ–è€…æ¢ä¸€ç§è¯´æ³•ï¼Œä½ å°±åƒæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ä¸€æ ·ï¼Œè§‚å¯Ÿæ¶ˆæ¯æœ‰æ²¡æœ‰åˆ°æ¥ã€‚æ— è®ºå“ªç§å®šä¹‰æ— ééƒ½æ˜¯åœ¨æè¿°ä¸€ç§å…³ç³»ï¼Œæ¥å—æ¶ˆæ¯è€…å’Œå‘é€æ¶ˆæ¯è€…ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p>ä¸‹é¢è¦å®ç°ä¸€ä¸ªæ–°é—»å¹¿æ’­ç«™ï¼Œæ¯å½“æœ‰æ–°çš„æ–°é—»ï¼Œä¼šè°ƒç”¨æ–°é—»å¯¹è±¡çš„<code>broadcastNews</code>,å¹¶å‘è§‚å¯Ÿè€…ä»¬æ¨é€æ¶ˆæ¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸ä¸å¥½çš„å†™æ³•ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">update</span>(<span class="attr">message</span>?: &#123; <span class="attr">news</span>: <span class="built_in">string</span>[] &#125;): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsObserver</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">update</span>(message): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> new1 = <span class="keyword">new</span> <span class="title class_">NewsObserver</span>();</span><br><span class="line"><span class="keyword">const</span> new2 = <span class="keyword">new</span> <span class="title class_">NewsObserver</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Subscribe</span> &#123;</span><br><span class="line">  <span class="title function_">register</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">unregister</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">getWeather</span>(<span class="attr">city</span>: <span class="built_in">string</span>): <span class="title class_">NewsInfo</span>;</span><br><span class="line">  <span class="title function_">notify</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsSubscribe</span> &#123;</span><br><span class="line">  <span class="title function_">getNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è·å–åˆ°æ–°é—»&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">broadcastNews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> news = <span class="variable language_">this</span>.<span class="title function_">getNews</span>();</span><br><span class="line">    new1.<span class="title function_">update</span>(news);</span><br><span class="line">    new2.<span class="title function_">update</span>(news);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newsSubscribe = <span class="keyword">new</span> <span class="title class_">NewsSubscribe</span>();</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å†™æ³•å­˜åœ¨ç€å¾ˆå¤šä¸¥é‡çš„é—®é¢˜ï¼š</p>
<ul>
<li>è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…ç´§è€¦åˆåœ¨äº†ä¸€èµ·</li>
<li>æ²¡åŠæ³•åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™åŠ¨æ€æ·»åŠ æˆ–åˆ é™¤è§‚å¯Ÿè€…</li>
<li>è§‚å¯Ÿè€…æ˜¯ä¼šåŠ¨æ€å˜åŒ–çš„å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰ç‹¬ç«‹ä¸”å°è£…</li>
</ul>
<h4 id="è®¾è®¡è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è®¾è®¡è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è®¾è®¡è§‚å¯Ÿè€…æ¨¡å¼"></a>è®¾è®¡è§‚å¯Ÿè€…æ¨¡å¼</h4><p>é¦–å…ˆæˆ‘ä»¬è®©è¢«è§‚å¯Ÿè€…æœ‰æ³¨å†Œè§‚å¯Ÿè€…å’Œå–æ¶ˆæ³¨å†Œè§‚å¯Ÿè€…çš„èƒ½åŠ›ã€‚è¿™æ ·èƒ½è®©è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…è§£è€¦ï¼Œå¹¶åœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™åŠ¨æ€çš„æ·»åŠ æˆ–åˆ é™¤ã€‚</p>
<p><strong>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–è€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewsSubscribe</span> <span class="keyword">implements</span> <span class="title class_">Subscribe</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">observerList</span>: <span class="title class_">Observer</span>[];</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">register</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unregister</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">indexOf</span>(observer);</span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">notify</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¢«è§‚å¯Ÿè€…ä¸çŸ¥é“è§‚å¯Ÿè€…çš„ç»†èŠ‚ï¼ŒåªçŸ¥é“è§‚å¯Ÿè€…å®ç°äº†è§‚å¯Ÿè€…æ¥å£ã€‚</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">NewsInfo</span> &#123;</span><br><span class="line">  <span class="attr">news</span>: <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">update</span>(<span class="attr">subscribe</span>: <span class="title class_">NewsSubscribe</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsObserver</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">update</span>(<span class="attr">subscribe</span>: <span class="title class_">NewsSubscribe</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(subscribe.<span class="title function_">getNews</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> new1 = <span class="keyword">new</span> <span class="title class_">NewsObserver</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Subscribe</span> &#123;</span><br><span class="line">  <span class="title function_">register</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">unregister</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="title function_">getNews</span>(<span class="attr">city</span>: <span class="built_in">string</span>): <span class="title class_">NewsInfo</span>;</span><br><span class="line">  <span class="title function_">notify</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsSubscribe</span> <span class="keyword">implements</span> <span class="title class_">Subscribe</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">observerList</span>: <span class="title class_">Observer</span>[];</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">register</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">unregister</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">indexOf</span>(observer);</span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">notify</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">observerList</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">update</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getNews</span>(): <span class="title class_">NewsInfo</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">news</span>: [<span class="string">&quot;æ–°é—»&quot;</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newsSubscribe = <span class="keyword">new</span> <span class="title class_">NewsSubscribe</span>();</span><br><span class="line">newsSubscribe.<span class="title function_">register</span>(<span class="keyword">new</span> <span class="title class_">NewsObserver</span>());</span><br><span class="line">newsSubscribe.<span class="title function_">register</span>(<span class="keyword">new</span> <span class="title class_">NewsObserver</span>());</span><br><span class="line"></span><br><span class="line">newsSubscribe.<span class="title function_">notify</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯ä»¥ä¸ºè§‚å¯Ÿè€…æ¨¡å¼è®¾ç½® <code>setChanged</code>  <code>hasChanged</code> æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¯ä»¥æ§åˆ¶é€šçŸ¥çš„æ¡ä»¶ï¼Œé¿å…é€šçŸ¥çš„é¢‘ç‡è¿‡é«˜</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†å¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ä¸»é¢˜ (ä¹Ÿå°±æ˜¯å¯è§‚å¯Ÿè€…) ç”¨å…±åŒçš„æ¥å£æ¥æ›´æ–°è§‚å¯Ÿè€…</li>
<li>è§‚å¯Ÿè€…å’Œå¯è§‚å¯Ÿè€…ä¹‹é—´ç”¨æ¾è€¦åˆæ–¹å¼ç»“åˆ (loosecoupling)ï¼Œå¯è§‚å¯Ÿè€…ä¸çŸ¥é“è§‚å¯Ÿè€…çš„ç»†èŠ‚ï¼ŒåªçŸ¥é“è§‚å¯Ÿè€…å®ç°äº†è§‚å¯Ÿè€…æ¥å£ã€‚<br>æœ‰å¼¹</li>
<li>ä½¿ç”¨æ­¤æ¨¡å¼æ—¶ï¼Œä½ å¯ä»è¢«è§‚å¯Ÿè€…å¤„æ¨ (push)æˆ–æ‹‰ (pul1)æ•°æ®(ç„¶è€Œï¼Œæ¨çš„æ–¹å¼è¢«è®¤ä¸ºæ›´â€œæ­£ç¡®â€)ã€‚</li>
<li>æœ‰å¤šä¸ªè§‚å¯Ÿè€…æ—¶ï¼Œä¸å¯ä»¥ä¾èµ–ç‰¹å®šçš„é€šçŸ¥æ¬¡åº</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-pattern/â‘ ç­–ç•¥æ¨¡å¼"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/179e99c7ede5/"
    >â‘ ä»ç»§æ‰¿ä¸­è§£è„±-ç­–ç•¥æ¨¡å¼</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/179e99c7ede5/" class="article-date">
  <time datetime="2022-12-27T04:49:16.000Z" itemprop="datePublished">2022-12-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="ç»§æ‰¿çœŸçš„åˆç†ä¹ˆ"><a href="#ç»§æ‰¿çœŸçš„åˆç†ä¹ˆ" class="headerlink" title="ç»§æ‰¿çœŸçš„åˆç†ä¹ˆ"></a>ç»§æ‰¿çœŸçš„åˆç†ä¹ˆ</h4><p>æƒ³è±¡ä¸€ä¸‹æœ‰ä¸€ä¸ªæ±½è½¦ç±»ï¼Œä½ ç”¨å®ƒåˆ›é€ äº†å¾ˆå¤šæ±½è½¦ï¼Œä»–ä»¬éƒ½è·‘åœ¨è™šæ‹Ÿæ¸¸æˆä¸–ç•Œé‡Œé¢ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CarSuper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¿«å¿«è·‘&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">blow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ»´æ»´å«&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> benz = <span class="keyword">new</span> <span class="title class_">CarSuper</span>();</span><br><span class="line"><span class="keyword">const</span> bmw = <span class="keyword">new</span> <span class="title class_">CarSuper</span>();</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ±½è½¦éƒ½æ˜¯ <code>å¿«å¿«è·‘</code> ï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±çš„æé™é€Ÿåº¦ï¼Œæ‰€ä»¥ä½ å¾ˆå®¹æ˜“æƒ³åˆ°åº”è¯¥æœ‰ä¸€ä¸ªå­ç±»ï¼Œè®©å­ç±»å»å®ç°ç‰¹æœ‰æ–¹æ³•ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span> <span class="keyword">extends</span> <span class="title class_ inherited__">CarSuper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é£é€Ÿè·‘&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> benz = <span class="keyword">new</span> <span class="title class_">Benz</span>();</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½ å·²ç»åœ¨ç»§æ‰¿ä¸­ä½“ä¼šåˆ°äº†å¥½å¤„ï¼Œçªç„¶æœ‰ä¸€å¤©ï¼Œä½ è§‰å¾—åˆ›é€ å‡ºæ¥çš„æ±½è½¦åº”è¯¥å¯ä»¥è½½äººï¼Œè¿™æ­£æ˜¯ä½ æ“…é•¿çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸å‡æ€ç´¢çš„åœ¨ <code>CarSuper</code>ç±»ä¸Šæ·»åŠ äº† <code>carrying</code> å…¬ç”¨æ–¹æ³•,å¹¶å¼€å¿ƒçš„ç¡è§‰å»äº†ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CarSuper</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¿«å¿«è·‘&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">blow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ»´æ»´å«&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">carrying</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒå¤©èµ·æ¥ï¼Œä½ ä¸æ•¢ç›¸ä¿¡è‡ªå·±çš„çœ¼ç›ï¼Œä¸€ä½ä¹˜å®¢ä¸Šäº†ä¸€è¾†ç©å…·è½¦ï¼Œæ‰€ä»¥ä½ èµ¶ç´§å…³åœäº†æ¸¸æˆæœåŠ¡ã€‚å¹¶ç´§æ€¥çš„æ€è€ƒå¯¹ç­–ï¼Œæ˜¾ç„¶è½½äººçš„è¡Œä¸ºå¹¶ä¸é€šç”¨ï¼Œæ¯ä¸€ä¸ªä¸èƒ½è½½äººçš„è½¦ï¼Œéƒ½éœ€è¦é‡å†™è½½äººçš„æ–¹æ³•ï¼Œä¾‹å¦‚ç©å…·è½¦ã€‚</p>
<p>å…¶å®ä½ è¿˜æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œæ—¢ç„¶è½½äººçš„æ–¹æ³•ä¸é€šç”¨ï¼Œä¸å¦‚æŠŠç±»ä¼¼è½½äººè¿™æ ·çš„åŠŸèƒ½çœ‹ä½œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¯ä¸€ä¸ªå­ç±»éƒ½éœ€è¦å®ç°è¿™ä¸ªæ¥å£</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Carrying</span> &#123;</span><br><span class="line">  <span class="attr">carrying</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span> <span class="keyword">extends</span> <span class="title class_ inherited__">CarSuper</span> <span class="keyword">implements</span> <span class="title class_">Carrying</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é£é€Ÿè·‘&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">carrying</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ‹‰å•†äºº&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½åŠæ³•ï¼Œ<strong>æ¥å£ä¸å…·æœ‰å®ç°ä»£ç </strong>ï¼Œè™½ç„¶å­ç±»è‡ªå·±å®ç°å¢åŠ äº†çµæ´»æ€§ï¼Œä½†å´ä½¿å­ç±»æ˜¾çš„éå¸¸å†—ä½™ï¼Œæ¯ä¸€ä¸ªå­ç±»åé¢éƒ½è·Ÿç€ä¸€ä¸²å„ä¸ç›¸åŒä¸”éœ€è¦ç‹¬ç«‹å®ç°çš„æ¥å£ã€‚</p>
<blockquote>
<p>ä¸ºäº†å¤ç”¨è€Œæ˜¯ç”¨ç»§æ‰¿å¯èƒ½æ˜¯å¯¼è‡´éš¾ä»¥ç»´æŠ¤<br>æ¯”å¦‚ä¸Šé¢çš„ç©å…·è½¦å¯ä»¥è½½äººï¼Œæ˜¯å› ä¸ºæ²¡æœ‰é‡å†™å­ç±»è½½äººçš„æ–¹æ³•ã€‚</p>
</blockquote>
<h4 id="æ‰¾åˆ°å˜åŒ–ä¹‹å¤„"><a href="#æ‰¾åˆ°å˜åŒ–ä¹‹å¤„" class="headerlink" title="æ‰¾åˆ°å˜åŒ–ä¹‹å¤„"></a>æ‰¾åˆ°å˜åŒ–ä¹‹å¤„</h4><p>ç±»çš„è¡Œä¸ºåœ¨ä¸æ–­æ”¹å˜ï¼Œæ‰€ä»¥ä¸€æ—¦æŠŠè¿™ä¸ªè¡Œä¸ºå˜æˆç±»çš„ä¸€éƒ¨åˆ†ï¼Œå°±éœ€è¦å¤§é‡çš„ç»å†å»è·Ÿè¸ªè¿™äº›è¡Œä¸ºä¼šåœ¨é‚£é‡Œé€ æˆå½±å“ï¼Œæœ‰ä¸€ä¸ªåŸåˆ™èƒ½å¸®åŠ©æˆ‘ä»¬ <strong>â¤â€ğŸ”¥ æŠŠå˜åŒ–çš„å†…å®¹ç‹¬ç«‹å‡ºæ¥ï¼Œä¸è¦å’Œç¨³å®šçš„ä»£ç æ··åœ¨ä¸€èµ·</strong></p>
<p>ç°åœ¨å°±å¯ä»¥ç€æ‰‹äºå°†è½½äººçš„è¡Œä¸ºåˆ†ç¦»å‡ºæ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡Œä¸ºåº”è¯¥ä»¥å“ªç§å½¢å¼å­˜åœ¨å‘¢ï¼Œæ–¹æ³•ï¼Œç±»ï¼Œè¿˜æ˜¯å¯¹è±¡ï¼Ÿ å…¶å®ä¸€è°ˆåˆ°è®¾è®¡æ¨¡å¼ç»•ä¸å¼€çš„å°±æ˜¯ OO(é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼)ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨ OO çš„æ€æƒ³ï¼Œä½¿ç”¨ç±»æ¥å®ç°è¿™ä¸ªè¡Œä¸ºã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">CarryingBehavior</span> &#123;</span><br><span class="line">  <span class="attr">carrying</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BusinessCarrying</span> <span class="keyword">implements</span> <span class="title class_">CarryingBehavior</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">carrying</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è½½å•†äºº&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToyCarrying</span> <span class="keyword">implements</span> <span class="title class_">CarryingBehavior</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">carrying</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è½½ç©å…·&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarSuper</span> &#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="attr">carryingBehavior</span>: <span class="title class_">CarryingBehavior</span>;</span><br><span class="line">  <span class="comment">// æä¾›åˆå§‹åŒ–æ—¶çš„å‚æ•°ï¼Œä»¥æä¾›é»˜è®¤çš„è¡Œä¸º</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">&#123; carryingBehavior &#125;: &#123; carryingBehavior: CarryingBehavior &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">carryingBehavior</span> = carryingBehavior;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">blow</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">carrying</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">carryingBehavior</span>.<span class="title function_">carrying</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¢åŠ setæ–¹æ³•æ˜¯ä¸ºäº†å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜å¯¹è±¡çš„è¡Œä¸º</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">setCarryingBehavior</span>(<span class="params"><span class="attr">behavior</span>: <span class="title class_">CarryingBehavior</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">carryingBehavior</span> = behavior;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span> <span class="keyword">extends</span> <span class="title class_ inherited__">CarSuper</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(&#123;</span><br><span class="line">      <span class="attr">carryingBehavior</span>: <span class="keyword">new</span> <span class="title class_">BusinessCarrying</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;é£é€Ÿè·‘&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> benz = <span class="keyword">new</span> <span class="title class_">Benz</span>();</span><br><span class="line">benz.<span class="title function_">carrying</span>();</span><br><span class="line">benz.<span class="title function_">setCarryingBehavior</span>(<span class="keyword">new</span> <span class="title class_">ToyCarrying</span>());</span><br><span class="line">benz.<span class="title function_">carrying</span>();</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†æ±½è½¦çš„è¡Œä¸ºæŠ½è±¡ä¸º <code>BusinessCarrying</code> ç±»ï¼ŒæŠ½è±¡ä¸ºç±»å’ŒæŠ½è±¡ä¸ºæ¥å£çš„åŒºåˆ«å°±æ˜¯<strong>åˆ†ç¦»äº†å®ç°</strong>ã€‚</p>
<p>è€Œ <code>BusinessCarrying</code> ç±»æœ‰è‡ªå·±çš„è¡Œä¸ºç±»æ¥å£ï¼Œå¯å°±ä¿è¯äº†è¡Œä¸ºç±»çš„çµæ´»æ€§ï¼Œä¸ºç›¸åŒçš„è¡Œä¸ºå®ç°ä¸åŒçš„æ•ˆæœï¼Œä¾‹å¦‚æ±½è½¦è½½äººååœ¨å‰æ’è¿˜æ˜¯åæ’ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æ”¹é€ ï¼Œåªéœ€è¦è®©æ±½è½¦ç±»æä¾›ä¸€ä¸ªèƒ½è®¾ç½®è¡Œä¸ºçš„æ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°è¡Œä¸ºçš„åŠ¨æ€åŒ–ï¼Œè¿™ä¹Ÿæ˜¯å¦ä¸€ä¸ªè®¾è®¡åŸåˆ™ <strong>â¤â€ğŸ”¥ é’ˆå¯¹æ¥å£ï¼Œè€Œä¸æ˜¯å®ç°ç¼–ç¨‹</strong>ã€‚</p>
<blockquote>
<p>è¿™æ ·çš„è¯å’Œç§æœ‰æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ è¡Œä¸ºæ˜¯å¯æŠ½è±¡çš„ï¼Œæ˜¯å¯ä»¥è¢«ç©·ä¸¾çš„ï¼Œä»–ä¼šåŠ¨æ€çš„æ•£å¸ƒåœ¨å„ç§å„æ ·çš„æ±½è½¦å­ç±»ä¸­ã€‚è€Œç§æœ‰æ–¹æ³•æ˜¯æ— æ³•è¢«ç©·ä¸¾çš„ï¼Œä¸€æ—¦å®šä¹‰ä¸€ä¸ªæ–°çš„å­ç±»ï¼Œé‚£ä¹ˆä»–å°±æœ‰è‡ªå·±çš„ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§ã€‚</p>
</blockquote>
<p>ç°åœ¨æˆ‘ä»¬åˆ†ç¦»äº†ä¸€ç§è¡Œä¸ºç±»ï¼Œåœ¨å…±æœ‰ç±»ä¸­è¢«å£°æ˜ä½†ä¸ä¼šå®ç°ï¼Œè€Œæ˜¯åœ¨å­ç±»ä¸­å®ä¾‹åŒ–è¿™ä¸ªè¡Œä¸ºç±»ï¼Œè¿™å…¶ä¸­çš„åŸåˆ™å°±æ˜¯ <strong>â¤â€ğŸ”¥ å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿</strong>ï¼Œ å·§åˆçš„æ˜¯ React å“²å­¦ä¸­ä¹Ÿæåˆ°äº†è¿™æ ·çš„æ€æƒ³ã€‚</p>
<p>æœ€åç”¨å®˜æ–¹è¯­è¨€å®šä¹‰ç­–ç•¥æ¨¡å¼ï¼š <strong>å®šä¹‰ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©ä»–ä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œè®©ç®—æ³•çš„å˜æ¢ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·</strong></p>
<ul>
<li>çŸ¥é“ OO åŸºç¡€ï¼Œå¹¶ä¸è¶³ä»¥è®©ä½ è®¾è®¡å‡ºè‰¯å¥½çš„ OO ç³»ç»Ÿã€‚</li>
<li>è‰¯å¥½çš„ OO è®¾è®¡å¿…é¡»å…·å¤‡å¯å¤ç”¨ã€å¯æ‰©å……ã€å¯ç»´æŠ¤ä¸‰ä¸ªç‰¹æ€§ã€‚</li>
<li>æ¨¡å¼å¯ä»¥è®©æˆ‘ä»¬å»ºé€ å‡ºå…·æœ‰è‰¯å¥½ OO è®¾è®¡è´¨é‡çš„ç³»ç»Ÿã€‚</li>
<li>æ¨¡å¼è¢«è®¤ä¸ºæ˜¯å†ç»éªŒè¯çš„ O0 è®¾è®¡ç»éªŒã€‚</li>
<li>æ¨¡å¼ä¸æ˜¯ä»£ç ï¼Œè€Œæ˜¯é’ˆå¯¹è®¾è®¡é—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚ä½ å¯æŠŠå®ƒä»¬åº”ç”¨åˆ°ç‰¹å®šçš„åº”ç”¨ä¸­ã€‚</li>
<li>æ¨¡å¼ä¸æ˜¯è¢«å‘æ˜ï¼Œè€Œæ˜¯è¢«å‘ç°ã€‚</li>
<li>å¤§å¤šæ•°çš„æ¨¡å¼å’ŒåŸåˆ™ï¼Œéƒ½ç€çœ¼äºè½¯ä»¶å˜åŒ–çš„ä¸»é¢˜ã€‚</li>
<li>å¤§å¤šæ•°çš„æ¨¡å¼éƒ½å…è®¸ç³»ç»Ÿå±€éƒ¨æ”¹å˜ç‹¬ç«‹äºå…¶ä»–éƒ¨åˆ†ã€‚</li>
<li>æˆ‘ä»¬å¸¸æŠŠç³»ç»Ÿä¸­ä¼šå˜åŒ–çš„éƒ¨åˆ†æŠ½å‡ºæ¥å°è£…ã€‚</li>
<li>æ¨¡å¼è®©å¼€å‘äººå‘˜ä¹‹é—´æœ‰å…±äº«çš„è¯­è¨€ï¼Œèƒ½å¤Ÿæœ€å¤§åŒ–æ²Ÿé€šçš„ä»·å€¼ã€‚</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-webpack/webpackæ‰§è¡Œæµç¨‹"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/7a682c5de361/"
    >webpackæ‰§è¡Œæµç¨‹</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/7a682c5de361/" class="article-date">
  <time datetime="2022-11-15T01:50:56.000Z" itemprop="datePublished">2022-11-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/webpack/">webpack</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="ä¸»è¦æµç¨‹"><a href="#ä¸»è¦æµç¨‹" class="headerlink" title="ä¸»è¦æµç¨‹"></a>ä¸»è¦æµç¨‹</h3><ul>
<li><p>åˆå§‹åŒ–é˜¶æ®µï¼ˆInitializationï¼‰:</p>
<p>è§£æé…ç½®ï¼šWebpack å¼€å§‹å¤„ç†é…ç½®æ–‡ä»¶ï¼ˆå¦‚ webpack.config.jsï¼‰ï¼ŒåŒ…æ‹¬è§£æå…¥å£ç‚¹ã€åŠ è½½å™¨ã€æ’ä»¶ç­‰ã€‚<br>åˆå§‹åŒ–æ’ä»¶ï¼šåŠ è½½å¹¶åˆå§‹åŒ–é…ç½®ä¸­æŒ‡å®šçš„æ’ä»¶ã€‚<br>ç¯å¢ƒå‡†å¤‡ï¼šè®¾ç½®ç¼–è¯‘ç¯å¢ƒï¼Œä¾‹å¦‚é€‰æ‹©å¼€å‘æ¨¡å¼æˆ–ç”Ÿäº§æ¨¡å¼ã€‚</p>
</li>
<li><p>ç¼–è¯‘é˜¶æ®µï¼ˆCompilationï¼‰:</p>
<p>åˆ›å»ºç¼–è¯‘å™¨ï¼šWebpack åˆ›å»ºä¸€ä¸ªç¼–è¯‘å™¨å®ä¾‹ï¼Œå®ƒç®¡ç†æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ã€‚<br>åˆ›å»ºç¼–è¯‘å¯¹è±¡ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç¼–è¯‘å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ­¤æ¬¡ç¼–è¯‘çš„æ‰€æœ‰ç»†èŠ‚ã€‚<br>è¯»å–è®°å½•ï¼šä»ä¹‹å‰çš„ç¼–è¯‘ä¸­è¯»å–è®°å½•ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä»¥ä¼˜åŒ–ç¼–è¯‘ã€‚<br>è§£æå…¥å£ï¼šæ ¹æ®é…ç½®çš„å…¥å£ç‚¹ï¼Œåˆ†æå‡ºæ‰€æœ‰ä¾èµ–çš„æ¨¡å—ã€‚</p>
</li>
<li><p>æ„å»ºé˜¶æ®µï¼ˆBuildingï¼‰:</p>
<p>åŠ è½½æ¨¡å—ï¼šWebpack é€’å½’åœ°åŠ è½½æ¯ä¸ªä¾èµ–æ¨¡å—ï¼Œè¿™å¯èƒ½æ¶‰åŠåˆ°ä½¿ç”¨ä¸åŒçš„åŠ è½½å™¨å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ã€‚<br>æ¨¡å—è½¬æ¢ï¼šåº”ç”¨åŠ è½½å™¨å’Œæ’ä»¶ï¼Œè½¬æ¢æ¨¡å—å†…å®¹ï¼ˆå¦‚ TS è½¬ JSï¼ŒSASS è½¬ CSSï¼‰ã€‚<br>æ„å»ºä¾èµ–å›¾ï¼šæ„å»ºæ¨¡å—é—´çš„ä¾èµ–å…³ç³»å›¾ã€‚</p>
</li>
<li><p>ä¼˜åŒ–é˜¶æ®µï¼ˆOptimizationï¼‰:</p>
<p>ä¼˜åŒ–æ¨¡å—ï¼šåº”ç”¨å„ç§ä¼˜åŒ–ç­–ç•¥ï¼Œä»¥å‡å°æœ€ç»ˆèµ„äº§çš„å¤§å°ã€‚<br>ä»£ç åˆ†å‰²ï¼šæ ¹æ®éœ€è¦å°†ä»£ç åˆ†å‰²æˆä¸åŒçš„å—ã€‚<br>æ ‘æ‘‡ï¼ˆTree Shakingï¼‰ï¼šç§»é™¤æœªä½¿ç”¨çš„ä»£ç ã€‚</p>
</li>
<li><p>è¾“å‡ºé˜¶æ®µï¼ˆOutputï¼‰:</p>
<p>ç”Ÿæˆèµ„äº§ï¼šæ ¹æ®ä¾èµ–å›¾ï¼ŒWebpack å°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆ<br>å°‘é‡çš„æ‰“åŒ…æ–‡ä»¶ï¼ˆèµ„äº§ï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª JavaScript æ–‡ä»¶ã€CSS æ–‡ä»¶å’Œå…¶ä»–é™æ€èµ„æºæ–‡ä»¶ã€‚</p>
</li>
<li><p>è¾“å‡ºèµ„æºï¼šå°†ç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé€šå¸¸æ˜¯è¾“å‡ºåˆ°æŒ‡å®šçš„ dist ç›®å½•ã€‚</p>
<p>å®Œæˆé˜¶æ®µï¼ˆCompletionï¼‰:<br>æ‰§è¡Œæ’ä»¶ï¼šæ‰§è¡Œå„ç§æ’ä»¶çš„å®Œæˆé’©å­ï¼Œå®Œæˆé¢å¤–çš„ä»»åŠ¡æˆ–æ¸…ç†å·¥ä½œã€‚<br>è¾“å‡ºç»“æœï¼šWebpack æä¾›ç¼–è¯‘è¿‡ç¨‹çš„æ‘˜è¦å’Œè¯¦æƒ…ï¼Œå¦‚ç¼–è¯‘æ—¶é—´ã€æ‰“åŒ…åçš„æ–‡ä»¶å¤§å°ç­‰ã€‚<br>ç›‘å¬æ¨¡å¼ï¼šå¦‚æœå¯ç”¨äº†ç›‘å¬æ¨¡å¼ï¼ˆwatch modeï¼‰ï¼ŒWebpack å°†ä¿æŒæ´»è·ƒçŠ¶æ€ï¼Œå¹¶åœ¨æºæ–‡ä»¶æ›´æ”¹æ—¶é‡æ–°ç¼–è¯‘ã€‚<br>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒWebpack é€šè¿‡å…¶å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿå’ŒåŠ è½½å™¨æœºåˆ¶ï¼Œæä¾›äº†é«˜åº¦çš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œå…è®¸å¼€å‘äººå‘˜é’ˆå¯¹ä¸åŒçš„éœ€æ±‚å’Œåœºæ™¯è¿›è¡Œå®šåˆ¶å’Œä¼˜åŒ–ã€‚</p>
</li>
</ul>
<h3 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h3><h4 id="cli-run"><a href="#cli-run" class="headerlink" title="cli.run"></a>cli.run</h4><p>ä½¿ç”¨ commander å¤„ç†å‘½ä»¤è¡Œå‚æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡å†™å¼‚å¸¸é€€å‡º</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">program</span>.<span class="title function_">exitOverride</span>(<span class="title function_">async</span>(<span class="function">(<span class="params"><span class="keyword">async</span></span>) =&gt;</span> &#123;&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬é€‰é¡¹ ä»¥åŠé€‰é¡¹è§¦å‘æ—¶çš„å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">program</span>.<span class="title function_">option</span>(<span class="string">&quot;--no-color&quot;</span>, <span class="string">&quot;Disable colors on console.&quot;</span>);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">program</span>.<span class="title function_">on</span>(<span class="string">&quot;option:no-color&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»‘å®šå¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment">// æœ€ç»ˆæ‰§è¡Œwebpack</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">program</span>.<span class="title function_">action</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  compiler = <span class="variable language_">this</span>.<span class="title function_">webpack</span>(config.<span class="property">options</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»º-compiler"><a href="#åˆ›å»º-compiler" class="headerlink" title="åˆ›å»º compiler"></a>åˆ›å»º compiler</h4><blockquote>
<blockquote>
<p>node_modules\webpack\lib\webpack.js</p>
</blockquote>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">createCompiler</span> = (<span class="params">rawOptions</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> options = <span class="title function_">getNormalizedWebpackOptions</span>(rawOptions);</span><br><span class="line">  <span class="title function_">applyWebpackOptionsBaseDefaults</span>(options);</span><br><span class="line">  <span class="keyword">const</span> compiler = <span class="keyword">new</span> <span class="title class_">Compiler</span>(options);</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">NodeEnvironmentPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">infrastructureLogging</span>: options.<span class="property">infrastructureLogging</span>,</span><br><span class="line">  &#125;).<span class="title function_">apply</span>(compiler);</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰çš„æ’ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(options.<span class="property">plugins</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> plugin <span class="keyword">of</span> options.<span class="property">plugins</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        plugin.<span class="title function_">call</span>(compiler, compiler);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (plugin) &#123;</span><br><span class="line">        plugin.<span class="title function_">apply</span>(compiler);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">applyWebpackOptionsDefaults</span>(options);</span><br><span class="line">  compiler.<span class="property">hooks</span>.<span class="property">environment</span>.<span class="title function_">call</span>();</span><br><span class="line">  compiler.<span class="property">hooks</span>.<span class="property">afterEnvironment</span>.<span class="title function_">call</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œå†…éƒ¨ä¾èµ–æ’ä»¶</span></span><br><span class="line">  <span class="comment">// ExternalsPlugin</span></span><br><span class="line">  <span class="comment">// ChunkPrefetchPreloadPlugin</span></span><br><span class="line">  <span class="comment">// ArrayPushCallbackChunkFormatPlugin</span></span><br><span class="line">  <span class="comment">// EnableChunkLoadingPlugin</span></span><br><span class="line">  <span class="comment">// JsonpChunkLoadingPlugin</span></span><br><span class="line">  <span class="comment">// ImportScriptsChunkLoadingPlugin</span></span><br><span class="line">  <span class="comment">// EnableWasmLoadingPlugin</span></span><br><span class="line">  <span class="comment">// CleanPlugin</span></span><br><span class="line">  <span class="comment">// JavascriptModulesPlugin</span></span><br><span class="line">  <span class="comment">// JsonModulesPlugin</span></span><br><span class="line">  <span class="comment">// AssetModulesPlugin</span></span><br><span class="line">  <span class="comment">// EntryOptionPlugin</span></span><br><span class="line">  <span class="comment">// EntryPlugin</span></span><br><span class="line">  <span class="comment">// RuntimePlugin</span></span><br><span class="line">  <span class="comment">// InferAsyncModulesPlugin</span></span><br><span class="line">  <span class="comment">// DataUriPlugin</span></span><br><span class="line">  <span class="comment">// FileUriPlugin</span></span><br><span class="line">  <span class="comment">// CompatibilityPlugin</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// HarmonyModulesPlugin</span></span><br><span class="line">  <span class="comment">// æ¨¡å—è§£æå’Œç»‘å®šï¼šå®ƒå¸®åŠ© Webpack è§£æå’Œç»‘å®š ES6 æ¨¡å—çš„ import å’Œ export è¯­å¥ï¼Œç¡®ä¿æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»è¢«æ­£ç¡®å¤„ç†ã€‚</span></span><br><span class="line">  <span class="comment">// æ ‘æ‘‡ï¼ˆTree Shakingï¼‰ï¼šè¿™ä¸ªæ’ä»¶æ”¯æŒæ ‘æ‘‡ä¼˜åŒ–ï¼Œå³ç§»é™¤æœªä½¿ç”¨çš„æ¨¡å—æˆ–æ¨¡å—éƒ¨åˆ†ï¼Œä»¥å‡å°æœ€ç»ˆæ‰“åŒ…æ–‡ä»¶çš„å¤§å°ã€‚è¿™æ˜¯é€šè¿‡é™æ€åˆ†æ import å’Œ export è¯­å¥æ¥å®ç°çš„ã€‚</span></span><br><span class="line">  <span class="comment">// ES6 æ¨¡å—çš„åŸç”Ÿæ”¯æŒï¼šç”±äº ES6 æ¨¡å—æ˜¯ JavaScript è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼ŒHarmonyModulesPlugin æä¾›äº†å¯¹è¿™äº›æ¨¡å—çš„åŸç”Ÿæ”¯æŒï¼Œæ— éœ€è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼ã€‚</span></span><br><span class="line">  <span class="comment">// ä»£ç åˆ†å‰²å’Œå¼‚æ­¥åŠ è½½ï¼šæ’ä»¶æ”¯æŒåŸºäº ES6 æ¨¡å—çš„ä»£ç åˆ†å‰²å’Œå¼‚æ­¥åŠ è½½ï¼Œè¿™æœ‰åŠ©äºæé«˜å¤§å‹åº”ç”¨çš„æ€§èƒ½ã€‚</span></span><br><span class="line">  <span class="comment">// ä¸å…¶ä»– Webpack ç‰¹æ€§çš„é›†æˆï¼šHarmonyModulesPlugin ä¸ Webpack çš„å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚æ¨¡å—çƒ­æ›¿æ¢ã€ä»£ç å‹ç¼©ç­‰ï¼‰ç´§å¯†é›†æˆã€‚</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// InferAsyncModulesPlugin</span></span><br><span class="line">  <span class="comment">// DataUriPlugin</span></span><br><span class="line">  <span class="comment">// FileUriPlugin</span></span><br><span class="line">  <span class="comment">// CompatibilityPlugin</span></span><br><span class="line">  <span class="comment">// HarmonyModulesPlugin</span></span><br><span class="line">  <span class="comment">// AMDPlugin</span></span><br><span class="line">  <span class="comment">// RequireJsStuffPlugin</span></span><br><span class="line">  <span class="comment">// CommonJsPlugin</span></span><br><span class="line">  <span class="comment">// LoaderPlugin</span></span><br><span class="line">  <span class="comment">// NodeStuffPlugin</span></span><br><span class="line">  <span class="comment">// APIPlugin</span></span><br><span class="line">  <span class="comment">// ExportsInfoApiPlugin</span></span><br><span class="line">  <span class="comment">// WebpackIsIncludedPlugin</span></span><br><span class="line">  <span class="comment">// ConstPlugin</span></span><br><span class="line">  <span class="comment">// UseStrictPlugin</span></span><br><span class="line">  <span class="comment">// RequireIncludePlugin</span></span><br><span class="line">  <span class="comment">// RequireEnsurePlugin</span></span><br><span class="line">  <span class="comment">// RequireContextPlugin</span></span><br><span class="line">  <span class="comment">// ImportPlugin</span></span><br><span class="line">  <span class="comment">// ImportMetaContextPlugin</span></span><br><span class="line">  <span class="comment">// SystemPlugin</span></span><br><span class="line">  <span class="comment">// ImportMetaPlugin</span></span><br><span class="line">  <span class="comment">// URLPlugin</span></span><br><span class="line">  <span class="comment">// DefaultStatsFactoryPlugin</span></span><br><span class="line">  <span class="comment">// DefaultStatsPresetPlugin</span></span><br><span class="line">  <span class="comment">// DefaultStatsPrinterPlugin</span></span><br><span class="line">  <span class="comment">// JavascriptMetaInfoPlugin</span></span><br><span class="line">  <span class="comment">// EnsureChunkConditionsPlugin</span></span><br><span class="line">  <span class="comment">// RemoveEmptyChunksPlugin</span></span><br><span class="line">  <span class="comment">// MergeDuplicateChunksPlugin</span></span><br><span class="line">  <span class="comment">// FlagIncludedChunksPlugin</span></span><br><span class="line">  <span class="comment">// SideEffectsFlagPlugin</span></span><br><span class="line">  <span class="comment">// FlagDependencyExportsPlugin</span></span><br><span class="line">  <span class="comment">// FlagDependencyUsagePlugin</span></span><br><span class="line">  <span class="comment">// InnerGraphPlugin</span></span><br><span class="line">  <span class="comment">// MangleExportsPlugin</span></span><br><span class="line">  <span class="comment">// ModuleConcatenationPlugin</span></span><br><span class="line">  <span class="comment">// SplitChunksPlugin</span></span><br><span class="line">  <span class="comment">// RuntimeChunkPlugin</span></span><br><span class="line">  <span class="comment">// NoEmitOnErrorsPlugin</span></span><br><span class="line">  <span class="comment">// RealContentHashPlugin</span></span><br><span class="line">  <span class="comment">// WasmFinalizeExportsPlugin</span></span><br><span class="line">  <span class="comment">// DeterministicModuleIdsPlugin</span></span><br><span class="line">  <span class="comment">// DeterministicChunkIdsPlugin</span></span><br><span class="line">  <span class="comment">// DefinePlugin</span></span><br><span class="line">  <span class="comment">// SizeLimitsPlugin</span></span><br><span class="line">  <span class="comment">// TemplatedPathPlugin</span></span><br><span class="line">  <span class="comment">// RecordIdsPlugin</span></span><br><span class="line">  <span class="comment">// WarnCaseSensitiveModulesPlugin</span></span><br><span class="line">  <span class="comment">// AddManagedPathsPlugin</span></span><br><span class="line">  <span class="comment">// ResolverCachePlugin</span></span><br><span class="line"></span><br><span class="line">  <span class="title class_">WorkerPlugin</span>;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">WebpackOptionsApply</span>().<span class="title function_">process</span>(options, compiler);</span><br><span class="line">  compiler.<span class="property">hooks</span>.<span class="property">initialize</span>.<span class="title function_">call</span>();</span><br><span class="line">  <span class="keyword">return</span> compiler;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="compiler-run"><a href="#compiler-run" class="headerlink" title="compiler.run()"></a>compiler.run()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">beforeRun</span>.<span class="title function_">callAsync</span>(<span class="variable language_">this</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">run</span>.<span class="title function_">callAsync</span>(<span class="variable language_">this</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">readRecords</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">compile</span>(onCompiled);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">å·¥ç¨‹åŒ–</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-react/v18æ–°ç‰¹æ€§"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/0dfb128a2887/"
    >React 18 æ–°ç‰¹æ€§</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/0dfb128a2887/" class="article-date">
  <time datetime="2022-06-01T02:11:46.000Z" itemprop="datePublished">2022-06-01</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/React/">React</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="å…¼å®¹æ€§"><a href="#å…¼å®¹æ€§" class="headerlink" title="å…¼å®¹æ€§"></a>å…¼å®¹æ€§</h4><p>V18 å·²ä¸å†æ”¯æŒ IE11,è®¡åˆ’æ—¶é—´æ˜¯ 2022 å¹´ 6 æœˆ 15 æ—¥, å› ä¸ºç”¨åˆ°çš„ä¸€äº›ç°ä»£æµè§ˆå™¨æ–°ç‰¹æ€§å¦‚ <code>micro-tasks</code>,åœ¨ IE ä¸­æ— æ³•å……åˆ† polyfill .</p>
<h4 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h4><p>V18 ç‰ˆæœ¬åœ¨ V17 çš„åŸºç¡€ä¸Šåˆåšäº†ä¸€äº›è°ƒæ•´ã€‚åœ¨è¿‡å»çš„ V17 ç‰ˆæœ¬ä¸­,ä¼ ç»Ÿæ¨¡å¼å’Œå¹¶å‘æ¨¡å¼æ˜¯å…±å­˜çš„ï¼Œ é€šè¿‡ <code>createRoot</code> API å°±å¯ä»¥å¯ç”¨å¹¶å‘æ¨¡å¼ã€‚React ä¸ºå‘å¹¶å‘æ¨¡å¼è¿ç§»çš„æœ€åˆç­–ç•¥æ˜¯è®¾è®¡ä¸‰ç§æ¨¡å¼ã€‚</p>
<ul>
<li>Legacy æ¨¡å¼ï¼š V17 ä¸­é»˜è®¤ä½¿ç”¨çš„æ¨¡å¼ã€‚é»˜è®¤å¼€å¯ä¸¥æ ¼æ¨¡å¼ã€‚é»˜è®¤åŒæ­¥æ›´æ–°ã€‚Legacy Suspense semanticsã€‚</li>
<li>Blocking æ¨¡å¼ï¼š Legacy å’Œ Concurrent æ··åˆæ¨¡å¼ã€‚é»˜è®¤å¼€å¯ä¸¥æ ¼æ¨¡å¼ã€‚é»˜è®¤åŒæ­¥æ›´æ–°ã€‚å¼€æ”¾ä¸€äº›æ–°ç‰¹æ€§ã€‚</li>
<li>Concurrent æ¨¡å¼ï¼šV18 ä½¿ç”¨çš„æ¨¡å¼ã€‚é»˜è®¤å¼€å¯ä¸¥æ ¼æ¨¡å¼ã€‚é»˜è®¤å¹¶å‘æ›´æ–°ã€‚å¼€å‘æ‰€æœ‰çš„æ–°ç‰¹æ€§ã€‚</li>
</ul>
<p>React æœ€åˆçš„è®¡åˆ’æ˜¯ç”¨æˆ·å¯ä»¥ä» Legacy åˆ‡æ¢åˆ° Blocking æ¨¡å¼ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹ä»»ä½•è¯­æ³•ï¼Œé…åˆä¸¥æ ¼æ¨¡å¼ï¼ˆStrictModeï¼‰ä¿®æ”¹å…¶ä¸­çš„æŠ¥é”™ï¼Œå½“æ‰€æœ‰é”™è¯¯è¢«è§£å†³ä¹‹åï¼Œå¯ä»¥ç›´æ¥åˆ‡æ¢åˆ°çš„ Concurrent æ¨¡å¼ã€‚</p>
<p>ä½†åœ¨å®é™…çš„åœºæ™¯ React æ€è€ƒäº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜:</p>
<ul>
<li>é¡¹ç›®ä¸­ä¼šæœ‰æˆç™¾ä¸Šåƒä¸ªæ–‡ä»¶ï¼Œå¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œä¼šæœ‰å¤§é‡çš„é”™è¯¯ä¿¡æ¯ï¼Œè™½ç„¶ä¸å½±å“ç¨‹åºè¿è¡Œï¼Œä½†æ˜¯ä¼šå¹²æ‰°å¼€å‘å¹¶ä¸”ä¸èƒ½å¿«é€Ÿçš„ä¸€æ¬¡æ€§è§£å†³ã€‚</li>
<li>å¯ç”¨å¹¶å‘æ¨¡å¼çš„å¥½å¤„ä¸è¨€è€Œå–»ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥é»˜è®¤å¯ç”¨ã€‚æä¾› <code>startTransition</code> <code>Suspense</code> ç­‰ API åœ¨å†…éƒ¨å®ç°å¹¶å‘ç‰¹æ€§ã€‚ç”¨æˆ·å¯ä»¥å¢é‡çš„é€‰æ‹©æ€§çš„ä½¿ç”¨è¿™äº› API ä»è€Œè·å¾—å¹¶å‘çš„ç‰¹æ€§ã€‚</li>
<li>å¦‚æœæŒ‰ç…§ä¸Šè¿°çš„æ€è·¯ï¼Œé‚£ä¹ˆ Concurrent æ¨¡å¼å’Œ Blocking æ¨¡å¼çš„å”¯ä¸€åŒºåˆ«å°±åªæœ‰æ˜¯å¦æç¤ºé”™è¯¯ä¿¡æ¯ã€‚é‚£ä¹ˆå¦‚æœé»˜è®¤ä¸å¯ç”¨å¹¶å‘æ¨¡å¼ï¼Œå°±å¯ä»¥ä¸å¼€å¯ä¸¥æ ¼æ¨¡å¼ï¼Œç”¨äºæç¤ºé”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<p>åŸºäºä¸Šé¢çš„æ€è€ƒï¼ŒV18 çš„ç­–ç•¥æ˜¯ä¸ä¼šé»˜è®¤å¯ç”¨å¹¶å‘çš„ç‰¹æ€§ï¼Œå³ä½¿ç”¨ <code>createRoot</code> å¯ç”¨å¹¶å‘æ¨¡å¼å¹¶ä¸èƒ½ä½“éªŒå¹¶å‘çš„ç‰¹æ€§ï¼Œå¦‚æœæƒ³ä½“éªŒå¹¶å‘çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨ä¾‹å¦‚ <code>startTransition</code> ç­‰æ”¯æŒå¹¶å‘ç‰¹æ€§çš„ API. æ‰€ä»¥å®˜æ–¹æè¿°ä¸º <strong>æ²¡æœ‰å¹¶å‘æ¨¡å¼ï¼Œåªæœ‰å¹¶å‘ç‰¹æ€§</strong></p>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul>
<li>startTransition</li>
</ul>
<p>è¿™ä¸ª API å¯ä»¥é˜²æ­¢æ¸²æŸ“ä»»åŠ¡ç«‹å³æ‰§è¡Œï¼Œå…è®¸å°†åº”ç”¨ç¨‹åºä¸­çš„æŸäº›æ›´æ–°æ ‡è®°ä¸ºéç´§æ€¥æ›´æ–°ï¼Œå› æ­¤å®ƒä»¬ä¼šæš‚åœï¼ŒåŒæ—¶ä¼˜å…ˆè€ƒè™‘æ›´ç´§æ€¥çš„æ›´æ–°ã€‚è¿™å¯ä»¥åœ¨ä¸€ä¸ªå¤æ‚çš„æ›´æ–°ä¸­ç›¸åº”ç”¨æˆ·è¾“å…¥ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">aaaaaaaaaaaaaaa</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000000</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [num, setNum] = useState&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> [list, setList] = useState&lt;<span class="built_in">any</span>[]&gt;([]);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setList</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">20000</span>).<span class="title function_">fill</span>(<span class="literal">null</span>));</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> event = <span class="variable language_">document</span>.<span class="title function_">createEvent</span>(<span class="string">&quot;MouseEvents&quot;</span>);</span><br><span class="line">    event.<span class="title function_">initEvent</span>(<span class="string">&quot;click&quot;</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;button&quot;</span>)!.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">&#125;, []);</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">id</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        setNum(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">          aaaaaaaaaaaaaaa();</span></span><br><span class="line"><span class="language-xml">          return &quot;123&quot;;</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      ç‚¹å‡»</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;num&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;list.map((_, i) =&gt; (</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;Math.random()&#125;</span>&gt;</span>&#123;i&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    ))&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨æ²¡æœ‰ä½¿ç”¨å¹¶å‘ç‰¹æ€§çš„æ—¶å€™ï¼Œåˆ—è¡¨çš„æ¸²æŸ“æ˜¯ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼Œä¸ä¼šç›¸åº”æ¨¡æ‹Ÿçš„ç”¨æˆ·äº‹ä»¶</p>
<p><img src="/posts/0dfb128a2887/0001.png"></p>
<p>å½“å¼€å¯äº†å¹¶å‘ç‰¹æ€§ä¹‹åï¼Œä¼šè¢«æ‹†åˆ†æˆå°ä»»åŠ¡å¼‚æ­¥æ‰§è¡Œ</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setList</span>(<span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">20000</span>).<span class="title function_">fill</span>(<span class="literal">null</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/posts/0dfb128a2887/0002.png"></p>
<ul>
<li>useDeferredValue</li>
</ul>
<p>ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®çš„å‰¯æœ¬ï¼Œå¦‚æœå½“å‰æ›´æ–°æ˜¯ä¸€ä¸ªç´§æ€¥æ›´æ–°ï¼ŒuseDeferredValue ä¼šè¿”å›ä¹‹å‰çš„çŠ¶æ€ï¼Œä»è€Œä¼˜å…ˆå“åº”ç´§æ€¥æ›´æ–°ã€‚å½“ç´§æ€¥æ›´æ–°æ¸²æŸ“å®Œæˆåï¼Œæ‰ä¼šå»æ‰§è¡Œçš„å½“å‰æ›´æ–°ã€‚åº•å±‚å®ç°ä¸ useDeferredValue ç±»ä¼¼ã€‚</p>
<p>ä½¿ç”¨ <code>useDeferredValue</code> ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœ</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [list, setList] = useState&lt;<span class="built_in">any</span>[]&gt;([]);</span><br><span class="line"><span class="keyword">const</span> dList = <span class="title function_">useDeferredValue</span>(list);</span><br></pre></td></tr></table></figure>

<ul>
<li>useId</li>
</ul>
<p>ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ ID, åœ¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ç”Ÿæˆçš„ç›¸åŒï¼Œé˜²æ­¢ ID ä¸åŒ¹é…</p>
<ul>
<li>useSyncExternalStore</li>
</ul>
<p>useSyncExternalStoreÂ  æ˜¯ä¸€ä¸ªæ–°çš„ apiï¼Œç»å†äº†ä¸€æ¬¡ä¿®æ”¹ï¼Œç”± Â useMutableSourceÂ  æ”¹å˜è€Œæ¥ï¼Œä¸»è¦ç”¨æ¥è§£å†³å¤–éƒ¨æ•°æ®æ’•è£‚é—®é¢˜ã€‚</p>
<p>useSyncExternalStore èƒ½å¤Ÿé€šè¿‡å¼ºåˆ¶åŒæ­¥æ›´æ–°æ•°æ®è®© React ç»„ä»¶åœ¨ CM ä¸‹å®‰å…¨åœ°æœ‰æ•ˆåœ°è¯»å–å¤–æ¥æ•°æ®æºã€‚ åœ¨ Concurrent Mode ä¸‹ï¼ŒReact ä¸€æ¬¡æ¸²æŸ“ä¼šåˆ†ç‰‡æ‰§è¡Œï¼ˆä»¥ fiber ä¸ºå•ä½ï¼‰ï¼Œä¸­é—´å¯èƒ½ç©¿æ’ä¼˜å…ˆçº§æ›´é«˜çš„æ›´æ–°ã€‚å‡å¦‚åœ¨é«˜ä¼˜å…ˆçº§çš„æ›´æ–°ä¸­æ”¹å˜äº†å…¬å…±æ•°æ®ï¼ˆæ¯”å¦‚ redux ä¸­çš„æ•°æ®ï¼‰ï¼Œé‚£ä¹‹å‰ä½ä¼˜å…ˆçš„æ¸²æŸ“å¿…é¡»è¦é‡æ–°å¼€å§‹æ‰§è¡Œï¼Œå¦åˆ™å°±ä¼šå‡ºç°å‰åçŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p>useSyncExternalStore ä¸€èˆ¬æ˜¯ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ä½¿ç”¨ï¼Œæˆ‘ä»¬åœ¨æ—¥å¸¸ä¸šåŠ¡ä¸­ä¸éœ€è¦å…³æ³¨ã€‚å› ä¸º React è‡ªèº«çš„ useState å·²ç»åŸç”Ÿçš„è§£å†³çš„å¹¶å‘ç‰¹æ€§ä¸‹çš„ tearï¼ˆæ’•è£‚ï¼‰é—®é¢˜ã€‚useSyncExternalStore ä¸»è¦å¯¹äºæ¡†æ¶å¼€å‘è€…ï¼Œæ¯”å¦‚ reduxï¼Œå®ƒåœ¨æ§åˆ¶çŠ¶æ€æ—¶å¯èƒ½å¹¶éç›´æ¥ä½¿ç”¨çš„ React çš„ stateï¼Œè€Œæ˜¯è‡ªå·±åœ¨å¤–éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª store å¯¹è±¡ï¼Œç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°äº†æ•°æ®æ›´æ–°ï¼Œè„±ç¦»äº† React çš„ç®¡ç†ï¼Œä¹Ÿå°±æ— æ³•ä¾é  React è‡ªåŠ¨è§£å†³æ’•è£‚é—®é¢˜ã€‚å› æ­¤ React å¯¹å¤–æä¾›äº†è¿™æ ·ä¸€ä¸ª APIã€‚</p>
<p>ç›®å‰ React-Redux 8.0 å·²ç»åŸºäº useSyncExternalStore å®ç°ã€‚</p>
<ul>
<li>useInsertionEffect</li>
</ul>
<p>è¿™ä¸ª <a target="_blank" rel="noopener" href="https://github.com/reactwg/react-18/discussions/110">Hooks</a> åªå»ºè®® Â css-in-js åº“æ¥ä½¿ç”¨ã€‚ è¿™ä¸ª Hooks æ‰§è¡Œæ—¶æœºåœ¨ DOM ç”Ÿæˆä¹‹åï¼ŒuseLayoutEffect ä¹‹å‰ï¼Œå®ƒçš„å·¥ä½œåŸç†å¤§è‡´å’Œ Â useLayoutEffectÂ  ç›¸åŒï¼Œåªæ˜¯æ­¤æ—¶æ— æ³•è®¿é—® Â DOMÂ  èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä¸€èˆ¬ç”¨äºæå‰æ³¨å…¥ Â <code>&lt;style&gt;</code>Â  è„šæœ¬ã€‚</p>
<ul>
<li>Suspense</li>
</ul>
<p>å®˜æ–¹å¯¹ ç©ºçš„ fallback å±æ€§çš„å¤„ç†æ–¹å¼åšäº†æ”¹å˜ï¼šä¸å†è·³è¿‡ ç¼ºå¤±å€¼ æˆ– å€¼ä¸º null çš„ fallback çš„ Suspenseã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š fallback å°†ä¼šæŠŠ fallback å‘ˆç°ä¸º nullã€‚</p>
<h4 id="æ‰¹å¤„ç†"><a href="#æ‰¹å¤„ç†" class="headerlink" title="æ‰¹å¤„ç†"></a>æ‰¹å¤„ç†</h4><p>åœ¨ 18 ä¹‹å‰ï¼Œåªæœ‰åœ¨ react äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œæ‰ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå…¶å®ƒæƒ…å†µä¼šå¤šæ¬¡æ›´æ–°</p>
<p>åœ¨ 18 ä¹‹åï¼Œä»»ä½•æƒ…å†µéƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œæ‰¹å¤„ç†ï¼Œå¤šæ¬¡æ›´æ–°å§‹ç»ˆåˆå¹¶ä¸ºä¸€æ¬¡</p>
<p>å¦‚æœæƒ³è¦è·³å‡ºæ‰¹å¤„ç†ä½¿ç”¨ <code>flushSync</code></p>
<h4 id="å…³äºå¸è½½ç»„ä»¶æ—¶çš„æ›´æ–°çŠ¶æ€è­¦å‘Š"><a href="#å…³äºå¸è½½ç»„ä»¶æ—¶çš„æ›´æ–°çŠ¶æ€è­¦å‘Š" class="headerlink" title="å…³äºå¸è½½ç»„ä»¶æ—¶çš„æ›´æ–°çŠ¶æ€è­¦å‘Š"></a>å…³äºå¸è½½ç»„ä»¶æ—¶çš„æ›´æ–°çŠ¶æ€è­¦å‘Š</h4><p>æœ‰çš„æ—¶å€™ä¼šé‡åˆ°å¦‚ä¸‹çš„é”™è¯¯</p>
<p><img src="/posts/0dfb128a2887/0003.png"></p>
<p>è¿™ä¸ªé”™è¯¯è¡¨ç¤ºï¼šæ— æ³•å¯¹æœªæŒ‚è½½ï¼ˆå·²å¸è½½ï¼‰çš„ç»„ä»¶æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚è¿™æ˜¯ä¸€ä¸ªæ— æ•ˆæ“ä½œï¼Œå¹¶ä¸”è¡¨æ˜æˆ‘ä»¬çš„ä»£ç ä¸­å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™ä¸ªé”™è¯¯å¹¶ä¸å¤šè§ï¼Œåœ¨ä»¥å¾€çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªè­¦å‘Šè¢«å¹¿æ³›è¯¯è§£ï¼Œå¹¶ä¸”æœ‰äº›è¯¯å¯¼ã€‚</p>
<p>è¿™ä¸ªé”™è¯¯çš„åˆè¡·ï¼ŒåŸæœ¬æ—¨åœ¨é’ˆå¯¹ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œè­¬å¦‚ ä½ åœ¨ useEffect é‡Œé¢è®¾ç½®äº†å®šæ—¶å™¨ï¼Œæˆ–è€…è®¢é˜…äº†æŸä¸ªäº‹ä»¶ï¼Œä»è€Œåœ¨ç»„ä»¶å†…éƒ¨äº§ç”Ÿäº†å‰¯ä½œç”¨ï¼Œè€Œä¸”å¿˜è®° return ä¸€ä¸ªå‡½æ•°æ¸…é™¤å‰¯ä½œç”¨ï¼Œåˆ™ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼â€¦â€¦ ä¹‹ç±»çš„åœºæ™¯</p>
<p>ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ›´å¤šçš„åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬åœ¨ useEffect é‡Œé¢å‘é€äº†ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œåœ¨å¼‚æ­¥å‡½æ•°è¿˜æ²¡æœ‰è¢« resolve æˆ–è€…è¢« reject çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¸è½½äº†ç»„ä»¶ã€‚ åœ¨è¿™ç§åœºæ™¯ä¸­ï¼Œè­¦å‘ŠåŒæ ·ä¼šè§¦å‘ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»„ä»¶å†…éƒ¨å¹¶æ²¡æœ‰å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¿™ä¸ªå¼‚æ­¥å‡½æ•°å·²ç»è¢«åƒåœ¾å›æ”¶äº†ï¼Œæ­¤æ—¶ï¼Œè­¦å‘Šå…·æœ‰è¯¯å¯¼æ€§ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°åŸå› ï¼Œåœ¨ React 18 ä¸­ï¼Œå®˜æ–¹åˆ é™¤äº†è¿™ä¸ªæŠ¥é”™ã€‚</p>
<h4 id="è¿”å›å€¼ç±»å‹"><a href="#è¿”å›å€¼ç±»å‹" class="headerlink" title="è¿”å›å€¼ç±»å‹"></a>è¿”å›å€¼ç±»å‹</h4><p>åœ¨ React 18 ä¸­ï¼Œä¸å†æ£€æŸ¥å› è¿”å› undefined è€Œå¯¼è‡´å´©æºƒã€‚æ—¢èƒ½è¿”å› nullï¼Œä¹Ÿèƒ½è¿”å› undefinedã€‚ä½†éœ€è¦ä¿®æ”¹ç›¸åº”çš„ dts æ–‡ä»¶ã€‚</p>
<h4 id="Strict-Mode"><a href="#Strict-Mode" class="headerlink" title="Strict Mode"></a>Strict Mode</h4><p>ä¸¥æ ¼æ¨¡å¼ä¼šæ‰“å°ä¸¤æ¬¡æ—¥å¿—ï¼Œå¯ä»¥åœ¨ React DevTools ä¸­å…³é—­ã€‚</p>
<p>åœ¨ React 17 ä¸­ï¼Œå–æ¶ˆäº†å…¶ä¸­ä¸€æ¬¡æ¸²æŸ“çš„æ§åˆ¶å°æ—¥å¿—ï¼Œä»¥ä¾¿è®©æ—¥å¿—æ›´å®¹æ˜“é˜…è¯»ã€‚</p>
<p>åœ¨ React 18 ä¸­ï¼Œå®˜æ–¹å–æ¶ˆäº†è¿™ä¸ªé™åˆ¶ã€‚å¦‚æœä½ å®‰è£…äº† React DevToolsï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“çš„æ—¥å¿—ä¿¡æ¯å°†æ˜¾ç¤ºä¸ºç°è‰²ï¼Œä»¥æŸ”å’Œçš„æ–¹å¼æ˜¾å¼åœ¨æ§åˆ¶å°ã€‚</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-javascript/æ‰§è¡Œæœºåˆ¶"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/b672c2864ca4/"
    >Javascript æ‰§è¡Œæœºåˆ¶</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/b672c2864ca4/" class="article-date">
  <time datetime="2022-05-24T01:17:59.000Z" itemprop="datePublished">2022-05-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a> / <a class="article-category-link" href="/categories/JavaScript/%E5%9F%BA%E7%A1%80/">åŸºç¡€</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="å˜é‡æå‡ä¸æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#å˜é‡æå‡ä¸æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="å˜é‡æå‡ä¸æ‰§è¡Œä¸Šä¸‹æ–‡"></a>å˜é‡æå‡ä¸æ‰§è¡Œä¸Šä¸‹æ–‡</h4><p>JS ä»£ç è¿è¡Œä¼šåˆ†ä¸º<strong>ç¼–è¯‘</strong>å’Œ<strong>æ‰§è¡Œ</strong>ä¸¤ä¸ªé˜¶æ®µ</p>
<p>æ‰€è°“çš„å˜é‡æå‡ï¼Œæ˜¯æŒ‡åœ¨ JavaScript ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼ŒJavaScript å¼•æ“æŠŠå˜é‡çš„å£°æ˜éƒ¨åˆ†å’Œå‡½æ•°çš„å£°æ˜éƒ¨åˆ†æå‡åˆ°ä»£ç å¼€å¤´çš„â€œè¡Œä¸ºâ€ã€‚å˜é‡è¢«æå‡åï¼Œä¼šç»™å˜é‡è®¾ç½®é»˜è®¤å€¼å¹¶å­˜åˆ°å†…å­˜ä¸­ï¼Œè¿™ä¸ªé»˜è®¤å€¼å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ undefinedã€‚</p>
<p>æœ€ç»ˆåœ¨ç¼–è¯‘é˜¶æ®µä¼šç”Ÿæˆä¸¤éƒ¨åˆ†å†…å®¹ï¼š<strong>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution context</strong>ï¼‰å’Œ <strong>å¯æ‰§è¡Œä»£ç </strong>ã€‚</p>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ JavaScript æ‰§è¡Œä¸€æ®µä»£ç æ—¶çš„è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿›å…¥è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç¡®å®šè¯¥å‡½æ•°åœ¨æ‰§è¡ŒæœŸé—´ç”¨åˆ°çš„è¯¸å¦‚ thisã€å˜é‡ã€å¯¹è±¡ä»¥åŠå‡½æ•°ç­‰ã€‚</p>
<p><img src="/posts/b672c2864ca4/0003.webp"></p>
<ul>
<li>å½“ JavaScript æ‰§è¡Œå…¨å±€ä»£ç çš„æ—¶å€™ï¼Œä¼šç¼–è¯‘å…¨å±€ä»£ç å¹¶åˆ›å»ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè€Œä¸”åœ¨æ•´ä¸ªé¡µé¢çš„ç”Ÿå­˜å‘¨æœŸå†…ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åªæœ‰ä¸€ä»½ã€‚</li>
<li>å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œå‡½æ•°ä½“å†…çš„ä»£ç ä¼šè¢«ç¼–è¯‘ï¼Œå¹¶åˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸä¹‹åï¼Œåˆ›å»ºçš„å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«é”€æ¯ã€‚</li>
<li>å½“ä½¿ç”¨ eval å‡½æ•°çš„æ—¶å€™ï¼Œeval çš„ä»£ç ä¹Ÿä¼šè¢«ç¼–è¯‘ï¼Œå¹¶åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<h4 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h4><p>å…ˆè¿›å…ˆå‡º,æ‰§è¡Œä¸Šä¸‹æ–‡é€šè¿‡è°ƒç”¨æ ˆæ¥ç®¡ç†</p>
<p>å…¨å±€æ‰§è¡Œæ˜¯ä¸Šä¸‹æ–‡æœ€å…ˆè¢«å‹å…¥æ ˆä¸­, æ¥ä¸‹æ¥å¦‚æœæœ‰å‡½æ•°æ‰§è¡Œ,å½“ä¸ºå‡½æ•°åˆ›å»ºå¥½æ‰§è¡Œä¸Šä¸‹æ–‡å,ä¹Ÿä¼šè¢«å‹å…¥æ ˆä¸­,å½“å‡½æ•°è¿”å›æ—¶,æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šä»æ ˆé¡¶å¼¹å‡º.</p>
<p>è°ƒç”¨æ ˆæ˜¯ JavaScript å¼•æ“è¿½è¸ªå‡½æ•°æ‰§è¡Œçš„ä¸€ä¸ªæœºåˆ¶ï¼Œå½“ä¸€æ¬¡æœ‰å¤šä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œé€šè¿‡è°ƒç”¨æ ˆå°±èƒ½å¤Ÿè¿½è¸ªåˆ°å“ªä¸ªå‡½æ•°æ­£åœ¨è¢«æ‰§è¡Œä»¥åŠå„å‡½æ•°ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚</p>
<p>ä½¿ç”¨ <code>console.trace()</code> å¯ä»¥æŸ¥çœ‹å½“å‰çš„è°ƒç”¨æ ˆä¿¡æ¯.</p>
<h4 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h4><p>ä½œç”¨åŸŸæ˜¯æŒ‡åœ¨ç¨‹åºä¸­å®šä¹‰å˜é‡çš„åŒºåŸŸï¼Œè¯¥ä½ç½®å†³å®šäº†å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚é€šä¿—åœ°ç†è§£ï¼Œä½œç”¨åŸŸå°±æ˜¯å˜é‡ä¸å‡½æ•°çš„å¯è®¿é—®èŒƒå›´ï¼Œå³ä½œç”¨åŸŸæ§åˆ¶ç€å˜é‡å’Œå‡½æ•°çš„å¯è§æ€§å’Œç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>ES6 æ€»å…±æœ‰ä¸‰ç§ä½œç”¨äº, <strong>å…¨å±€ä½œç”¨åŸŸ</strong>,<strong>å‡½æ•°ä½œç”¨åŸŸ</strong>,<strong>å—çº§ä½œç”¨åŸŸ</strong>,å¦‚æœæ²¡æœ‰å—çº§ä½œç”¨åŸŸä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜</p>
<ul>
<li>å˜é‡å®¹æ˜“åœ¨ä¸è¢«å¯Ÿè§‰çš„æƒ…å†µä¸‹è¢«è¦†ç›–æ‰</li>
<li>æœ¬åº”é”€æ¯çš„å˜é‡æ²¡æœ‰è¢«é”€æ¯</li>
</ul>
<p>JS é€šè¿‡ <code>const</code>, <code>let</code> å®ç°å—çº§ä½œç”¨åŸŸ,åœ¨åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡çš„æ—¶å€™, è¿™ä¸¤ä¸ªå…³é”®å­—ä¼šå•ç‹¬å­˜æ”¾åœ¨<strong>è¯æ³•ç¯å¢ƒ</strong>ä¸­,è€Œ <code>var</code> å£°æ˜çš„å˜é‡äºå‡½æ•°ä¼šå­˜æ”¾åœ¨å˜é‡ç¯å¢ƒä¸­.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="number">5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯æ³•ç¯å¢ƒå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€ä¸ªå°å‹æ ˆç»“æ„ï¼Œæ ˆåº•æ˜¯å‡½æ•°æœ€å¤–å±‚çš„å˜é‡ï¼Œè¿›å…¥ä¸€ä¸ªä½œç”¨åŸŸå—åï¼Œå°±ä¼šæŠŠè¯¥ä½œç”¨åŸŸå—å†…éƒ¨çš„å˜é‡å‹åˆ°æ ˆé¡¶ï¼›å½“ä½œç”¨åŸŸæ‰§è¡Œå®Œæˆä¹‹åï¼Œè¯¥ä½œç”¨åŸŸçš„ä¿¡æ¯å°±ä¼šä»æ ˆé¡¶å¼¹å‡ºï¼Œè¿™å°±æ˜¯è¯æ³•ç¯å¢ƒçš„ç»“æ„ã€‚è¿™é‡Œæ‰€è®²çš„å˜é‡æ˜¯æŒ‡é€šè¿‡ let æˆ–è€… const å£°æ˜çš„å˜é‡ã€‚</p>
<p><img src="/posts/b672c2864ca4/0001.webp"></p>
<p>æŸ¥æ‰¾æ–¹å¼æ˜¯ï¼šæ²¿ç€è¯æ³•ç¯å¢ƒçš„æ ˆé¡¶å‘ä¸‹æŸ¥è¯¢ï¼Œå¦‚æœåœ¨è¯æ³•ç¯å¢ƒä¸­çš„æŸä¸ªå—ä¸­æŸ¥æ‰¾åˆ°äº†ï¼Œå°±ç›´æ¥è¿”å›ç»™ JavaScript å¼•æ“ï¼Œå¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œé‚£ä¹ˆç»§ç»­åœ¨å˜é‡ç¯å¢ƒä¸­æŸ¥æ‰¾ã€‚</p>
<p><img src="/posts/b672c2864ca4/0002.webp"></p>
<h4 id="ä½œç”¨åŸŸé“¾äºè¯æ³•ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸé“¾äºè¯æ³•ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸé“¾äºè¯æ³•ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸé“¾äºè¯æ³•ä½œç”¨åŸŸ</h4><p><strong>ä½œç”¨åŸŸé“¾æ˜¯ç”±è¯æ³•ä½œç”¨åŸŸå†³å®šçš„.</strong></p>
<p>ä¸‹é¢çš„ä»£ç å½“ <code>bar</code> åœ¨ <code>foo</code> å†…éƒ¨è°ƒç”¨çš„æ—¶å€™, ä¼šå…ˆæŸ¥æ‰¾è‡ªå·±çš„è¯æ³•ç¯å¢ƒä¸­æœ‰æ²¡æœ‰ <code>name</code>, ç„¶åæŸ¥æ‰¾è‡ªå·±çš„ç¯å¢ƒå˜é‡.</p>
<p>ä½†æ˜¯å½“å‘ç°éƒ½æ²¡æœ‰çš„æ—¶å€™å¹¶ä¸ä¼šåœ¨ <code>foo</code> çš„è¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒä¸­æŸ¥æ‰¾,è€Œæ˜¯ç›´æ¥æŸ¥æ‰¾å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„è¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">  <span class="title function_">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;tow&quot;</span>;</span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å˜é‡æŸ¥æ‰¾é¡ºåºçš„å°±æ˜¯ä½œç”¨åŸŸé“¾,å…¶å®åœ¨æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡ç¯å¢ƒä¸­ï¼Œéƒ½åŒ…å«äº†ä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ï¼Œç”¨æ¥æŒ‡å‘å¤– éƒ¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªå¤–éƒ¨å¼•ç”¨ç§°ä¸º <code>outer</code>. ä½†æ˜¯<strong>å†³å®šä½œç”¨åŸŸé“¾çš„ä¸æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡,è€Œæ˜¯è¯æ³•ä½œç”¨åŸŸ</strong></p>
<p><strong>è¯æ³•ä½œç”¨åŸŸå°±æ˜¯æŒ‡ä½œç”¨åŸŸæ˜¯ç”±ä»£ç ä¸­å‡½æ•°å£°æ˜çš„ä½ç½®æ¥å†³å®šçš„ï¼Œæ‰€ä»¥è¯æ³•ä½œç”¨åŸŸæ˜¯é™æ€çš„ä½œç”¨åŸŸï¼Œé€šè¿‡å®ƒå°±èƒ½å¤Ÿé¢„æµ‹ä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚ä½•æŸ¥æ‰¾æ ‡è¯†ç¬¦ã€‚</strong></p>
<p><code>foo</code> å’Œ <code>bar</code> çš„ä¸Šçº§ä½œç”¨åŸŸéƒ½æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œæ‰€ä»¥å¦‚æœ foo æˆ–è€… bar å‡½æ•°ä½¿ç”¨äº†ä¸€ä¸ªå®ƒä»¬æ²¡æœ‰å®šä¹‰çš„å˜é‡ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šåˆ°å…¨å±€ä½œç”¨åŸŸå»æŸ¥æ‰¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯æ³•ä½œç”¨åŸŸæ˜¯ä»£ç ç¼–è¯‘é˜¶æ®µå°±å†³å®šå¥½çš„ï¼Œå’Œå‡½æ•°æ˜¯æ€ä¹ˆè°ƒç”¨çš„æ²¡æœ‰å…³ç³»ã€‚</p>
<h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p><strong>æ ¹æ®è¯æ³•ä½œç”¨åŸŸçš„è§„åˆ™ï¼Œå†…éƒ¨å‡½æ•° getName å’Œ setName æ€»æ˜¯å¯ä»¥è®¿é—®å®ƒä»¬çš„å¤–éƒ¨å‡½æ•° foo ä¸­çš„å˜é‡</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> name = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">setName</span>(<span class="params">_name</span>) &#123;</span><br><span class="line">      name = _name;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="title function_">foo</span>();</span><br><span class="line">bar.<span class="title function_">setName</span>(<span class="string">&quot;two&quot;</span>);</span><br><span class="line">bar.<span class="title function_">getName</span>();</span><br></pre></td></tr></table></figure>

<p>å½“ obj å¯¹è±¡è¿”å›ç»™å…¨å±€å˜é‡ bar æ—¶ï¼Œè™½ç„¶ foo å‡½æ•°å·²ç»æ‰§è¡Œç»“æŸï¼Œä½†æ˜¯ getName å’Œ setName å‡½æ•°ä¾ç„¶å¯ä»¥ä½¿ç”¨ foo å‡½æ•°ä¸­çš„å˜é‡ name.</p>
<p>è™½ç„¶ foo å‡½æ•°æ‰§è¡Œç»“æŸåæ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»ä»è°ƒç”¨æ ˆä¸­å¼¹å‡º,ä½†æ˜¯ç”±äº obj å¯¹è±¡çš„æ–¹æ³•ä½¿ç”¨äº†å†…éƒ¨ name å˜é‡,æ‰€ä»¥ name å˜é‡è¿˜æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­,è€Œä¿å­˜ name å˜é‡ç§°ä½œé—­åŒ…. æ— è®ºåœ¨é‚£é‡Œè°ƒç”¨ obj å¯¹è±¡çš„æ–¹æ³•,éƒ½å¯ä»¥è®¿é—®åˆ° name å˜é‡.</p>
<p><strong>åœ¨ JavaScript ä¸­ï¼Œæ ¹æ®è¯æ³•ä½œç”¨åŸŸçš„è§„åˆ™ï¼Œå†…éƒ¨å‡½æ•°æ€»æ˜¯å¯ä»¥è®¿é—®å…¶å¤–éƒ¨å‡½æ•°ä¸­å£°æ˜çš„å˜é‡ï¼Œå½“é€šè¿‡è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å‡½æ•°è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½æ•°åï¼Œå³ä½¿è¯¥å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œç»“æŸäº†ï¼Œä½†æ˜¯å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ä¾ç„¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬å°±æŠŠè¿™äº›å˜é‡çš„é›†åˆç§°ä¸ºé—­åŒ…ã€‚</strong></p>
<p>è€Œè°ƒç”¨ obj æ–¹æ³•çš„æ—¶å€™,ä½œç”¨åŸŸé“¾çš„é¡ºåºå°±æ˜¯:å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡â€“&gt;foo å‡½æ•°é—­åŒ…â€“&gt; å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</p>
<h4 id="é—­åŒ…å›æ”¶"><a href="#é—­åŒ…å›æ”¶" class="headerlink" title="é—­åŒ…å›æ”¶"></a>é—­åŒ…å›æ”¶</h4><p>å¦‚æœå¼•ç”¨é—­åŒ…çš„å‡½æ•°æ˜¯ä¸ªå±€éƒ¨å˜é‡ï¼Œç­‰å‡½æ•°é”€æ¯åï¼Œåœ¨ä¸‹æ¬¡ JavaScript å¼•æ“æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œåˆ¤æ–­é—­åŒ…è¿™å—å†…å®¹å¦‚æœå·²ç»ä¸å†è¢«ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆ JavaScript å¼•æ“çš„åƒåœ¾å›æ”¶å™¨å°±ä¼šå›æ”¶è¿™å—å†…å­˜ã€‚</p>
<p><strong>å¦‚æœè¯¥é—­åŒ…ä¼šä¸€ç›´ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä½œä¸ºå…¨å±€å˜é‡è€Œå­˜åœ¨ï¼›ä½†å¦‚æœä½¿ç”¨é¢‘ç‡ä¸é«˜ï¼Œè€Œä¸”å ç”¨å†…å­˜åˆæ¯”è¾ƒå¤§çš„è¯ï¼Œé‚£å°±å°½é‡è®©å®ƒæˆä¸ºä¸€ä¸ªå±€éƒ¨å˜é‡ã€‚</strong></p>
<h4 id="this"><a href="#this" class="headerlink" title="this"></a>this</h4><p>å®ç° this çš„ä¸€ä¸ªåˆè¡·å°±æ˜¯ <strong>åœ¨å¯¹è±¡å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨å¯¹è±¡å†…éƒ¨çš„å±æ€§</strong></p>
<p>å› ä¸ºä½œç”¨åŸŸé“¾ç”±è¯æ³•ä½œç”¨åŸŸå†³å®š,æ‰€ä»¥è°ƒç”¨ getName å¹¶ä¸ä¼šè·å–å¯¹è±¡å±æ€§è€Œæ˜¯åœ¨å…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;one&quot;</span>,</span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„-this"><a href="#å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„-this" class="headerlink" title="å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this"></a>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this</h5><p>this å’Œä½œç”¨åŸŸé“¾çš„å”¯ä¸€äº¤ç‚¹ï¼Œä½œç”¨åŸŸé“¾çš„æœ€åº•ç«¯åŒ…å«äº† window å¯¹è±¡ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this ä¹Ÿæ˜¯æŒ‡å‘ window å¯¹è±¡ã€‚</p>
<p>è¿™ç§è®¾è®¡å¾ˆå®¹æ˜“è¯¯æ“ä½œ,æ‰€ä»¥ä¸¥æ ¼æ¨¡å¼ä¸‹é»˜è®¤æ‰§è¡Œä¸€ä¸ªå‡½æ•° this ä¸º undefined</p>
<h5 id="å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„-this"><a href="#å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„-this" class="headerlink" title="å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this"></a>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this</h5><p>ç›´æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå…¶æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ this ä¹Ÿæ˜¯æŒ‡å‘ window å¯¹è±¡çš„. ä½†æ˜¯å¯ä»¥é€šè¿‡ <code>call</code> <code>apply</code> <code>bind</code> ä¿®æ”¹ this çš„æŒ‡å‘</p>
<h5 id="é€šè¿‡å¯¹è±¡è°ƒç”¨æ–¹æ³•-this"><a href="#é€šè¿‡å¯¹è±¡è°ƒç”¨æ–¹æ³•-this" class="headerlink" title="é€šè¿‡å¯¹è±¡è°ƒç”¨æ–¹æ³• this"></a>é€šè¿‡å¯¹è±¡è°ƒç”¨æ–¹æ³• this</h5><p>this æ˜¯æŒ‡å‘å¯¹è±¡æœ¬èº«çš„ã€‚ ä¹Ÿå¯ä»¥ç†è§£ä¸ºåœ¨è°ƒç”¨çš„æ—¶å€™è½¬åŒ–ä¸ºäº†è¿™æ ·çš„å½¢å¼ <code>myObj.showThis.call(myObj)</code></p>
<h4 id="æ„é€ å‡½æ•°ä¸­çš„-this"><a href="#æ„é€ å‡½æ•°ä¸­çš„-this" class="headerlink" title="æ„é€ å‡½æ•°ä¸­çš„ this"></a>æ„é€ å‡½æ•°ä¸­çš„ this</h4><p>this æŒ‡å‘åˆ›å»ºçš„å®ä¾‹. new æ“ä½œç¬¦å®é™…ä¸Šåšäº†ä¸€ä¸‹å‡ ä»¶äº‹.</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›</li>
<li>ä¸ºæ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§__proto__ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ ï¼›</li>
<li>å°†æ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º this çš„ä¸Šä¸‹æ–‡ ï¼›</li>
<li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› thisã€‚</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6%E5%9F%BA%E7%A1%80/" rel="tag">ES6åŸºç¡€</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-broswer/æµè§ˆå™¨ç›¸å…³çŸ¥è¯†"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/fe6954b3445e/"
    >æµè§ˆå™¨ç›¸å…³çŸ¥è¯†ç‚¹</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/fe6954b3445e/" class="article-date">
  <time datetime="2022-05-22T05:38:27.000Z" itemprop="datePublished">2022-05-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">æµè§ˆå™¨</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="Web-åº”ç”¨è¶‹åŠ¿"><a href="#Web-åº”ç”¨è¶‹åŠ¿" class="headerlink" title="Web åº”ç”¨è¶‹åŠ¿"></a>Web åº”ç”¨è¶‹åŠ¿</h4><ul>
<li><p><strong>åº”ç”¨ç¨‹åº Web åŒ–</strong>,è§†é¢‘ , éŸ³é¢‘ ,æ¸¸æˆçš„å æ¯”è¶Šæ¥è¶Šé«˜</p>
</li>
<li><p><strong>æ˜¯ Web åº”ç”¨ç§»åŠ¨åŒ–</strong>, Google æ¨å‡ºäº† PWA æ–¹æ¡ˆæ¥æ•´åˆ Web å’Œæœ¬åœ°ç¨‹åºå„è‡ªçš„ä¼˜åŠ¿</p>
</li>
<li><p><strong>Web æ“ä½œç³»ç»ŸåŒ–</strong> ,å¯èƒ½ä»¥åæµè§ˆå™¨ä¼šæä¾›æ›´å¤šçš„æ¨¡å—ç»™ä¸Šå±‚åº”ç”¨ä½¿ç”¨,å¦‚æ–°æ”¯æŒçš„ WebAssemblyï¼›</p>
</li>
</ul>
<h4 id="OSI-ä¸ƒå±‚ç½‘ç»œæ¨¡å‹"><a href="#OSI-ä¸ƒå±‚ç½‘ç»œæ¨¡å‹" class="headerlink" title="OSI ä¸ƒå±‚ç½‘ç»œæ¨¡å‹"></a>OSI ä¸ƒå±‚ç½‘ç»œæ¨¡å‹</h4><ul>
<li>åº”ç”¨å±‚ï¼š HTTP,HTTPS,FTP,NFS,FMTP,DHCP,SNMP,TELNET,POP3,IRC,NNTP è¿™äº›åº”ç”¨å±‚åè®®ä¸ºåº”ç”¨æä¾›æœåŠ¡ï¼Œå¯ä»¥æ‰§è¡Œç”¨æˆ·æ´»åŠ¨ã€‚</li>
<li>è¡¨ç¤ºå±‚ï¼š ä»åº”ç”¨å±‚æ¥å—æ•°æ®ï¼Œå¹¶å°† ASCII ç è½¬åŒ–ä¸º EBCDIC ç (äºŒè¿›åˆ¶),æ‰§è¡Œæ•°æ®å‹ç¼©ï¼ˆæœ‰æŸ&#x2F;æ— æŸï¼‰,ä½¿ç”¨ SSL (åŠ å¯†&#x2F;è§£å¯†)ä¿è¯æ•°æ®å®‰å…¨ã€‚</li>
<li>ä¼šè¯å±‚: ä¼šè¯ç®¡ç†ï¼Œèº«ä»½éªŒè¯ï¼Œæˆæƒæ–¹é¢</li>
<li>ä¼ è¾“å±‚ï¼šTCP,UDP, æµé‡æ§åˆ¶ï¼Œæ•°æ®æ ¡éªŒ</li>
<li>ç½‘ç»œå±‚ï¼šIP é€»è¾‘å¯»å€</li>
<li>æ•°æ®é“¾å±‚ï¼š æ•°æ®å•å…ƒè¢«ç§°ä¹‹ä¸ºå¸§</li>
<li>ç‰©ç†å±‚ï¼šä¼ è¾“ç‰©ç†ä¿¡å·</li>
</ul>
<h4 id="è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹"></a>è¿›ç¨‹ä¸çº¿ç¨‹</h4><p><strong>è¿›ç¨‹</strong>æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹,å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚ <strong>çº¿ç¨‹æ˜¯ä¾é™„äºè¿›ç¨‹çš„ï¼Œè€Œè¿›ç¨‹ä¸­ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†èƒ½æå‡è¿ç®—æ•ˆç‡ã€‚</strong></p>
<p><img src="/posts/fe6954b3445e/0001.webp"></p>
<p>è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»æœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p>
<ul>
<li><p>è¿›ç¨‹ä¸­çš„ä»»æ„ä¸€çº¿ç¨‹æ‰§è¡Œå‡ºé”™ï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹çš„å´©æºƒã€‚</p>
</li>
<li><p>çº¿ç¨‹ä¹‹é—´å¯ä»¥å¯¹è¿›ç¨‹çš„å…¬å…±æ•°æ®è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
</li>
<li><p>å½“ä¸€ä¸ªè¿›ç¨‹å…³é—­ä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šå›æ”¶è¿›ç¨‹æ‰€å ç”¨çš„å†…å­˜ã€‚</p>
<p>è™½ç„¶æœ‰äº›ç¨‹åºå› ä¸ºä»£ç åŸå› ,æˆ–å®‰è£…äº†é¢å¤–çš„æ’ä»¶,å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼.ä½†åªè¦å…³é—­è¿›ç¨‹,å†…å­˜å°±ä¼šè¢«å›æ”¶.</p>
</li>
<li><p>è¿›ç¨‹ä¹‹é—´çš„å†…å®¹ç›¸äº’éš”ç¦»ã€‚</p>
<p>è¿›ç¨‹éš”ç¦»æ˜¯ä¸ºä¿æŠ¤æ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹äº’ä¸å¹²æ‰°çš„æŠ€æœ¯ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±å æœ‰çš„æ•°æ®.æ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹å¦‚æœå´©æºƒäº†ï¼Œæˆ–è€…æŒ‚èµ·äº†ï¼Œæ˜¯ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹çš„ã€‚å¦‚æœè¿›ç¨‹ä¹‹é—´éœ€è¦è¿›è¡Œæ•°æ®çš„é€šä¿¡ï¼Œè¿™æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨ç”¨äºè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„æœºåˆ¶äº†ã€‚</p>
</li>
</ul>
<p>ç›®å‰æµè§ˆå™¨ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªè¿›ç¨‹, <a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/extensions/reference/api/processes#enum">æŸ¥çœ‹ Chrome çš„è¿›ç¨‹ç±»å‹</a></p>
<ul>
<li><p><strong>1 ä¸ªæµè§ˆå™¨è¿›ç¨‹</strong>ã€‚ä¸»è¦è´Ÿè´£ç•Œé¢æ˜¾ç¤ºã€ç”¨æˆ·äº¤äº’ã€å­è¿›ç¨‹ç®¡ç†ï¼ŒåŒæ—¶æä¾›å­˜å‚¨ç­‰åŠŸèƒ½</p>
</li>
<li><p><strong>å¤šä¸ªæ¸²æŸ“è¿›ç¨‹</strong>ã€‚æ ¸å¿ƒä»»åŠ¡æ˜¯å°† HTMLã€CSS å’Œ JavaScript è½¬æ¢ä¸ºç”¨æˆ·å¯ä»¥ä¸ä¹‹äº¤äº’çš„ç½‘é¡µï¼Œæ’ç‰ˆå¼•æ“ Blink å’Œ JavaScript å¼•æ“ V8 éƒ½æ˜¯è¿è¡Œåœ¨è¯¥è¿›ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒChrome ä¼šä¸ºæ¯ä¸ª Tab æ ‡ç­¾åˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæ¸²æŸ“è¿›ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨æ²™ç®±æ¨¡å¼ä¸‹ã€‚</p>
</li>
<li><p><strong>1 ä¸ª GPU è¿›ç¨‹</strong>ã€‚å…¶å®ï¼ŒChrome åˆšå¼€å§‹å‘å¸ƒçš„æ—¶å€™æ˜¯æ²¡æœ‰ GPU è¿›ç¨‹çš„ã€‚è€Œ GPU çš„ä½¿ç”¨åˆè¡·æ˜¯ä¸ºäº†å®ç° 3D CSS çš„æ•ˆæœï¼Œåªæ˜¯éšåç½‘é¡µã€Chrome çš„ UI ç•Œé¢éƒ½é€‰æ‹©é‡‡ç”¨ GPU æ¥ç»˜åˆ¶ï¼Œè¿™ä½¿å¾— GPU æˆä¸ºæµè§ˆå™¨æ™®éçš„éœ€æ±‚ã€‚æœ€åï¼ŒChrome åœ¨å…¶å¤šè¿›ç¨‹æ¶æ„ä¸Šä¹Ÿå¼•å…¥äº† GPU è¿›ç¨‹ã€‚</p>
</li>
<li><p><strong>1 ä¸ªç½‘ç»œè¿›ç¨‹</strong>ã€‚ä¸»è¦è´Ÿè´£é¡µé¢çš„ç½‘ç»œèµ„æºåŠ è½½ï¼Œä¹‹å‰æ˜¯ä½œä¸ºä¸€ä¸ªæ¨¡å—è¿è¡Œåœ¨æµè§ˆå™¨è¿›ç¨‹é‡Œé¢çš„ï¼Œåé¢ç‹¬ç«‹å‡ºæ¥ï¼Œæˆä¸ºä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ã€‚</p>
</li>
<li><p><strong>å¤šä¸ªæ’ä»¶è¿›ç¨‹</strong>ã€‚ä¸»è¦æ˜¯è´Ÿè´£æ’ä»¶çš„è¿è¡Œï¼Œå› æ’ä»¶æ˜“å´©æºƒï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æ’ä»¶è¿›ç¨‹æ¥éš”ç¦»ï¼Œä»¥ä¿è¯æ’ä»¶è¿›ç¨‹å´©æºƒä¸ä¼šå¯¹æµè§ˆå™¨å’Œé¡µé¢é€ æˆå½±å“ã€‚</p>
</li>
</ul>
<p>æ¸²æŸ“è¿›ç¨‹çš„ä¸ªæ•°å¦‚ä½•è®¡ç®—ï¼š</p>
<ul>
<li>å¦‚æœä»ä¸€ä¸ªæ ‡ç­¾é¡µä¸­æ‰“å¼€äº†å¦ä¸€ä¸ªæ–°æ ‡ç­¾é¡µï¼Œå½“æ–°æ ‡ç­¾é¡µå’Œå½“å‰æ ‡ç­¾é¡µå±äºåŒä¸€ç«™ç‚¹çš„è¯ï¼Œé‚£ä¹ˆæ–°æ ‡ç­¾é¡µä¼šå¤ç”¨å½“å‰æ ‡ç­¾é¡µçš„æ¸²æŸ“è¿›ç¨‹ã€‚ <strong>Chrome æµè§ˆå™¨ä¼šå°†æµè§ˆä¸Šä¸‹æ–‡ç»„ä¸­å±äºåŒä¸€ç«™ç‚¹çš„æ ‡ç­¾åˆ†é…åˆ°åŒä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ä¸­,è¦åŒæ—¶æ»¡è¶³ A å’Œ B å±äºåŒä¸€ç«™ç‚¹ï¼Œä¸” A å’Œ B ä¹‹é—´æœ‰é“¾æ¥å…³ç³»</strong><br><code>&lt;a&gt;</code> å…ƒç´ çš„ rel å±æ€§ä¸º <code>noopener noreferrer</code> æ—¶ä¼šé˜»æ­¢ä½¿ç”¨åŒä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚</li>
<li>chrome æµè§ˆå™¨å®ç°äº†ç«™ç‚¹éš”ç¦»ï¼Œæ‰€ä»¥ iframe ä¹Ÿä¼šéµå¾ªä»¥ä¸‹çš„æ¸²æŸ“è§„åˆ™ï¼Œå¦‚æœå’Œçˆ¶é¡µé¢å±äºåŒä¸€ç«™ç‚¹ï¼Œä¸”æœ‰é“¾æ¥å…³ç³»ï¼Œä¹Ÿä¼šè¿è¡Œåœ¨ç›¸åŒçš„æ¸²æŸ“è¿›ç¨‹ä¸­ã€‚</li>
</ul>
<h4 id="è¯·æ±‚çš„å„ä¸ªé˜¶æ®µ"><a href="#è¯·æ±‚çš„å„ä¸ªé˜¶æ®µ" class="headerlink" title="è¯·æ±‚çš„å„ä¸ªé˜¶æ®µ"></a>è¯·æ±‚çš„å„ä¸ªé˜¶æ®µ</h4><p><img src="/posts/fe6954b3445e/004.webp"></p>
<h4 id="DNS-åŸŸåè§£æè¿‡ç¨‹"><a href="#DNS-åŸŸåè§£æè¿‡ç¨‹" class="headerlink" title="DNS åŸŸåè§£æè¿‡ç¨‹"></a>DNS åŸŸåè§£æè¿‡ç¨‹</h4><p>åŸŸåä½¿ç”¨ <code>.</code> åˆ’åˆ†, æœ€åç”±æ ¹åŸŸåæœåŠ¡å™¨ç»Ÿä¸€ç®¡ç†ï¼Œæ ¹åŸŸåæœåŠ¡å™¨æ˜¯ä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ï¼Œæœ‰åå‡ ä¸ªæ ¹åŸŸåï¼Œä½†æ˜¯æœ‰ä¸€åƒå¤šå°æ ¹åŸŸåæœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦é€šè¿‡<strong>ä»»æ’­</strong>æŠ€æœ¯æ‰¾åˆ°æœ€è¿‘çš„ä¸€å°æ ¹åŸŸåæœåŠ¡å™¨ã€‚</p>
<p>é¡¶çº§åŸŸåæœåŠ¡å™¨ä¼šç®¡ç† <code>.net</code> <code>.com</code> è¿™äº›åŸŸåï¼Œ æƒå¨åŸŸåæœåŠ¡å™¨ä¼šç®¡ç† <code>.qq</code> <code>baidu</code> è¿™äº›åŸŸåã€‚</p>
<ul>
<li><p>å‘èµ·è§£æå‰ä¼šæ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç¼“å­˜æ–‡ä»¶ã€‚</p>
</li>
<li><p>è°ƒç”¨ DNS å®¢æˆ·ç«¯å‘èµ·æŸ¥è¯¢è¯·æ±‚ï¼Œæœ¬åœ°çš„ DNS æœåŠ¡ç«¯ä¸€èˆ¬æœ‰äº’è”ç½‘æœåŠ¡æä¾›å•†(ISP)ç®¡ç†ï¼ŒDNS æœåŠ¡ç«¯ä¼šæŸ¥è¯¢æ˜¯å¦æœ‰ç¼“å­˜,å¦‚æœæœ‰åˆ™è¿”å›å¸¦æœ‰ Non-authoritative å­—æ®µçš„æ•°æ®ã€‚å¦‚æœæ˜¯æ ¹åŸŸåæœåŠ¡å™¨åˆ™è¿”å›å¸¦æœ‰ Authoritative çš„å­—æ®µã€‚ç¼“å­˜éœ€è¦å®šæœŸæ›´æ–°ã€‚<br>DNS è¿­ä»£æŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨çš„æ—¶ UDP è¯·æ±‚ï¼Œæ•°æ®é‡æ¯”è¾ƒå°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª UDP åŒ…è¿”å›ï¼Œæ¯”è¾ƒæ³¨é‡æ•ˆç‡ã€‚æ›´æ–°ç¼“å­˜æ—¶ä½¿ç”¨çš„æ—¶ TCP æŸ¥è¯¢ã€‚</p>
</li>
<li><p>è·å–æœ€è¿‘çš„æ ¹åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼ŒæŸ¥è¯¢ <code>.com</code> åŸŸåçš„æœåŠ¡å™¨åœ°å€ã€‚</p>
</li>
<li><p>è·å–æœ€è¿‘çš„ <code>.com</code> æœåŠ¡å™¨çš„åœ°å€ï¼ŒæŸ¥è¯¢ <code>baidu.com</code> çš„æœåŠ¡å™¨åœ°å€ã€‚</p>
</li>
<li><p>è·å–æœ€è¿‘çš„ <code>baidu.com</code> æƒå¨åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼ŒæŸ¥è¯¢ <code>mail.baidu.com</code> å¯¹åº”çš„ IPã€‚</p>
</li>
<li><p>å¯èƒ½ä¼šè¿”å› <code>mail.baidu.com</code> å¯¹åº”çš„ CDN(å†…å®¹åˆ†å‘æœåŠ¡å™¨) åœ°å€,è¿™å°±æ˜¯æœ€ç»ˆçš„åœ°å€ã€‚</p>
</li>
</ul>
<h6 id="DNS-é¢„è§£æ"><a href="#DNS-é¢„è§£æ" class="headerlink" title="DNS é¢„è§£æ"></a>DNS é¢„è§£æ</h6><p>dns-prefetch(DNS é¢„è·å–)æ˜¯å‰ç«¯ç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„ä¸€ç§æªæ–½ã€‚å®ƒæ ¹æ®æµè§ˆå™¨å®šä¹‰çš„è§„åˆ™ï¼Œæå‰è§£æä¹‹åå¯èƒ½ä¼šç”¨åˆ°çš„åŸŸåï¼Œä½¿è§£æç»“æœç¼“å­˜åˆ°ç³»ç»Ÿç¼“å­˜ä¸­ï¼Œç¼©çŸ­ DNS è§£ææ—¶é—´ï¼Œè¿›è€Œæé«˜ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ã€‚</p>
<p>æ¯å½“åœ¨é¦–æ¬¡ DNS è§£æåä¼šå¯¹å…¶ IP è¿›è¡Œç¼“å­˜ã€‚è‡³äºç¼“å­˜æ—¶é•¿ï¼Œæ¯ç§æµè§ˆå™¨éƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ Chrome çš„è¿‡æœŸæ—¶é—´æ˜¯ 1 åˆ†é’Ÿï¼Œåœ¨è¿™ä¸ªæœŸé™å†…ä¸ä¼šé‡æ–°è¯·æ±‚ DNSã€‚</p>
<p>æ¯å½“ Chrome æµè§ˆå™¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨çš„å¿«é€Ÿè§£ææµè§ˆå™¨æœ€è¿‘ä¸€æ¬¡å¯åŠ¨æ—¶è®°å½•çš„å‰ 10 ä¸ªåŸŸåã€‚æ‰€ä»¥ç»å¸¸è®¿é—®çš„ç½‘å€å°±ä¸å­˜åœ¨ DNS è§£æçš„å»¶è¿Ÿï¼Œè¿›è€Œæ‰“å¼€é€Ÿåº¦æ›´å¿«ã€‚</p>
<ul>
<li><p>dns-prefetch ä»…å¯¹è·¨åŸŸåŸŸä¸Šçš„ DNS æŸ¥æ‰¾æœ‰æ•ˆï¼Œå› æ­¤è¯·é¿å…ä½¿ç”¨å®ƒæ¥æŒ‡å‘ç›¸åŒåŸŸã€‚è¿™æ˜¯å› ä¸ºï¼Œåˆ°æµè§ˆå™¨çœ‹åˆ°æç¤ºæ—¶ï¼Œæ‚¨ç«™ç‚¹åŸŸèƒŒåçš„ IP å·²ç»è¢«è§£æã€‚</p>
</li>
<li><p>http é¡µé¢ä¸‹æ‰€æœ‰çš„ a æ ‡ç­¾çš„ href éƒ½ä¼šè‡ªåŠ¨å»å¯ç”¨ DNS Prefetchï¼Œä¹Ÿå°±æ˜¯è¯´ç½‘é¡µçš„ a æ ‡ç­¾ href å¸¦çš„åŸŸåï¼Œæ˜¯ä¸éœ€è¦åœ¨ head é‡Œé¢åŠ ä¸Š link æ‰‹åŠ¨è®¾ç½®çš„ã€‚</p>
<p>å¯ä»¥é€šè¿‡åœ¨æœåŠ¡å™¨ç«¯å‘é€ X-DNS-Prefetch-Control æŠ¥å¤´ï¼Œæˆ–æ˜¯åœ¨æ–‡æ¡£ä¸­ä½¿ç”¨å€¼ä¸º http-equiv çš„ <code>&lt;meta&gt;</code> æ ‡ç­¾ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;x-dns-prefetch-control&quot;</span> <span class="attr">content</span>=<span class="string">&quot;on&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼ºåˆ¶æŸ¥è¯¢ç‰¹å®šä¸»æœºå,ä½¿ç”¨ rel å±æ€§å€¼ä¸º link type ä¸­çš„ dns-prefetch çš„ æ ‡ç­¾æ¥å¯¹ç‰¹å®šåŸŸåè¿›è¡Œé¢„è¯»å–ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;dns-prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com/&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Keep-Alive"><a href="#Keep-Alive" class="headerlink" title="Keep-Alive"></a>Keep-Alive</h5><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€æ—¦æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›äº†è¯·æ±‚æ•°æ®ï¼Œå®ƒå°±è¦å…³é—­ TCP è¿æ¥ã€‚ä¸è¿‡å¦‚æœæµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨åœ¨å…¶å¤´ä¿¡æ¯ä¸­åŠ å…¥äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection:Keep-Alive</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ TCP è¿æ¥åœ¨å‘é€åå°†ä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œè¿™æ ·æµè§ˆå™¨å°±å¯ä»¥ç»§ç»­é€šè¿‡åŒä¸€ä¸ª TCP è¿æ¥å‘é€è¯·æ±‚ã€‚ä¿æŒ TCP è¿æ¥å¯ä»¥çœå»ä¸‹æ¬¡è¯·æ±‚æ—¶éœ€è¦å»ºç«‹è¿æ¥çš„æ—¶é—´ï¼Œæå‡èµ„æºåŠ è½½é€Ÿåº¦ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª Web é¡µé¢ä¸­å†…åµŒçš„å›¾ç‰‡å°±éƒ½æ¥è‡ªåŒä¸€ä¸ª Web ç«™ç‚¹ï¼Œå¦‚æœåˆå§‹åŒ–äº†ä¸€ä¸ªæŒä¹…è¿æ¥ï¼Œä½ å°±å¯ä»¥å¤ç”¨è¯¥è¿æ¥ï¼Œä»¥è¯·æ±‚å…¶ä»–èµ„æºï¼Œè€Œä¸éœ€è¦é‡æ–°å†å»ºç«‹æ–°çš„ TCP è¿æ¥ã€‚</p>
<h4 id="å¦‚ä½•ä¿è¯é¡µé¢æ–‡ä»¶èƒ½è¢«å®Œæ•´åœ°é€è¾¾æµè§ˆå™¨ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯é¡µé¢æ–‡ä»¶èƒ½è¢«å®Œæ•´åœ°é€è¾¾æµè§ˆå™¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯é¡µé¢æ–‡ä»¶èƒ½è¢«å®Œæ•´åœ°é€è¾¾æµè§ˆå™¨ï¼Ÿ"></a>å¦‚ä½•ä¿è¯é¡µé¢æ–‡ä»¶èƒ½è¢«å®Œæ•´åœ°é€è¾¾æµè§ˆå™¨ï¼Ÿ</h4><p>åœ¨ç½‘ç»œä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶é€šå¸¸ä¼šè¢«æ‹†åˆ†ä¸ºå¾ˆå¤šæ•°æ®åŒ…æ¥è¿›è¡Œä¼ è¾“ï¼Œè€Œæ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åˆæœ‰å¾ˆå¤§æ¦‚ç‡ä¸¢å¤±æˆ–è€…å‡ºé”™ã€‚</p>
<p>è”ç½‘ï¼Œå®é™…ä¸Šæ˜¯ä¸€å¥—ç†å¿µå’Œåè®®ç»„æˆçš„ä½“ç³»æ¶æ„ã€‚å…¶ä¸­ï¼Œåè®®æ˜¯ä¸€å¥—ä¼—æ‰€å‘¨çŸ¥çš„è§„åˆ™å’Œæ ‡å‡†ï¼Œå¦‚æœå„æ–¹éƒ½åŒæ„ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„é€šä¿¡å°†å˜å¾—æ¯«æ— éšœç¢ã€‚</p>
<h5 id="IPï¼šæŠŠæ•°æ®åŒ…é€è¾¾ç›®çš„ä¸»æœº"><a href="#IPï¼šæŠŠæ•°æ®åŒ…é€è¾¾ç›®çš„ä¸»æœº" class="headerlink" title="IPï¼šæŠŠæ•°æ®åŒ…é€è¾¾ç›®çš„ä¸»æœº"></a>IPï¼šæŠŠæ•°æ®åŒ…é€è¾¾ç›®çš„ä¸»æœº</h5><p>æ•°æ®åŒ…è¦åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œä¼ è¾“ï¼Œå°±è¦ç¬¦åˆç½‘é™…åè®®ï¼ˆInternet Protocolï¼Œç®€ç§° IPï¼‰æ ‡å‡†, è®¿é—®ç½‘ç«™å°±æ˜¯å‘å¦ä¸€å°æœ‰æ˜ç¡®åœ°å€çš„è®¡ç®—æœºè¯·æ±‚ä¿¡æ¯.</p>
<p>æƒ³é€šä¿¡ä¸€å®šè¦çŸ¥é“åŒæ–¹ IP åœ°å€, <strong>è¿™äº›é™„åŠ çš„ä¿¡æ¯ä¼šè¢«è£…è¿›ä¸€ä¸ªå« IP å¤´çš„æ•°æ®ç»“æ„é‡Œã€‚IP å¤´æ˜¯ IP æ•°æ®åŒ…å¼€å¤´çš„ä¿¡æ¯ï¼ŒåŒ…å« IP ç‰ˆæœ¬ã€æº IP åœ°å€ã€ç›®æ ‡ IP åœ°å€ã€ç”Ÿå­˜æ—¶é—´ç­‰ä¿¡æ¯</strong></p>
<ul>
<li>å°†è¦å‘é€çš„æ•°æ®äº¤ç»™ç½‘ç»œè¿›ç¨‹</li>
<li>åˆ›å»º IP å¤´å¹¶é™„åŠ åˆ°æ•°æ®åŒ…ä¸Šï¼Œå¹¶äº¤ç»™åº•å±‚ä¼ è¾“</li>
<li>åº•å±‚é€šè¿‡ç‰©ç†ç½‘ç»œï¼Œå°†æ•°æ®å‘é€åˆ° B</li>
<li>æ•°æ®è¢«ä¼ è¾“åˆ° B çš„ç½‘ç»œå±‚ï¼Œä¼šæ‹†å¼€ IP å¤´ä¿¡æ¯ï¼Œå¹¶å°†æ•°æ®äº¤ç»™ä¸Šå±‚å¤„ç†</li>
</ul>
<h5 id="UDPï¼šæŠŠæ•°æ®åŒ…é€è¾¾åº”ç”¨ç¨‹åº"><a href="#UDPï¼šæŠŠæ•°æ®åŒ…é€è¾¾åº”ç”¨ç¨‹åº" class="headerlink" title="UDPï¼šæŠŠæ•°æ®åŒ…é€è¾¾åº”ç”¨ç¨‹åº"></a>UDPï¼šæŠŠæ•°æ®åŒ…é€è¾¾åº”ç”¨ç¨‹åº</h5><p>åˆ°è¾¾ä¸»æœºåè¿˜éœ€è¦æŠŠæ•°æ®é€ç»™åº”ç”¨,ï¼Œéœ€è¦åŸºäº IP ä¹‹ä¸Šå¼€å‘èƒ½å’Œåº”ç”¨æ‰“äº¤é“çš„åè®®ï¼Œæœ€å¸¸è§çš„æ˜¯ <strong>ç”¨æˆ·æ•°æ®åŒ…åè®®ï¼ˆUser Datagram Protocolï¼‰</strong>ï¼Œç®€ç§° UDPã€‚</p>
<p>UDP ä¸­ä¸€ä¸ªæœ€é‡è¦çš„ä¿¡æ¯æ˜¯ç«¯å£å·ï¼Œç«¯å£å·å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ¯ä¸ªæƒ³è®¿é—®ç½‘ç»œçš„ç¨‹åºéƒ½éœ€è¦ç»‘å®šä¸€ä¸ªç«¯å£å·ã€‚é€šè¿‡ç«¯å£å· UDP å°±èƒ½æŠŠæŒ‡å®šçš„æ•°æ®åŒ…å‘é€ç»™æŒ‡å®šçš„ç¨‹åºäº†ï¼Œæ‰€ä»¥ IP é€šè¿‡ IP åœ°å€ä¿¡æ¯æŠŠæ•°æ®åŒ…å‘é€ç»™æŒ‡å®šçš„ç”µè„‘ï¼Œè€Œ UDP é€šè¿‡ç«¯å£å·æŠŠæ•°æ®åŒ…åˆ†å‘ç»™æ­£ç¡®çš„ç¨‹åºã€‚å’Œ IP å¤´ä¸€æ ·ï¼Œç«¯å£å·ä¼šè¢«è£…è¿› UDP å¤´é‡Œé¢ï¼ŒUDP å¤´å†å’ŒåŸå§‹æ•°æ®åŒ…åˆå¹¶ç»„æˆæ–°çš„ UDP æ•°æ®åŒ…ã€‚UDP å¤´ä¸­é™¤äº†ç›®çš„ç«¯å£ï¼Œè¿˜æœ‰æºç«¯å£å·ç­‰ä¿¡æ¯ã€‚</p>
<p>è™½ç„¶ UDP å¯ä»¥æ ¡éªŒæ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œä½†æ˜¯å¯¹äºé”™è¯¯çš„æ•°æ®åŒ…ï¼ŒUDP å¹¶ä¸æä¾›é‡å‘æœºåˆ¶ï¼Œåªæ˜¯ä¸¢å¼ƒå½“å‰çš„åŒ…ï¼Œè€Œä¸” UDP åœ¨å‘é€ä¹‹åä¹Ÿæ— æ³•çŸ¥é“æ˜¯å¦èƒ½è¾¾åˆ°ç›®çš„åœ°ã€‚è™½è¯´ UDP ä¸èƒ½ä¿è¯æ•°æ®å¯é æ€§ï¼Œä½†æ˜¯ä¼ è¾“é€Ÿåº¦å´éå¸¸å¿«ï¼Œæ‰€ä»¥ UDP ä¼šåº”ç”¨åœ¨ä¸€äº›å…³æ³¨é€Ÿåº¦ã€ä½†ä¸é‚£ä¹ˆä¸¥æ ¼è¦æ±‚æ•°æ®å®Œæ•´æ€§çš„é¢†åŸŸï¼Œå¦‚åœ¨çº¿è§†é¢‘ã€äº’åŠ¨æ¸¸æˆç­‰ã€‚</p>
<ul>
<li>ä¼ è¾“å±‚ä¼šåœ¨æ•°æ®åŒ…å‰é¢é™„åŠ ä¸Š UDP å¤´ï¼Œç»„æˆæ–°çš„ UDP æ•°æ®åŒ…ï¼Œå†å°†æ–°çš„ UDP æ•°æ®åŒ…äº¤ç»™ç½‘ç»œå±‚</li>
<li>ç½‘ç»œå±‚å†å°† IP å¤´é™„åŠ åˆ°æ•°æ®åŒ…ä¸Šï¼Œç»„æˆæ–°çš„ IP æ•°æ®åŒ…ï¼Œå¹¶äº¤ç»™åº•å±‚ï¼›</li>
<li>æ•°æ®åŒ…è¢«ä¼ è¾“åˆ°ä¸»æœº B çš„ç½‘ç»œå±‚ï¼Œåœ¨è¿™é‡Œä¸»æœº B æ‹†å¼€ IP å¤´ä¿¡æ¯ï¼Œå¹¶å°†æ‹†å¼€æ¥çš„æ•°æ®éƒ¨åˆ†äº¤ç»™ä¼ è¾“å±‚ï¼›</li>
<li>åœ¨ä¼ è¾“å±‚ï¼Œæ•°æ®åŒ…ä¸­çš„ UDP å¤´ä¼šè¢«æ‹†å¼€ï¼Œå¹¶æ ¹æ® UDP ä¸­æ‰€æä¾›çš„ç«¯å£å·ï¼ŒæŠŠæ•°æ®éƒ¨åˆ†äº¤ç»™ä¸Šå±‚çš„åº”ç”¨ç¨‹åºï¼›</li>
</ul>
<h5 id="TCPï¼šç¡®ä¿æ•°æ®åŒ…çš„å®Œæ•´æ€§"><a href="#TCPï¼šç¡®ä¿æ•°æ®åŒ…çš„å®Œæ•´æ€§" class="headerlink" title="TCPï¼šç¡®ä¿æ•°æ®åŒ…çš„å®Œæ•´æ€§"></a>TCPï¼šç¡®ä¿æ•°æ®åŒ…çš„å®Œæ•´æ€§</h5><p>ä½¿ç”¨ UDP æ¥ä¼ è¾“ä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p>æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å®¹æ˜“ä¸¢å¤±ï¼›</p>
</li>
<li><p>å¤§æ–‡ä»¶ä¼šè¢«æ‹†åˆ†æˆå¾ˆå¤šå°çš„æ•°æ®åŒ…æ¥ä¼ è¾“ï¼Œè¿™äº›å°çš„æ•°æ®åŒ…ä¼šç»è¿‡ä¸åŒçš„è·¯ç”±ï¼Œå¹¶åœ¨ä¸åŒçš„æ—¶é—´åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œè€Œ UDP åè®®å¹¶ä¸çŸ¥é“å¦‚ä½•ç»„è£…è¿™äº›æ•°æ®åŒ…ï¼Œä»è€ŒæŠŠè¿™äº›æ•°æ®åŒ…è¿˜åŸæˆå®Œæ•´çš„æ–‡ä»¶ã€‚</p>
</li>
</ul>
<p>åŸºäºè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥ TCP äº†ã€‚<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE">TCP(Transmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®)</a>æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ç›¸å¯¹äº UDPï¼ŒTCP æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹ç‚¹:</p>
<ul>
<li><p>å¯¹äºæ•°æ®åŒ…ä¸¢å¤±çš„æƒ…å†µï¼ŒTCP æä¾›é‡ä¼ æœºåˆ¶ï¼›</p>
</li>
<li><p>TCP å¼•å…¥äº†æ•°æ®åŒ…æ’åºæœºåˆ¶ï¼Œç”¨æ¥ä¿è¯æŠŠä¹±åºçš„æ•°æ®åŒ…ç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚</p>
</li>
</ul>
<p>æ—¢ç„¶è¦å®ç°é‡ä¼ å’Œæ•°æ®åŒ…æ’åº,å¿…ç„¶éœ€è¦ä¸€å¥—é“¾æ¥æœºåˆ¶,è¿™ä¹Ÿå°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹,å’Œå››æ¬¡æŒ¥æ‰‹</p>
<ul>
<li><p>é¦–å…ˆï¼Œå»ºç«‹è¿æ¥é˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µæ˜¯é€šè¿‡<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/TCP_handshake"><strong>ä¸‰æ¬¡æ¡æ‰‹</strong></a>æ¥å»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ã€‚TCP æä¾›é¢å‘è¿æ¥çš„é€šä¿¡ä¼ è¾“ã€‚é¢å‘è¿æ¥æ˜¯æŒ‡åœ¨æ•°æ®é€šä¿¡å¼€å§‹ä¹‹å‰å…ˆåšå¥½ä¸¤ç«¯ä¹‹é—´çš„å‡†å¤‡å·¥ä½œ,é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹é“¾æ¥.</p>
</li>
<li><p>å…¶æ¬¡ï¼Œä¼ è¾“æ•°æ®é˜¶æ®µã€‚åœ¨è¯¥é˜¶æ®µï¼Œæ¥æ”¶ç«¯éœ€è¦å¯¹æ¯ä¸ªæ•°æ®åŒ…è¿›è¡Œç¡®è®¤æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶ç«¯åœ¨æ¥æ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œéœ€è¦å‘é€ç¡®è®¤æ•°æ®åŒ…ç»™å‘é€ç«¯ã€‚æ‰€ä»¥å½“å‘é€ç«¯å‘é€äº†ä¸€ä¸ªæ•°æ®åŒ…ä¹‹åï¼Œåœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æ¥æ”¶ç«¯åé¦ˆçš„ç¡®è®¤æ¶ˆæ¯ï¼Œåˆ™åˆ¤æ–­ä¸ºæ•°æ®åŒ…ä¸¢å¤±ï¼Œå¹¶è§¦å‘å‘é€ç«¯çš„é‡å‘æœºåˆ¶ã€‚åŒæ ·ï¼Œä¸€ä¸ªå¤§çš„æ–‡ä»¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šè¢«æ‹†åˆ†æˆå¾ˆå¤šå°çš„æ•°æ®åŒ…ï¼Œè¿™äº›æ•°æ®åŒ…åˆ°è¾¾æ¥æ”¶ç«¯åï¼Œæ¥æ”¶ç«¯ä¼šæŒ‰ç…§ TCP å¤´ä¸­çš„åºå·ä¸ºå…¶æ’åºï¼Œä»è€Œä¿è¯ç»„æˆå®Œæ•´çš„æ•°æ®ã€‚</p>
</li>
<li><p>æœ€åï¼Œæ–­å¼€è¿æ¥é˜¶æ®µã€‚æ•°æ®ä¼ è¾“å®Œæ¯•ä¹‹åï¼Œå°±è¦ç»ˆæ­¢è¿æ¥äº†ï¼Œæ¶‰åŠåˆ°æœ€åä¸€ä¸ªé˜¶æ®µâ€œå››æ¬¡æŒ¥æ‰‹â€æ¥ä¿è¯åŒæ–¹éƒ½èƒ½æ–­å¼€è¿æ¥ã€‚</p>
</li>
</ul>
<p>æµé‡æ§åˆ¶ï¼šé€šè¿‡æ»‘åŠ¨çª—å£ï¼Œå–å€¼ä¸º min(æ‹¥å¡çª—å£ï¼Œæ¥å—çª—å£)ï¼›<br>æ‹¥å¡æ§åˆ¶ï¼šæ…¢å¯åŠ¨ï¼ˆä» 1 å¼€å§‹æŒ‡æ•°å¢åŠ ï¼‰ï¼Œè¾¾åˆ°é˜ˆå€¼ä¹‹åæ¯æ¬¡+1ï¼ˆæ‹¥å¡é¿å…ï¼‰ï¼Œå¦‚æœè¶…æ—¶é˜ˆå€¼ä¿®æ”¹ä¸ºå½“å‰çª—å£çš„ä¸€åŠï¼Œé‡æ–°æ…¢å¯åŠ¨å¼€å§‹ä¼ è¾“ã€‚(TCP Tahoe ç‰ˆæœ¬å·²åºŸå¼ƒ)<br>å¿«é‡ä¼ ï¼Œå¿«æ¢å¤ï¼Œå¦‚æœæ¥æ”¶åˆ°ä¸‰ä¸ªç¡®è®¤é‡ä¼ çš„ ack,ä¼šç›´æ¥å°†é˜ˆå€¼ä¿®æ”¹ä¸ºå½“å‰çª—å£çš„ä¸€åŠï¼Œå¹¶æ¯æ¬¡ä¼ è¾“æ—¶çª—å£å¤§å°å¢åŠ  1ï¼ˆæ‹¥å¡é¿å…ï¼‰ã€‚(TCP Reno ç‰ˆæœ¬)</p>
<h4 id="HTTP1-1-HTTP2-HTTP3"><a href="#HTTP1-1-HTTP2-HTTP3" class="headerlink" title="HTTP1.1 HTTP2 HTTP3"></a>HTTP1.1 HTTP2 HTTP3</h4><ul>
<li><p>HTTP1.1</p>
<p>å¢åŠ äº†æŒä¹…è¿æ¥çš„æ–¹æ³•ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸Šå¯ä»¥ä¼ è¾“å¤šä¸ª HTTP è¯·æ±‚ï¼Œåªè¦æµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨æ²¡æœ‰æ˜ç¡®æ–­å¼€è¿æ¥ï¼Œé‚£ä¹ˆè¯¥ TCP è¿æ¥ä¼šä¸€ç›´ä¿æŒ,æŒä¹…è¿æ¥åœ¨ HTTP&#x2F;1.1 ä¸­æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ä¸“é—¨ä¸ºäº†æŒä¹…è¿æ¥å» HTTP è¯·æ±‚å¤´è®¾ç½®ä¿¡æ¯ï¼Œå¦‚æœä½ ä¸æƒ³è¦é‡‡ç”¨æŒä¹…è¿æ¥ï¼Œå¯ä»¥åœ¨ HTTP è¯·æ±‚å¤´ä¸­åŠ ä¸Š Connection: closeã€‚ç›®å‰æµè§ˆå™¨ä¸­å¯¹äºåŒä¸€ä¸ªåŸŸåï¼Œé»˜è®¤å…è®¸åŒæ—¶å»ºç«‹ 6 ä¸ª TCP æŒä¹…è¿æ¥ã€‚</p>
<p>æä¾›è™šæ‹Ÿä¸»æœºçš„æ”¯æŒ,HTTP&#x2F;1.0 ä¸­ï¼Œæ¯ä¸ªåŸŸåç»‘å®šäº†ä¸€ä¸ªå”¯ä¸€çš„ IP åœ°å€ï¼Œå› æ­¤ä¸€ä¸ªæœåŠ¡å™¨åªèƒ½æ”¯æŒä¸€ä¸ªåŸŸå.ä½†æ˜¯éšç€è™šæ‹Ÿä¸»æœºæŠ€æœ¯çš„å‘å±•ï¼Œéœ€è¦å®ç°åœ¨ä¸€å°ç‰©ç†ä¸»æœºä¸Šç»‘å®šå¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºéƒ½æœ‰è‡ªå·±çš„å•ç‹¬çš„åŸŸåï¼Œè¿™äº›å•ç‹¬çš„åŸŸåéƒ½å…¬ç”¨åŒä¸€ä¸ª IP åœ°å€ã€‚HTTP&#x2F;1.1 çš„è¯·æ±‚å¤´ä¸­å¢åŠ äº† Host å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºå½“å‰çš„åŸŸååœ°å€ï¼Œè¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥æ ¹æ®ä¸åŒçš„ Host å€¼åšä¸åŒçš„å¤„ç†ã€‚</p>
<p>å¯¹åŠ¨æ€ç”Ÿæˆçš„å†…å®¹æä¾›äº†æ”¯æŒ,åœ¨è®¾è®¡ HTTP&#x2F;1.0 æ—¶ï¼Œéœ€è¦åœ¨å“åº”å¤´ä¸­è®¾ç½®å®Œæ•´çš„æ•°æ®å¤§å°,ä½†æ˜¯å¤§éƒ¨åˆ†é¡µé¢å†…å®¹éƒ½æ˜¯åŠ¨æ€çš„ï¼Œï¼Œå› æ­¤åœ¨ä¼ è¾“æ•°æ®ä¹‹å‰å¹¶ä¸çŸ¥é“æœ€ç»ˆçš„æ•°æ®å¤§å°ã€‚HTTP&#x2F;1.1 é€šè¿‡å¼•å…¥ Chunk transfer æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨ä¼šå°†æ•°æ®åˆ†å‰²æˆè‹¥å¹²ä¸ªä»»æ„å¤§å°çš„æ•°æ®å—ï¼Œæ¯ä¸ªæ•°æ®å—å‘é€æ—¶ä¼šé™„ä¸Šä¸Šä¸ªæ•°æ®å—çš„é•¿åº¦ï¼Œæœ€åä½¿ç”¨ä¸€ä¸ªé›¶é•¿åº¦çš„å—ä½œä¸ºå‘é€æ•°æ®å®Œæˆçš„æ ‡å¿—ã€‚è¿™æ ·å°±æä¾›äº†å¯¹åŠ¨æ€å†…å®¹çš„æ”¯æŒã€‚</p>
<p>å®‰å…¨æ€§ï¼Œcookies</p>
<p><strong>å­˜åœ¨çš„é—®é¢˜</strong>ï¼š</p>
<p>TCP æ…¢å¯åŠ¨ï¼Œå¯¼è‡´å°çš„æ ¸å¿ƒèµ„æºå¹¶ä¸èƒ½å æ»¡å¸¦å®½ç«‹å³ä¸‹è½½<br>å¤šä¸ª TCP é“¾æ¥ä¼šç«äº‰è´·æ¬¾ï¼Œå¯èƒ½è®©æ ¸å¿ƒèµ„æºçš„ä¸‹è½½é€Ÿåº¦å˜æ…¢<br>é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼ŒåŒä¸€æ—¶é—´åªèƒ½ä¸€ä¸ª TCP é“¾æ¥åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶ä»–çš„ä»»åŠ¡éœ€è¦æ’é˜Ÿ<br>å¤´ä¿¡æ¯æ²¡æœ‰å‹ç¼©,å¹¶ä¸”è¢«é¢‘ç¹çš„é‡å¤ä¼ è¾“</p>
</li>
<li><p>HTTP2<br>è§£å†³ HTTP1.1 å­˜åœ¨çš„é—®é¢˜ <strong>ä¸€ä¸ªåŸŸååªä½¿ç”¨ä¸€ä¸ª TCP é•¿è¿æ¥å’Œæ¶ˆé™¤é˜Ÿå¤´é˜»å¡é—®é¢˜</strong> ã€‚ä½†æ˜¯ HTTP2 ä»ç„¶æ˜¯åŸºäº TCP åè®®çš„ï¼ŒTCP ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä¸¢åŒ…ï¼Œä¼šå¯¼è‡´ TCP é˜Ÿå¤´é˜»å¡ï¼Œæ‰€ä»¥éšç€ä¸¢åŒ…ç‡çš„å¢åŠ ï¼ŒHTTP&#x2F;2 çš„ä¼ è¾“æ•ˆç‡ä¹Ÿä¼šè¶Šæ¥è¶Šå·®ã€‚æœ‰æµ‹è¯•æ•°æ®è¡¨æ˜ï¼Œå½“ç³»ç»Ÿè¾¾åˆ°äº† 2% çš„ä¸¢åŒ…ç‡æ—¶ï¼ŒHTTP&#x2F;1.1 çš„ä¼ è¾“æ•ˆç‡åè€Œæ¯” HTTP&#x2F;2 è¡¨ç°å¾—æ›´å¥½ã€‚</p>
<p>HTTP2 æ„å»ºäº†ä¸€ä¸ª 2 è¿›åˆ¶åˆ†å¸§å±‚ï¼Œå…¶ä¸­<strong>å¸§</strong>å’Œ<strong>æµ</strong>æ˜¯ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚<strong>å¸§æ˜¯æ•°æ®ä¼ è¾“çš„æœ€å°å•ä½</strong>ã€‚å¸§çš„æœ€å¤–å±‚æ ¼å¼å¦‚ä¸‹ã€‚</p>
<p><img src="/posts/fe6954b3445e/011.png"></p>
<p>HTTP2 æŠŠè¯·æ±‚å’Œå“åº”æŠ¥æ–‡åˆ†æˆå¤´éƒ¨å¸§å’Œæ•°æ®å¸§ã€‚ç”± <code>type</code> å­—æ®µæ ‡è¯†ã€‚ä¸€ä¸ªæµç”¨å¤šä¸ªå¸§ç»„æˆï¼ŒåŒä¸€ä¸ªæµçš„å¸§å…±ç”¨ä¸€ä¸ªæµ ID æ ‡è¯†,å¯ä»¥å°†ä¹±åºçš„å¸§å…³è”èµ·æ¥ã€‚</p>
<p>ä½¿ç”¨ HPACK ç®—æ³•ï¼Œå‡å°‘å¤´ä¿¡æ¯çš„å°ï¼Œå‡å°å‘é€åŒ…çš„ä½“ç§¯ï¼Œä»è€Œé™ä½å»¶è¿Ÿã€‚æ­¤ç®—æ³•åŒ…å«é™æ€è¡¨ï¼ŒåŠ¨æ€è¡¨ï¼ŒHuffman ç¼–ç ï¼Œé™æ€è¡¨é¢„å®šä¹‰äº† 61 ä¸ª header çš„ keyï¼Œvalueã€‚åŠ¨æ€è¡¨ç”±åŒæ–¹ç»´æŠ¤è‡ªå®šä¹‰çš„ header å­—æ®µï¼ŒHuffman ç¼–ç ç”¨äºæ¶ˆé™¤é‡å¤çš„å­—èŠ‚ã€‚</p>
<p>å¯ä»¥è®¾ç½®è¯·æ±‚çš„æƒé‡ï¼Œé«˜ä¼˜å…ˆçº§çš„è¯·æ±‚ä¼šä¼˜å…ˆå“åº”ã€‚<br>å¯ä»¥æœåŠ¡ç«¯æ¨é€ï¼Œå¦‚æœè¯·æ±‚çš„ç½‘é¡µæœ‰ä¾èµ–èµ„æºï¼ŒæœåŠ¡å™¨ä¼šä¸»åŠ¨å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>ä½†æ˜¯ HTTP2 å¹¶æ²¡æœ‰è§£å†³ TCP å±‚é¢çš„é˜Ÿå¤´é˜»å¡ï¼Œå¦‚æœä¼ è¾“è¿‡ç¨‹ä¸­çš„åŒ…ä¸¢å¤±ï¼Œä¾ç„¶ä¼šé‡ä¼ å¹¶ç­‰å¾…ã€‚</p>
</li>
<li><p>HTTP3<br>åœ¨ UDP åè®®ä¹‹ä¸Šï¼Œå®ç°äº† QUIC åè®®ï¼Œå®ç°äº†ç±»ä¼¼ TCP çš„æµé‡æ§åˆ¶ã€ä¼ è¾“å¯é æ€§çš„åŠŸèƒ½ã€‚è™½ç„¶ UDP ä¸æä¾›å¯é æ€§çš„ä¼ è¾“ï¼Œä½† QUIC åœ¨ UDP çš„åŸºç¡€ä¹‹ä¸Šå¢åŠ äº†ä¸€å±‚æ¥ä¿è¯æ•°æ®å¯é æ€§ä¼ è¾“ã€‚å®ƒæä¾›äº†æ•°æ®åŒ…é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ä»¥åŠå…¶ä»–ä¸€äº› TCP ä¸­å­˜åœ¨çš„ç‰¹æ€§ã€‚</p>
<p>é›†æˆäº† TLS åŠ å¯†åŠŸèƒ½ã€‚ç›®å‰ QUIC ä½¿ç”¨çš„æ˜¯ TLS1.3ï¼Œç›¸è¾ƒäºæ—©æœŸç‰ˆæœ¬ TLS1.3 æœ‰æ›´å¤šçš„ä¼˜ç‚¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯å‡å°‘äº†æ¡æ‰‹æ‰€èŠ±è´¹çš„ RTT ä¸ªæ•°ã€‚</p>
<p>å®ç°äº† HTTP&#x2F;2 ä¸­çš„å¤šè·¯å¤ç”¨åŠŸèƒ½ã€‚å’Œ TCP ä¸åŒï¼ŒQUIC å®ç°äº†åœ¨åŒä¸€ç‰©ç†è¿æ¥ä¸Šå¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„é€»è¾‘æ•°æ®æµï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å®ç°äº†æ•°æ®æµçš„å•ç‹¬ä¼ è¾“ï¼Œå°±è§£å†³äº† TCP ä¸­é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚</p>
<p>å®ç°äº†å¿«é€Ÿæ¡æ‰‹åŠŸèƒ½ã€‚ç”±äº QUIC æ˜¯åŸºäº UDP çš„ï¼Œæ‰€ä»¥ QUIC å¯ä»¥å®ç°ä½¿ç”¨ 0-RTT æˆ–è€… 1-RTT æ¥å»ºç«‹è¿æ¥ï¼Œè¿™æ„å‘³ç€ QUIC å¯ä»¥ç”¨æœ€å¿«çš„é€Ÿåº¦æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æå‡é¦–æ¬¡æ‰“å¼€é¡µé¢çš„é€Ÿåº¦ã€‚</p>
<p>åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€ä¸‹é—®é¢˜ï¼š</p>
<p>æµè§ˆå™¨çš„å®ç°å’Œå®˜æ–¹å®šä¹‰å·®è·è¿‡å¤§ï¼Œç³»ç»Ÿå†…æ ¸å¯¹ UPD çš„ä¼˜åŒ–ä¸ä½³ã€‚ä¸­é—´è®¾å¤‡åƒµåŒ–å¯¼è‡´ä¸¢åŒ…ç‡è¿œå¤§äº TCP é“¾æ¥ã€‚</p>
</li>
</ul>
<h4 id="TLS-æ¡æ‰‹è¿‡ç¨‹"><a href="#TLS-æ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="TLS æ¡æ‰‹è¿‡ç¨‹"></a>TLS æ¡æ‰‹è¿‡ç¨‹</h4><ul>
<li>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ï¼ŒTLS ç‰ˆæœ¬ï¼ŒåŠ å¯†å¥—ä»¶ï¼Œseq(éšæœºæ•°)1</li>
<li>æœåŠ¡ç«¯å“åº” TLS ç‰ˆæœ¬ï¼ŒåŠ å¯†å¥—ä»¶ï¼Œseq2</li>
<li>æœåŠ¡ç«¯å‘é€è¯ä¹¦</li>
<li>æœåŠ¡ç«¯å‘é€å…¬é’¥</li>
<li>æœåŠ¡ç‚¹é€šçŸ¥å®¢æˆ·ç«¯å‘é€å®Œæˆ</li>
<li>å®¢æˆ·ç«¯ç”Ÿæˆ seq3(é¢„ä¸»å¯†é’¥) ç”¨æ¥æ”¶åˆ°çš„å…¬é’¥åŠ å¯†ååœ¨å‘é€ç»™æœåŠ¡ç«¯</li>
<li>æœåŠ¡ç«¯ç”¨ç§é’¥è§£å¯†ï¼Œè·å–é¢„ä¸»å¯†é’¥</li>
<li>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«ç”¨ seq1+seq2+seq3(é¢„ä¸»å¯†é’¥) ç”Ÿæˆä¼šè¯å¯†é’¥</li>
<li>åç»­çš„é€šä¿¡ä½¿ç”¨ä¼šè¯å¯†é’¥</li>
</ul>
<p>TLS åªæœ‰åœ¨æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†å¯¹èµ„æºçš„æ¶ˆè€—å¾ˆå¤§ï¼Œé€šä¿¡è¿‡ç¨‹ä½¿ç”¨åŠ å¯†åçš„ä¼šè¯å¯†é’¥ã€‚</p>
<h4 id="æŠ¥æ–‡æ ¼å¼"><a href="#æŠ¥æ–‡æ ¼å¼" class="headerlink" title="æŠ¥æ–‡æ ¼å¼"></a>æŠ¥æ–‡æ ¼å¼</h4><ul>
<li><p><strong>HTTP</strong></p>
<p><img src="/posts/fe6954b3445e/005.webp"></p>
<p><img src="/posts/fe6954b3445e/006.webp"></p>
</li>
</ul>
<h4 id="é¡µé¢æ€§èƒ½æŒ‡æ ‡"><a href="#é¡µé¢æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="é¡µé¢æ€§èƒ½æŒ‡æ ‡"></a>é¡µé¢æ€§èƒ½æŒ‡æ ‡</h4><ul>
<li><p>FP(First Paint):ä»å¼€å§‹åŠ è½½åˆ°æµè§ˆå™¨é¦–æ¬¡ç»˜åˆ¶åƒç´ åˆ°å±å¹•ä¸Šçš„æ—¶é—´,ä¹Ÿå°±æ˜¯é¡µé¢åœ¨å±å¹•ä¸Šé¦–æ¬¡å‘ç”Ÿè§†è§‰å˜åŒ–çš„æ—¶é—´ã€‚</p>
</li>
<li><p>FCPï¼ˆFirst Contentful Paintï¼‰:æµè§ˆå™¨é¦–æ¬¡ç»˜åˆ¶æ¥è‡ª DOM çš„å†…å®¹çš„æ—¶é—´ã€‚è¿™æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡å¼€å§‹çœ‹åˆ°é¡µé¢å†…å®¹ï¼Œä½†ä»…ä»…æœ‰å†…å®¹ï¼Œå¹¶ä¸æ„å‘³ç€å®ƒæ˜¯æœ‰ç”¨çš„å†…å®¹ï¼ˆä¾‹å¦‚ Headerã€å¯¼èˆªæ ç­‰ï¼‰ï¼Œä¹Ÿä¸æ„å‘³ç€æœ‰ç”¨æˆ·è¦æ¶ˆè´¹çš„å†…å®¹ã€‚</p>
</li>
<li><p>FMPï¼ˆFirst Meaningful Paintï¼‰:é¡µé¢çš„ä¸»è¦å†…å®¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šçš„æ—¶é—´ã€‚ä¸»è¦å†…å®¹çš„å®šä¹‰å› é¡µé¢è€Œå¼‚ï¼Œä¾‹å¦‚å¯¹äºåšå®¢æ–‡ç« ï¼Œå®ƒçš„ä¸»è¦å†…å®¹æ˜¯æ ‡é¢˜å’Œæ‘˜è¦ï¼Œå¯¹äºæœç´¢é¡µé¢ï¼Œå®ƒçš„ä¸»è¦å†…å®¹æ˜¯æœç´¢ç»“æœï¼Œå¯¹äºç”µå•†çš„é¡µé¢ï¼Œå›¾ç‰‡åˆ™æ˜¯ä¸»è¦å†…å®¹ã€‚</p>
</li>
<li><p>FSPï¼ˆFirst Screen Paintï¼‰:é¡µé¢ä»å¼€å§‹åŠ è½½åˆ°é¦–å±å†…å®¹å…¨éƒ¨ç»˜åˆ¶å®Œæˆçš„æ—¶é—´ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°é¦–å±çš„å…¨éƒ¨å†…å®¹ã€‚</p>
</li>
<li><p>TTIï¼ˆTime to Interactiveï¼‰:è¡¨ç¤ºç½‘é¡µç¬¬ä¸€æ¬¡å®Œå…¨è¾¾åˆ°å¯äº¤äº’çŠ¶æ€çš„æ—¶é—´ç‚¹ï¼Œæµè§ˆå™¨å·²ç»å¯ä»¥æŒç»­æ€§çš„å“åº”ç”¨æˆ·çš„è¾“å…¥ã€‚</p>
</li>
</ul>
<h4 id="HTTP-ç¼“å­˜"><a href="#HTTP-ç¼“å­˜" class="headerlink" title="HTTP ç¼“å­˜"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching">HTTP ç¼“å­˜</a></h4><p><img src="/posts/fe6954b3445e/004.png"></p>
<h5 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h5><p>HTTP&#x2F;1.1 å®šä¹‰çš„ Cache-Control å¤´ç”¨æ¥åŒºåˆ†å¯¹ç¼“å­˜æœºåˆ¶çš„æ”¯æŒæƒ…å†µï¼Œ è¯·æ±‚å¤´å’Œå“åº”å¤´éƒ½æ”¯æŒè¿™ä¸ªå±æ€§ã€‚é€šè¿‡å®ƒæä¾›çš„ä¸åŒçš„å€¼æ¥å®šä¹‰ç¼“å­˜ç­–ç•¥ã€‚</p>
<ul>
<li><p>æ¯æ¬¡éƒ½æä¾›æœ€æ–°çš„å†…å®¹</p>
<p>æ­¤æ–¹å¼ä¸‹ï¼Œæ¯æ¬¡æœ‰è¯·æ±‚å‘å‡ºæ—¶ï¼Œç¼“å­˜ä¼šå°†æ­¤è¯·æ±‚å‘åˆ°æœåŠ¡å™¨ï¼ˆè¯¥è¯·æ±‚åº”è¯¥ä¼šå¸¦æœ‰ä¸æœ¬åœ°ç¼“å­˜ç›¸å…³çš„éªŒè¯å­—æ®µï¼‰ï¼ŒæœåŠ¡å™¨ç«¯ä¼šéªŒè¯è¯·æ±‚ä¸­æ‰€æè¿°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè‹¥æœªè¿‡æœŸï¼ˆæ³¨ï¼šå®é™…å°±æ˜¯è¿”å› 304ï¼‰ï¼Œåˆ™ç¼“å­˜æ‰ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‰¯æœ¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿‡æœŸ<br>è¿‡æœŸæœºåˆ¶ä¸­ï¼Œæœ€é‡è¦çš„æŒ‡ä»¤æ˜¯ â€œmax-age&#x3D;<seconds>â€œï¼Œè¡¨ç¤ºèµ„æºèƒ½å¤Ÿè¢«ç¼“å­˜ï¼ˆä¿æŒæ–°é²œï¼‰çš„æœ€å¤§æ—¶é—´ã€‚max-age æ˜¯è·ç¦»è¯·æ±‚å‘èµ·çš„æ—¶é—´çš„ç§’æ•°ã€‚é’ˆå¯¹åº”ç”¨ä¸­é‚£äº›ä¸ä¼šæ”¹å˜çš„æ–‡ä»¶ï¼Œé€šå¸¸å¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸€å®šçš„æ—¶é•¿ä»¥ä¿è¯ç¼“å­˜æœ‰æ•ˆï¼Œä¾‹å¦‚å›¾ç‰‡ã€cssã€js ç­‰é™æ€èµ„æºã€‚</p>
<p>Expires å“åº”å¤´åŒ…å«æ—¥æœŸ&#x2F;æ—¶é—´ï¼Œ å³åœ¨æ­¤æ—¶å€™ä¹‹åï¼Œå“åº”è¿‡æœŸã€‚å¦‚æœåœ¨ Cache-Control å“åº”å¤´è®¾ç½®äº† â€œmax-ageâ€ æˆ–è€… â€œs-max-ageâ€ æŒ‡ä»¤ï¼Œé‚£ä¹ˆ Expires å¤´ä¼šè¢«å¿½ç•¥ã€‚</p>
</li>
</ul>
<h5 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h5><p>å¼ºåˆ¶ç¼“å­˜å¤±æ•ˆåï¼Œæµè§ˆå™¨æºå¸¦ç¼“å­˜æ ‡è¯†å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œç”±æœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜</p>
<ul>
<li><p>Last-Modified &#x2F; If-Modified-Since</p>
<p>Last-Modified æ˜¯ç”±æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ HTTP å“åº”å¤´æ ‡ç­¾ï¼Œæ—¶é—´å€¼æ˜¯å½“å‰èµ„æºæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´</p>
<p>If-Modified-Since æ˜¯ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ HTTP è¯·æ±‚å¤´æ ‡ç­¾ï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¯¥è¯·æ±‚æ—¶ï¼Œä¼šæºå¸¦ä¸Šæ¬¡è¯·æ±‚è¿”å›çš„ Last-Modified çš„æ—¶é—´å€¼ï¼Œå¯¹æ¯” If-Modified-Since çš„æ—¶é—´å’Œè¯¥èµ„æºåœ¨æœåŠ¡å™¨ç«¯æœ€åè¢«ä¿®æ”¹çš„æ—¶é—´ï¼Œå†³å®šæ˜¯å¦æ›´æ–°èµ„æº</p>
</li>
<li><p>Etag &#x2F; If-None-Match</p>
<p>Etag æ˜¯ç”±æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ HTTP å“åº”å¤´æ ‡ç­¾ï¼Œæ˜¯æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„èµ„æºæ–‡ä»¶çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†</p>
<p>If-None-Match æ˜¯ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ HTTP è¯·æ±‚å¤´æ ‡ç­¾ï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¯¥è¯·æ±‚æ—¶ï¼Œä¼šæºå¸¦ä¸Šæ¬¡è¯·æ±‚è¿”å›çš„ Etag å€¼ï¼Œå¯¹æ¯”æœåŠ¡å™¨ç«¯çš„ Etag å€¼å’Œ If-None-Match çš„å€¼ï¼Œå†³å®šæ˜¯å¦æ›´æ–°èµ„æº</p>
</li>
</ul>
<p>ä¼˜å…ˆçº§ï¼šEtag &#x2F; If-None-Match &gt; Last-Modified &#x2F; If-Modified-Since</p>
<h4 id="é‡ç»˜ä¸é‡æ’"><a href="#é‡ç»˜ä¸é‡æ’" class="headerlink" title="é‡ç»˜ä¸é‡æ’"></a>é‡ç»˜ä¸é‡æ’</h4><p>å¦‚æœä½ é€šè¿‡ JavaScript æˆ–è€… CSS ä¿®æ”¹å…ƒç´ çš„å‡ ä½•ä½ç½®å±æ€§ï¼Œä¾‹å¦‚æ”¹å˜å…ƒç´ çš„å®½åº¦ã€é«˜åº¦ç­‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šè§¦å‘é‡æ–°å¸ƒå±€ï¼Œè§£æä¹‹åçš„ä¸€ç³»åˆ—å­é˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é‡æ’ã€‚æ— ç–‘ï¼Œé‡æ’éœ€è¦æ›´æ–°å®Œæ•´çš„æ¸²æŸ“æµæ°´çº¿ï¼Œæ‰€ä»¥å¼€é”€ä¹Ÿæ˜¯æœ€å¤§çš„ã€‚</p>
<p><img src="/posts/fe6954b3445e/007.webp"></p>
<p>å¦‚æœä¿®æ”¹äº†å…ƒç´ çš„èƒŒæ™¯é¢œè‰²ï¼Œé‚£ä¹ˆå¸ƒå±€é˜¶æ®µå°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºå¹¶æ²¡æœ‰å¼•èµ·å‡ ä½•ä½ç½®çš„å˜æ¢ï¼Œæ‰€ä»¥å°±ç›´æ¥è¿›å…¥äº†ç»˜åˆ¶é˜¶æ®µï¼Œç„¶åæ‰§è¡Œä¹‹åçš„ä¸€ç³»åˆ—å­é˜¶æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«é‡ç»˜ã€‚ç›¸è¾ƒäºé‡æ’æ“ä½œï¼Œé‡ç»˜çœå»äº†å¸ƒå±€å’Œåˆ†å±‚é˜¶æ®µï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡ä¼šæ¯”é‡æ’æ“ä½œè¦é«˜ä¸€äº›ã€‚</p>
<p><img src="/posts/fe6954b3445e/008.webp"></p>
<p>å¦‚æœæ›´æ”¹ä¸€ä¸ªæ—¢ä¸è¦å¸ƒå±€ä¹Ÿä¸è¦ç»˜åˆ¶çš„å±æ€§,æŠŠè¿™ä¸ªè¿‡ç¨‹å«åšåˆæˆ</p>
<p>ä½¿ç”¨äº† CSS çš„ transform æ¥å®ç°åŠ¨ç”»æ•ˆæœï¼Œè¿™å¯ä»¥é¿å¼€é‡æ’å’Œé‡ç»˜é˜¶æ®µï¼Œç›´æ¥åœ¨éä¸»çº¿ç¨‹ä¸Šæ‰§è¡ŒåˆæˆåŠ¨ç”»æ“ä½œã€‚è¿™æ ·çš„æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œå› ä¸ºæ˜¯åœ¨éä¸»çº¿ç¨‹ä¸Šåˆæˆï¼Œå¹¶æ²¡æœ‰å ç”¨ä¸»çº¿ç¨‹çš„èµ„æºï¼Œå¦å¤–ä¹Ÿé¿å¼€äº†å¸ƒå±€å’Œç»˜åˆ¶ä¸¤ä¸ªå­é˜¶æ®µï¼Œæ‰€ä»¥ç›¸å¯¹äºé‡ç»˜å’Œé‡æ’ï¼Œåˆæˆèƒ½å¤§å¤§æå‡ç»˜åˆ¶æ•ˆç‡ã€‚</p>
<p><img src="/posts/fe6954b3445e/009.webp"></p>
<h4 id="è¯·æ±‚æ—¶é—´çº¿"><a href="#è¯·æ±‚æ—¶é—´çº¿" class="headerlink" title="è¯·æ±‚æ—¶é—´çº¿"></a>è¯·æ±‚æ—¶é—´çº¿</h4><p><img src="/010.webp"></p>
<ul>
<li><p>Queuing(æ’é˜Ÿ), å¯¼è‡´æ’é˜ŸçŠ¶æ€æœ‰å¾ˆå¤š<br>é‡åˆ° CSSã€HTMLã€JavaScript ç­‰é«˜ä¼˜å…ˆçº§èµ„æºï¼Œå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ è¿™äº›ä½ä¼˜å…ˆçº§èµ„æºä¼šè®©è·¯ã€‚<br>æµè§ˆå™¨ä¼šä¸ºæ¯ä¸ªåŸŸåæœ€å¤šç»´æŠ¤ 6 ä¸ª TCP è¿æ¥,å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡ä¼šå¤„äºæ’é˜ŸçŠ¶æ€ã€‚<br>ç½‘ç»œè¿›ç¨‹åœ¨ä¸ºæ•°æ®åˆ†é…ç£ç›˜ç©ºé—´æ—¶ï¼Œæ–°çš„ HTTP è¯·æ±‚ä¹Ÿéœ€è¦çŸ­æš‚åœ°ç­‰å¾…ç£ç›˜åˆ†é…ç»“æŸã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š ä½¿ç”¨åŸŸååˆ†ç‰‡æŠ€æœ¯,æé«˜æ•´ä½“çš„ TCP é“¾æ¥æ•°é‡ï¼Œ æŠŠç«™ç‚¹å‡çº§åˆ° HTTP2ã€‚</p>
</li>
<li><p>Stalled(åœæ»), ä¸€äº›å…¶ä»–çš„åŸå› å¯¼è‡´é“¾æ¥è¢«æ¨</p>
</li>
<li><p>Initial connectionï¼ˆåˆå§‹åŒ–é“¾æ¥ï¼‰, å»ºç«‹ TCP æ‰€èŠ±è´¹çš„æ—¶é—´å¦‚æœæ˜¯ HTTPS è¯·æ±‚ï¼Œè¿˜ä¼šæœ‰ SSL æ¡æ‰‹æ—¶é—´ã€‚</p>
</li>
<li><p>Request sent(è¯·æ±‚å‘é€)ï¼Œç”±äºåªéœ€è¦æŠŠç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€å‡ºå»ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚</p>
</li>
<li><p>TTFB(ç¬¬ä¸€å­—èŠ‚æ—¶é—´)ï¼Œæ”¶æœåŠ¡å™¨ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ŒTTFB æ—¶é—´è¶ŠçŸ­ï¼Œå°±è¯´æ˜æœåŠ¡å™¨å“åº”è¶Šå¿«ã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š æé«˜è¿è¥å•†çš„ç½‘ç»œå¸¦å®½,ä½¿ç”¨ CDN æŠ€æœ¯ã€‚æœåŠ¡å™¨å“åº”æ—¶é—´è¿‡é•¿ï¼Œé—®é¢˜å¯èƒ½å‡ºç°åœ¨æ¸²æŸ“ï¼Œä¿¡æ¯å¤„ç†ç­‰æ–¹é¢,å¯ä»¥è€ƒè™‘æé«˜ç¼“å­˜çš„ä½¿ç”¨æ•ˆç‡ã€‚</p>
</li>
<li><p>Content Downloadï¼ˆèµ„æºä¸‹è½½æ—¶é—´ï¼‰</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š å‹ç¼©æ–‡ä»¶ï¼Œæµå¼ä¼ è¾“ã€‚</p>
</li>
</ul>
<h4 id="å¦‚ä½•éªŒè¯æ•°å­—è¯ä¹¦"><a href="#å¦‚ä½•éªŒè¯æ•°å­—è¯ä¹¦" class="headerlink" title="å¦‚ä½•éªŒè¯æ•°å­—è¯ä¹¦"></a>å¦‚ä½•éªŒè¯æ•°å­—è¯ä¹¦</h4><ul>
<li><p>ç”³è¯·æ•°å­—è¯ä¹¦<br>ç½‘ç«™éœ€è¦å‡†å¤‡ä¸€å¥—ç§é’¥å’Œå…¬é’¥ï¼Œç§é’¥ç•™ç€è‡ªå·±ä½¿ç”¨ï¼›<br>å‘ CA æœºæ„æäº¤å…¬é’¥ã€å…¬å¸ã€ç«™ç‚¹ç­‰ä¿¡æ¯å¹¶ç­‰å¾…è®¤è¯ï¼Œè¿™ä¸ªè®¤è¯è¿‡ç¨‹å¯èƒ½æ˜¯æ”¶è´¹çš„ï¼›<br>CA é€šè¿‡çº¿ä¸Šã€çº¿ä¸‹ç­‰å¤šç§æ¸ é“æ¥éªŒè¯æå®¢æ—¶é—´æ‰€æä¾›ä¿¡æ¯çš„çœŸå®æ€§ï¼Œå¦‚å…¬å¸æ˜¯å¦å­˜åœ¨ã€ä¼ä¸šæ˜¯å¦åˆæ³•ã€åŸŸåæ˜¯å¦å½’å±è¯¥ä¼ä¸šç­‰ï¼›<br>å¦‚ä¿¡æ¯å®¡æ ¸é€šè¿‡ï¼ŒCA ä¼šå‘æå®¢æ—¶é—´ç­¾å‘è®¤è¯çš„æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«äº†æå®¢æ—¶é—´çš„å…¬é’¥ã€ç»„ç»‡ä¿¡æ¯ã€CA çš„ä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ã€è¯ä¹¦åºåˆ—å·ç­‰ï¼Œè¿™äº›ä¿¡æ¯éƒ½æ˜¯æ˜æ–‡çš„ï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ª CA ç”Ÿæˆçš„ç­¾åã€‚</p>
</li>
<li><p>æµè§ˆå™¨éªŒè¯è¯ä¹¦åˆæ³•æ€§<br>é¦–å…ˆï¼Œæµè§ˆå™¨åˆ©ç”¨è¯ä¹¦çš„åŸå§‹ä¿¡æ¯è®¡ç®—å‡ºä¿¡æ¯æ‘˜è¦ï¼›ç„¶åï¼Œåˆ©ç”¨ CA çš„å…¬é’¥æ¥è§£å¯†æ•°å­—è¯ä¹¦ä¸­çš„æ•°å­—ç­¾åï¼Œè§£å¯†å‡ºæ¥çš„æ•°æ®ä¹Ÿæ˜¯ä¿¡æ¯æ‘˜è¦ï¼›æœ€åï¼Œåˆ¤æ–­è¿™ä¸¤ä¸ªä¿¡æ¯æ‘˜è¦æ˜¯å¦ç›¸ç­‰å°±å¯ä»¥äº†ã€‚<br><strong>æµè§ˆå™¨æ˜¯æ€ä¹ˆè·å–åˆ° CA å…¬é’¥çš„</strong>,å½“éƒ¨ç½² HTTP æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé™¤äº†éƒ¨ç½²å½“å‰çš„æ•°å­—è¯ä¹¦ä¹‹å¤–ï¼Œè¿˜éœ€è¦éƒ¨ç½² CA æœºæ„çš„æ•°å­—è¯ä¹¦ï¼ŒCA æœºæ„çš„æ•°å­—è¯ä¹¦åŒ…æ‹¬äº† CA çš„å…¬é’¥ï¼Œä»¥åŠ CA æœºæ„çš„ä¸€äº›åŸºç¡€ä¿¡æ¯ã€‚æœåŠ¡å™¨ä¼šæœ‰ä¸¤ä¸ªæ•°å­—è¯ä¹¦ï¼ŒåŸŸåçš„æ•°å­—è¯ä¹¦,CA æœºæ„çš„æ•°å­—è¯ä¹¦ã€‚ç„¶ååœ¨å»ºç«‹ HTTPS é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†è¿™ä¸¤ä¸ªè¯ä¹¦ä¸€åŒå‘é€ç»™æµè§ˆå™¨ï¼Œäºæ˜¯æµè§ˆå™¨å°±å¯ä»¥è·å–åˆ° CA çš„å…¬é’¥äº†ã€‚<br><strong>è¯æ˜ CA æœºæ„çš„åˆæ³•æ€§</strong>,æ“ä½œç³»ç»Ÿä¸­å†…ç½®è¿™äº› CA æœºæ„çš„æ•°å­—è¯ä¹¦,ï¼ŒCA æœºæ„ä¼—å¤šï¼Œå› æ­¤æ“ä½œç³»ç»Ÿä¸å¯èƒ½å°†æ¯å®¶ CA çš„æ•°å­—è¯ä¹¦éƒ½å†…ç½®è¿›æ“ä½œç³»ç»Ÿã€‚äºæ˜¯äººä»¬åˆæƒ³å‡ºæ¥ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œå°†é¢å‘è¯ä¹¦çš„æœºæ„åˆ’åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œæ ¹ CA(Root CAs)å’Œä¸­é—´ CA(Intermediates CAs)ï¼Œé€šå¸¸ç”³è¯·è€…éƒ½æ˜¯å‘ä¸­é—´ CA å»ç”³è¯·è¯ä¹¦çš„ï¼Œè€Œæ ¹ CA ä½œç”¨å°±æ˜¯ç»™ä¸­é—´ CA åšè®¤è¯ï¼Œä¸€ä¸ªæ ¹ CA ä¼šè®¤è¯å¾ˆå¤šä¸­é—´çš„ CAï¼Œè€Œè¿™äº›ä¸­é—´ CA åˆå¯ä»¥å»è®¤è¯å…¶ä»–çš„ä¸­é—´ CAï¼Œä¹Ÿå°±å½¢æˆäº†<strong>æ•°å­—è¯ä¹¦é“¾</strong>ã€‚</p>
</li>
</ul>
<h4 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h4><ul>
<li><p>æµè§ˆå™¨å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªé¡µç­¾ï¼Œä»–ä»¬ç«¯å£ä¸€æ ·å—ï¼Ÿå¦‚æœä¸€æ ·ï¼Œæ•°æ®æ€ä¹ˆçŸ¥é“å»å“ªä¸ªé¡µç­¾ï¼Ÿ</p>
<p>ç«¯å£ä¸€æ ·çš„ï¼Œç½‘ç»œè¿›ç¨‹çŸ¥é“æ¯ä¸ª tcp é“¾æ¥æ‰€å¯¹åº”çš„æ ‡ç­¾æ˜¯é‚£ä¸ªï¼Œæ‰€ä»¥æ¥æ”¶åˆ°æ•°æ®åï¼Œä¼šæŠŠæ•°æ®åˆ†å‘ç»™å¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹ã€‚</p>
</li>
<li><p>TCP ä¼ é€æ•°æ®æ—¶ æµè§ˆå™¨ç«¯å°±åšæ¸²æŸ“å¤„ç†äº†ä¹ˆï¼Ÿå¦‚æœå‰é¢æ•°æ®åŒ…ä¸¢äº† åé¢æ•°æ®åŒ…å…ˆæ¥æ˜¯è¦ç­‰ä¹ˆï¼Ÿç±»ä¼¼çš„é‚£ç§å®æ—¶æ¸²æŸ“æ€ä¹ˆå¤„ç†ï¼Ÿé’ˆå¯¹æ•°æ®åŒ…çš„é¡ºåºæ€§ï¼Ÿ</p>
<p>æ¥æ”¶åˆ° http å“åº”å¤´ä¸­çš„ content-type ç±»å‹æ—¶å°±å¼€å§‹å‡†å¤‡æ¸²æŸ“è¿›ç¨‹äº†ï¼Œå“åº”ä½“æ•°æ®ä¸€æ—¦æ¥å—åˆ°ä¾¿å¼€å§‹åš DOM è§£æäº†ï¼åŸºäº http ä¸ç”¨æ‹…å¿ƒæ•°æ®åŒ…ä¸¢å¤±çš„é—®é¢˜ï¼Œå› ä¸ºä¸¢åŒ…å’Œé‡ä¼ éƒ½æ˜¯åœ¨ tcp å±‚è§£å†³çš„ã€‚http èƒ½ä¿è¯æ•°æ®æŒ‰ç…§é¡ºåºæ¥æ”¶çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä» tcp åˆ° http çš„æ•°æ®å°±å·²ç»æ˜¯å®Œæ•´çš„äº†ï¼Œå³ä¾¿æ˜¯å®æ—¶æ¸²æŸ“ï¼Œå¦‚æœå‘ç”Ÿä¸¢åŒ…ä¹Ÿå¾—åœ¨é‡ä¼ åæ‰èƒ½å¼€å§‹æ¸²æŸ“ï¼‰</p>
</li>
<li><p>http å’Œ websocket éƒ½æ˜¯å±äºåº”ç”¨å±‚çš„åè®®å—ï¼Ÿ</p>
<p>éƒ½æ˜¯åº”ç”¨å±‚åè®®ï¼Œè€Œä¸” websocket åå­—å–çš„æ¯”è¾ƒæœ‰è¿·æƒ‘æ€§ï¼Œå…¶å®å’Œ socket å®Œå…¨ä¸ä¸€æ ·ï¼Œå¯ä»¥æŠŠ websocket çœ‹å‡ºæ˜¯ http çš„æ”¹é€ ç‰ˆæœ¬ï¼Œå¢åŠ äº†æœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€æ¶ˆæ¯çš„èƒ½åŠ›ã€‚</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">æµè§ˆå™¨</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-broswer/æµè§ˆå™¨æ¸²æŸ“åŸç†"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/0d7c79d891ee/"
    >æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/0d7c79d891ee/" class="article-date">
  <time datetime="2022-05-20T02:30:27.000Z" itemprop="datePublished">2022-05-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">æµè§ˆå™¨</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="ç”¨æˆ·è¾“å…¥"><a href="#ç”¨æˆ·è¾“å…¥" class="headerlink" title="ç”¨æˆ·è¾“å…¥"></a>ç”¨æˆ·è¾“å…¥</h4><p><strong>ç”¨æˆ·å‘å‡º URL è¯·æ±‚åˆ°é¡µé¢å¼€å§‹è§£æçš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å«åšå¯¼èˆªã€‚</strong></p>
<p>æœç´¢å†…å®¹: ä½¿ç”¨æµè§ˆå™¨é»˜è®¤çš„æœç´¢å¼•æ“åˆæˆæ–°çš„å¸¦æœç´¢å…³é”®å­—çš„ URL<br>åˆæ³•çš„ URL: åŠ ä¸Šåè®®ï¼Œåˆæˆä¸ºå®Œæ•´çš„ URL</p>
<p>æ‰§è¡Œæœç´¢äº¤äº’åï¼Œä¼šå…ˆæ‰§è¡Œ beforeunload äº‹ä»¶ï¼Œå¯ä»¥é€šè¿‡æ­¤äº‹ä»¶å–æ¶ˆå¯¼èˆªã€‚æ­¤æ—¶æµè§ˆå™¨çš„çŠ¶æ€æ˜¯åœ¨åŠ è½½ä¸­ï¼Œä½†æ˜¯é¡µé¢å†…å®¹å¹¶æ²¡æœ‰è¢«æ›¿æ¢ï¼Œå› ä¸ºéœ€è¦ç­‰å¾…æäº¤æ–‡æ¡£é˜¶æ®µ.</p>
<h4 id="URL-è¯·æ±‚è¿‡ç¨‹"><a href="#URL-è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="URL è¯·æ±‚è¿‡ç¨‹"></a>URL è¯·æ±‚è¿‡ç¨‹</h4><p>æµè§ˆå™¨è¿›ç¨‹ä¼šé€šè¿‡è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æŠŠ URL è¯·æ±‚å‘é€è‡³ç½‘ç»œè¿›ç¨‹ã€‚</p>
<p>æ˜¯å¦å‘½ä¸­ DNS ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­ç¼“å­˜ç›´æ¥è¿”å›ã€‚æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨ IP åœ°å€å’ŒæœåŠ¡å™¨å»ºç«‹ TCP è¿æ¥ã€‚è¿æ¥å»ºç«‹ä¹‹åï¼Œæµè§ˆå™¨ç«¯ä¼šæ„å»ºè¯·æ±‚è¡Œã€è¯·æ±‚å¤´ç­‰ä¿¡æ¯ï¼Œå¹¶æŠŠå’Œè¯¥åŸŸåç›¸å…³çš„ Cookie ç­‰æ•°æ®é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œç„¶åå‘æœåŠ¡å™¨å‘é€æ„å»ºçš„è¯·æ±‚ä¿¡æ¯ã€‚</p>
<p>å¦‚æœæ—¶é€šè¿‡é“¾æ¥æ‰“å¼€é¡µé¢,å¦‚æœä¸¤ä¸ªé¡µé¢æ˜¯åŒä¸€ç«™ç‚¹ï¼Œæ–°é¡µé¢ä¼šå¤ç”¨çˆ¶é¡µé¢çš„æ¸²æŸ“è¿›ç¨‹ã€‚</p>
<h4 id="æäº¤æ–‡æ¡£"><a href="#æäº¤æ–‡æ¡£" class="headerlink" title="æäº¤æ–‡æ¡£"></a>æäº¤æ–‡æ¡£</h4><ul>
<li>ç½‘ç»œè¿›ç¨‹è·å–åˆ°å“åº”ä¹‹åï¼Œå‘æ¸²æŸ“è¿›ç¨‹å‘èµ·<strong>æäº¤æ–‡æ¡£</strong>çš„æ¶ˆæ¯</li>
<li>æ¸²æŸ“è¿›ç¨‹æ¥æ”¶åˆ°<strong>æäº¤æ–‡æ¡£</strong>çš„æ¶ˆæ¯åï¼Œä¼šå’Œç½‘ç»œè¿›ç¨‹å»ºç«‹ä¼ è¾“æ•°æ®çš„<strong>ç®¡é“</strong></li>
<li>ç­‰æ–‡æ¡£æ•°æ®ä¼ è¾“å®Œæˆä¹‹åï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šè¿”å›<strong>ç¡®è®¤æäº¤</strong>çš„æ¶ˆæ¯ç»™æµè§ˆå™¨è¿›ç¨‹</li>
<li>æµè§ˆå™¨è¿›ç¨‹åœ¨æ”¶åˆ°<strong>ç¡®è®¤æäº¤</strong>çš„æ¶ˆæ¯åï¼Œä¼šæ›´æ–°æµè§ˆå™¨ç•Œé¢çŠ¶æ€ï¼ŒåŒ…æ‹¬äº†å®‰å…¨çŠ¶æ€ã€åœ°å€æ çš„ URLã€å‰è¿›åé€€çš„å†å²çŠ¶æ€ï¼Œå¹¶æ›´æ–° Web é¡µé¢ã€‚</li>
</ul>
<h4 id="é¡µé¢æ¸²æŸ“"><a href="#é¡µé¢æ¸²æŸ“" class="headerlink" title="é¡µé¢æ¸²æŸ“"></a>é¡µé¢æ¸²æŸ“</h4><p><img src="/posts/0d7c79d891ee/001.webp"></p>
<ul>
<li><p>æ„å»º DOM æ ‘<br>HTML è§£æå™¨ï¼ˆHTMLParserï¼‰è´Ÿè´£å°† HTML å­—èŠ‚æµè½¬æ¢ä¸º DOM ç»“æ„ã€‚ç½‘ç»œè¿›ç¨‹æ¥æ”¶åˆ°å“åº”å¤´ä¹‹åï¼Œä¼šæ ¹æ®å“åº”å¤´ä¸­çš„ content-type å­—æ®µæ¥åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹,å¦‚æœè¿™æ˜¯ä¸€ä¸ª HTML ç±»å‹çš„æ–‡ä»¶ï¼Œç„¶åä¸ºè¯¥è¯·æ±‚é€‰æ‹©æˆ–è€…åˆ›å»ºä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚<strong>ç½‘ç»œè¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´ä¼šå»ºç«‹ä¸€ä¸ªå…±äº«æ•°æ®çš„ç®¡é“,ç½‘ç»œè¿›ç¨‹åŠ è½½äº†å¤šå°‘æ•°æ®ï¼ŒHTML è§£æå™¨ä¾¿è§£æå¤šå°‘æ•°æ®ã€‚</strong></p>
<p>ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œé€šè¿‡åˆ†è¯å™¨å°†å­—èŠ‚æµè½¬æ¢ä¸º Tokenã€‚</p>
<p><img src="/0011.webp"></p>
<p>ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé˜¶æ®µæ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œéœ€è¦å°† Token è§£æä¸º DOM èŠ‚ç‚¹ï¼Œå¹¶å°† DOM èŠ‚ç‚¹æ·»åŠ åˆ° DOM æ ‘ä¸­ã€‚HTML è§£æå™¨ç»´æŠ¤äº†ä¸€ä¸ª Token æ ˆç»“æ„,ä½¿ç”¨æ ˆè§£æ„å®ç°äº†åŒ¹é…ç®—æ³•ã€‚</p>
</li>
<li><p>æ„å»º StyleSheet<br>å±æ€§æ ‡å‡†åŒ–<br>è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„æ ·å¼ï¼Œcss ç»§æ‰¿è§„åˆ™å’Œå±‚å è§„åˆ™</p>
</li>
<li><p>åˆ›å»ºæ¸²æŸ“æ ‘,éå† DOM æ ‘ä¸­çš„å¯è§èŠ‚ç‚¹,è®¡ç®—å‡ºæ¯ä¸ªå…ƒç´ çš„æ ·å¼ï¼ˆå³ ComputedStyleï¼‰ã€‚è¿™é‡Œçš„è®¡ç®—åŒ…æ‹¬æ‰€æœ‰ç»§æ‰¿çš„æ ·å¼å’Œä» CSS è§„åˆ™ä¸­ç»§æ‰¿æ¥çš„æ ·å¼ã€‚</p>
</li>
<li><p>åˆ›å»ºå¸ƒå±€æ ‘<br>è®¡ç®—å¸ƒå±€ä¿¡æ¯ï¼Œå¸ƒå±€ä¿¡æ¯ä¿å­˜åœ¨å¸ƒå±€æ ‘ä¸­ã€‚</p>
</li>
<li><p>åˆ›å»ºæ— éšœç¢æ ‘</p>
</li>
<li><p>åˆ†å±‚ï¼Œåˆ›å»ºå›¾å±‚æ ‘<br>å®šä½å±æ€§çš„å…ƒç´ ã€å®šä¹‰é€æ˜å±æ€§çš„å…ƒç´ ã€ä½¿ç”¨ CSS æ»¤é•œçš„å…ƒç´ ,éœ€è¦è¢«å‰ªè£ç­‰ï¼Œéƒ½æ‹¥æœ‰<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_positioned_layout/Understanding_z-index/Stacking_context">å±‚å ä¸Šä¸‹æ–‡å±æ€§</a>ã€‚<br>å¯ä»¥é€šè¿‡ <code>will-change</code> å±æ€§ï¼Œè®©å…ƒç´ å•ç‹¬åœ¨åˆæˆçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
</li>
<li><p>å›¾å±‚ç»˜åˆ¶ï¼Œæ¸²æŸ“è¿›ç¨‹ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤,çœŸå®çš„ç»˜åˆ¶ç”±æ¸²æŸ“è¿›ç¨‹ä¸­çš„åˆæˆçº¿ç¨‹æ¥å®Œæˆã€‚<br>é€šå¸¸åªç»˜åˆ¶è§†å£é™„è¿‘çš„å›¾åƒï¼Œåˆæˆçº¿ç¨‹ä¼šå°†å›¾å±‚åˆ’åˆ†ä¸ºå›¾å—ã€‚</p>
<p>åˆæˆçº¿ç¨‹ä¼šæŒ‰ç…§è§†å£é™„è¿‘çš„å›¾å—æ¥ä¼˜å…ˆç”Ÿæˆä½å›¾ï¼Œå®é™…ç”Ÿæˆä½å›¾çš„æ“ä½œæ˜¯ç”±æ …æ ¼åŒ–æ¥æ‰§è¡Œçš„ã€‚æ‰€è°“<strong>æ …æ ¼åŒ–</strong>ï¼Œæ˜¯æŒ‡å°†å›¾å—è½¬æ¢ä¸ºä½å›¾ã€‚è€Œå›¾å—æ˜¯æ …æ ¼åŒ–æ‰§è¡Œçš„æœ€å°å•ä½ã€‚æ¸²æŸ“è¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªæ …æ ¼åŒ–çš„çº¿ç¨‹æ± ï¼Œæ‰€æœ‰çš„å›¾å—æ …æ ¼åŒ–éƒ½æ˜¯åœ¨çº¿ç¨‹æ± å†…æ‰§è¡Œçš„ã€‚</p>
<p>åˆæˆè¿‡ç¨‹ä¼šä½¿ç”¨ GPU åŠ é€Ÿç”Ÿæˆï¼Œè¿™æ¶‰åŠåˆ°å—è¿›ç¨‹æ“ä½œã€‚æ¸²æŸ“è¿›ç¨‹æŠŠç”ŸæˆæŒ‡ä»¤å‘é€ç»™ GPU è¿›ç¨‹ï¼Œç”Ÿæˆçš„ä½å›¾ä¿å­˜åœ¨ GPU å†…å­˜ä¸­ã€‚</p>
<p>ä¸€æ—¦æ‰€æœ‰å›¾å—éƒ½è¢«å…‰æ …åŒ–ï¼Œåˆæˆçº¿ç¨‹å°±ä¼šç”Ÿæˆä¸€ä¸ªç»˜åˆ¶å›¾å—çš„å‘½ä»¤â€”â€”â€œDrawQuadâ€ï¼Œç„¶åå°†è¯¥å‘½ä»¤æäº¤ç»™æµè§ˆå™¨è¿›ç¨‹ã€‚æµè§ˆå™¨è¿›ç¨‹é‡Œé¢æœ‰ä¸€ä¸ªå« viz çš„ç»„ä»¶ï¼Œç”¨æ¥æ¥æ”¶åˆæˆçº¿ç¨‹å‘è¿‡æ¥çš„ DrawQuad å‘½ä»¤ï¼Œç„¶åæ ¹æ® DrawQuad å‘½ä»¤ï¼Œå°†å…¶é¡µé¢å†…å®¹ç»˜åˆ¶åˆ°å†…å­˜ä¸­ï¼Œæœ€åå†å°†å†…å­˜æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>
</li>
</ul>
<h4 id="èµ„æºåŠ è½½-x2F-è§£æ"><a href="#èµ„æºåŠ è½½-x2F-è§£æ" class="headerlink" title="èµ„æºåŠ è½½&#x2F;è§£æ"></a>èµ„æºåŠ è½½&#x2F;è§£æ</h4><ul>
<li><p>JS åœ¨ Css å‰é¢,ä¸”åœ¨ <code>head</code> ä¸­ï¼Œä¼šé˜»å¡ DOM çš„è§£æ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;p&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost:8000/big.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JS åœ¨ Css åé¢ï¼Œä¸”åœ¨<code>head</code> ä¸­ï¼Œä¼šç­‰å¾… Css åŠ è½½ï¼Œå› ä¸ºå¯èƒ½ä¼šé€šè¿‡ JS è·å–æ ·å¼ï¼Œè€Œä¸”é˜»å¡ DOM è§£æ, ä¹Ÿå°±æ˜¯è¯´åªè¦åœ¨ Js æ–‡ä»¶åé¢ DOM è§£æéƒ½ä¼šè¢«é˜»æ­¢ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost:8000/big.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;p&quot;</span>)); <span class="comment">//null</span></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span>xxx?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ Firefox, Chrome, Edge ä¸­ï¼Œå¦‚æœ <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;xxx&quot;&gt;</code> åé¢è·Ÿç€ <code>&lt;script&gt;</code>, åˆ™ CSS åŠ è½½å®Œæˆå, æ‰èƒ½è§¦å‘ DOMContentLoaded</p>
</li>
<li><p>Css æ–‡ä»¶å¦‚æœåœ¨ <code>&lt;head&gt;</code> ä¸­ï¼Œé‚£ä¹ˆ Css æ–‡ä»¶çš„åŠ è½½ä¸ä¼šå½±å“ DOM çš„è§£æï¼Œä½†æ˜¯å½±å“ DOM çš„<strong>æ¸²æŸ“</strong>ã€‚<br>å› ä¸º Css æ–‡ä»¶çš„åŠ è½½å¯ä»¥æ”¾åœ¨é¢„è§£æçº¿ç¨‹ä¸­ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“ DOM è§£æï¼Œä½†æ˜¯ DOM è§£æå®Œæˆåï¼Œå¿…é¡»ç­‰å¾…æ ·å¼æ–‡ä»¶è¢«è§£æï¼Œæ‰èƒ½æ¸²æŸ“é¡µé¢ã€‚</p>
<p>Css æ–‡ä»¶å¦‚æœåœ¨ <code>&lt;body&gt;</code> ä¸­ï¼Œé‚£ä¹ˆ Css æ–‡ä»¶çš„åŠ è½½ä¼šé˜»å¡ Css èµ„æºåé¢çš„ DOM çš„è§£æ(é˜»å¡ DOMContentLoaded æ‰§è¡Œçš„æ—¶æœº)ã€‚è¿™ç§æƒ…å†µç§°ä¸º FOUC(Flash of Unstyled Content) æ ·å¼é—ªçƒã€‚ä¹Ÿå°±æ˜¯è¯´ Css èµ„æºå‰é¢çš„ DOM ä¼šè¢«æ¸²æŸ“ï¼ŒCss åé¢çš„ DOM å¿…é¡»è¦ç­‰å¾… Css èµ„æºåŠ è½½å®Œæˆåæ‰ä¼šè¢«æ¸²æŸ“ï¼Œè€Œä¹‹å‰å·²ç»æ¸²æŸ“çš„ DOM ä¼šåœ¨ Css èµ„æºåŠ è½½åé‡ç»˜ã€‚</p>
</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">æµè§ˆå™¨</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-javascript/react-draggable"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/1b2dc5f38592/"
    >react-draggable æºç åˆ†æ</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/1b2dc5f38592/" class="article-date">
  <time datetime="2022-05-19T06:07:27.000Z" itemprop="datePublished">2022-05-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Javascript/">Javascript</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a target="_blank" rel="noopener" href="https://github.com/react-grid-layout/react-draggable">react-draggable</a> ä¸€ä¸ªå¯ä»¥è®©ç»„ä»¶å®ç°æ‹–æ‹½çš„åº“</p>
<h4 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h4><p>åªæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–‡ä»¶,Draggable å’Œ DraggableCore</p>
<p>Draggable çš„ä½œç”¨æ˜¯åˆå§‹åŒ–ç»„ä»¶,å¹¶ä¸”é¢„å¤„ç†ä¸€äº›å‚æ•°,æœ€ç»ˆçš„æ ¸å¿ƒé€»è¾‘ç”± DraggableCore å®Œæˆ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Draggable</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;<span class="title class_">DraggableProps</span>, <span class="title class_">DraggableState</span>&gt; &#123;</span><br><span class="line">  <span class="comment">//å¯é€‰å±æ€§</span></span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    <span class="attr">allowAnyClick</span>: <span class="title class_">PropTypes</span>.<span class="property">bool</span>, <span class="comment">//ä»»æ„é¼ æ ‡é”®å¯ä»¥æ‹–åŠ¨</span></span><br><span class="line">    <span class="attr">disabled</span>: <span class="title class_">PropTypes</span>.<span class="property">bool</span>, <span class="comment">// ç¦æ­¢æ‹–åŠ¨</span></span><br><span class="line">    <span class="attr">enableUserSelectHack</span>: <span class="title class_">PropTypes</span>.<span class="property">bool</span>, <span class="comment">//å¦‚æœç¦æ­¢é¡µé¢å…ƒç´ å¯ä»¥è¢«é€‰æ‹©æ— æ•ˆ,å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§</span></span><br><span class="line">    <span class="attr">offsetParent</span>: <span class="title class_">PropTypes</span>.<span class="property">HTMLElement</span>, <span class="comment">// è®¡ç®—åˆå§‹åç§»é‡çš„æ—¶å€™ä¼šç›¸å¯¹äºè¿™ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="attr">grid</span>: <span class="title class_">PropTypes</span>.<span class="title function_">arrayOf</span>(<span class="title class_">PropTypes</span>.<span class="property">number</span>), <span class="comment">//ä»¥ç½‘æ ¼çš„å½¢å¼ç§»åŠ¨å…ƒç´ </span></span><br><span class="line">    <span class="attr">handle</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>, <span class="comment">// æŒ‡å®šå…ƒç´ å¯æ‹–åŠ¨çš„åŒºåŸŸ</span></span><br><span class="line">    <span class="attr">cancel</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>, <span class="comment">//æŒ‡å®šå…ƒç´ ä¸èƒ½æ‹–åŠ¨çš„åŒºåŸŸ</span></span><br><span class="line">    <span class="attr">nodeRef</span>: <span class="title class_">PropTypes</span>.<span class="property">object</span>, <span class="comment">//ç”¨äºç›´æ¥æŒ‡å®šé‚£ä¸ªå…ƒç´ å¯ä»¥è¢«æ‹–åŠ¨</span></span><br><span class="line">    <span class="attr">onStart</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>, <span class="comment">//è‡ªå®šä¹‰æ‹–åŠ¨å¼€å§‹æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="attr">onDrag</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>, <span class="comment">//è‡ªå®šä¹‰æ‹–åŠ¨ä¸­çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="attr">onStop</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>, <span class="comment">//è‡ªå®šä¹‰æ‹–åŠ¨ç»“æŸæ—¶å€™çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="attr">onMouseDown</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>,</span><br><span class="line">    <span class="attr">scale</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>, <span class="comment">// æ‹–åŠ¨æ—¶å€™çš„åç§»æ¯”ä¾‹</span></span><br><span class="line">    <span class="attr">axis</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOf</span>([<span class="string">&quot;both&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;none&quot;</span>]), <span class="comment">//æŒ‡æ˜å¯æ‹–åŠ¨çš„æ–¹å‘è½´</span></span><br><span class="line">    <span class="comment">// æ‹–åŠ¨è¾¹ç•Œ</span></span><br><span class="line">    <span class="attr">bounds</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOfType</span>([</span><br><span class="line">      <span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123;</span><br><span class="line">        <span class="attr">left</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">        <span class="attr">bottom</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="title class_">PropTypes</span>.<span class="property">string</span>,</span><br><span class="line">      <span class="title class_">PropTypes</span>.<span class="title function_">oneOf</span>([<span class="literal">false</span>]),</span><br><span class="line">    ]),</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰æ‹–åŠ¨æ—¶å€™çš„æ ·å¼</span></span><br><span class="line">    <span class="attr">defaultClassName</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>,</span><br><span class="line">    <span class="attr">defaultClassNameDragging</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>,</span><br><span class="line">    <span class="attr">defaultClassNameDragged</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>,</span><br><span class="line">    <span class="comment">// é»˜è®¤ä½ç½®</span></span><br><span class="line">    <span class="attr">defaultPosition</span>: <span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123;</span><br><span class="line">      <span class="attr">x</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">      <span class="attr">y</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// é»˜è®¤åç§»é‡</span></span><br><span class="line">    <span class="attr">positionOffset</span>: <span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123;</span><br><span class="line">      <span class="attr">x</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOfType</span>([<span class="title class_">PropTypes</span>.<span class="property">number</span>, <span class="title class_">PropTypes</span>.<span class="property">string</span>]),</span><br><span class="line">      <span class="attr">y</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOfType</span>([<span class="title class_">PropTypes</span>.<span class="property">number</span>, <span class="title class_">PropTypes</span>.<span class="property">string</span>]),</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props: DraggableProps</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">dragging</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">dragged</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">x</span>: props.<span class="property">position</span> ? props.<span class="property">position</span>.<span class="property">x</span> : props.<span class="property">defaultPosition</span>.<span class="property">x</span>,</span><br><span class="line">      <span class="attr">y</span>: props.<span class="property">position</span> ? props.<span class="property">position</span>.<span class="property">y</span> : props.<span class="property">defaultPosition</span>.<span class="property">y</span>,</span><br><span class="line">      <span class="attr">prevPropsPosition</span>: &#123; ...props.<span class="property">position</span> &#125;,</span><br><span class="line">      <span class="comment">// ç”¨äºè®¡ç®—åœ¨è¾¹ç•Œå¤–çš„æ‹–åŠ¨</span></span><br><span class="line">      <span class="attr">slackX</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">slackY</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">isElementSVG</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœç»„ä»¶æ˜¯å—æ§çš„,æ£€æŸ¥æ–°ä¼ å…¥çš„å€¼æ—¶å€™ä¸ä¸Šä¸€æ¬¡æ›´æ–°æ—¶å€™çš„å€¼ä¸åŒ,é¿å…ç»„ä»¶é¢‘ç¹æ›´æ–°</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromProps</span>(</span><br><span class="line">    &#123; position &#125;: <span class="title class_">DraggableProps</span>,</span><br><span class="line">    &#123; prevPropsPosition &#125;: <span class="title class_">DraggableState</span></span><br><span class="line">  ): ?$Shape&lt;<span class="title class_">DraggableState</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      position &amp;&amp;</span><br><span class="line">      (!prevPropsPosition ||</span><br><span class="line">        position.<span class="property">x</span> !== prevPropsPosition.<span class="property">x</span> ||</span><br><span class="line">        position.<span class="property">y</span> !== prevPropsPosition.<span class="property">y</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">x</span>: position.<span class="property">x</span>,</span><br><span class="line">        <span class="attr">y</span>: position.<span class="property">y</span>,</span><br><span class="line">        <span class="attr">prevPropsPosition</span>: &#123; ...position &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">findDOMNode</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// é¢„å¤„ç†ç”¨æˆ·æä¾›çš„äº‹ä»¶ç»‘å®šæ–¹æ³•</span></span><br><span class="line">  <span class="comment">// å…¶ä»–çš„äº‹ä»¶å±æ€§ä¸è¿™ä¸ªç±»ä¼¼</span></span><br><span class="line">  <span class="title function_">onDragStart</span>(<span class="params">e, coreData</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡,è¿”å›ç»™ä½¿ç”¨è€…</span></span><br><span class="line">    <span class="keyword">const</span> shouldStart = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onStart</span>(</span><br><span class="line">      e,</span><br><span class="line">      <span class="title function_">createDraggableData</span>(<span class="variable language_">this</span>, coreData)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// å¦‚æœç»‘å®šæ–¹æ³•è¿”å› false,é‚£ä¹ˆåŒæ ·æ”¾å›false,åœ¨å®é™…è°ƒç”¨æ—¶åœæ­¢ç¨‹åºæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (shouldStart === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//æ ‡è®°çŠ¶æ€, è¡¨ç¤ºæ‹–åŠ¨å¼€å§‹</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; <span class="attr">dragging</span>: <span class="literal">true</span>, <span class="attr">dragged</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">onDrag</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Draggable ä¸­çš„çŠ¶æ€ä¸ DraggableCore ä¸­çš„çŠ¶æ€æ˜¯åŒºåˆ†å¼€çš„</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">dragging</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œå¤„ç†è¾¹ç•Œé—®é¢˜å’Œåç§»é‡æ¯”ä¾‹çš„é—®é¢˜</span></span><br><span class="line">    <span class="comment">// ç›¸å½“äºæŠŠç”¨æˆ·çš„è‡ªå®šä¹‰é…ç½®å½±å“åˆ†ç¦»å‡ºæ¥,DraggableCore åªå¤„ç†æ ¸å¿ƒæ‹–æ‹½çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createDraggableData</span>(<span class="params">draggable, coreData</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> scale = draggable.<span class="property">props</span>.<span class="property">scale</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">node</span>: coreData.<span class="property">node</span>,</span><br><span class="line">        <span class="attr">x</span>: draggable.<span class="property">state</span>.<span class="property">x</span> + coreData.<span class="property">deltaX</span> / scale,</span><br><span class="line">        <span class="attr">y</span>: draggable.<span class="property">state</span>.<span class="property">y</span> + coreData.<span class="property">deltaY</span> / scale,</span><br><span class="line">        <span class="attr">deltaX</span>: coreData.<span class="property">deltaX</span> / scale,</span><br><span class="line">        <span class="attr">deltaY</span>: coreData.<span class="property">deltaY</span> / scale,</span><br><span class="line">        <span class="attr">lastX</span>: draggable.<span class="property">state</span>.<span class="property">x</span>,</span><br><span class="line">        <span class="attr">lastY</span>: draggable.<span class="property">state</span>.<span class="property">y</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> uiData = <span class="title function_">createDraggableData</span>(<span class="variable language_">this</span>, coreData);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">newState</span>: $Shape&lt;<span class="title class_">DraggableState</span>&gt; = &#123;</span><br><span class="line">      <span class="attr">x</span>: uiData.<span class="property">x</span>,</span><br><span class="line">      <span class="attr">y</span>: uiData.<span class="property">y</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Keep within bounds.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">bounds</span>) &#123;</span><br><span class="line">      <span class="comment">// Save original x and y.</span></span><br><span class="line">      <span class="keyword">const</span> &#123; x, y &#125; = newState;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add slack to the values used to calculate bound position. This will ensure that if</span></span><br><span class="line">      <span class="comment">// we start removing slack, the element won&#x27;t react to it right away until it&#x27;s been</span></span><br><span class="line">      <span class="comment">// completely removed.</span></span><br><span class="line">      newState.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">slackX</span>;</span><br><span class="line">      newState.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">slackY</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> [newStateX, newStateY] = <span class="title function_">getBoundPosition</span>(</span><br><span class="line">        <span class="variable language_">this</span>,</span><br><span class="line">        newState.<span class="property">x</span>,</span><br><span class="line">        newState.<span class="property">y</span></span><br><span class="line">      );</span><br><span class="line">      newState.<span class="property">x</span> = newStateX;</span><br><span class="line">      newState.<span class="property">y</span> = newStateY;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Recalculate slack by noting how much was shaved by the boundPosition handler.</span></span><br><span class="line">      newState.<span class="property">slackX</span> = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">slackX</span> + (x - newState.<span class="property">x</span>);</span><br><span class="line">      newState.<span class="property">slackY</span> = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">slackY</span> + (y - newState.<span class="property">y</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Update the event we fire to reflect what really happened after bounds took effect.</span></span><br><span class="line">      uiData.<span class="property">x</span> = newState.<span class="property">x</span>;</span><br><span class="line">      uiData.<span class="property">y</span> = newState.<span class="property">y</span>;</span><br><span class="line">      uiData.<span class="property">deltaX</span> = newState.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">x</span>;</span><br><span class="line">      uiData.<span class="property">deltaY</span> = newState.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">y</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Short-circuit if user&#x27;s callback killed it.</span></span><br><span class="line">    <span class="keyword">const</span> shouldUpdate = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onDrag</span>(e, uiData);</span><br><span class="line">    <span class="keyword">if</span> (shouldUpdate === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(newState);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">onDragStop</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">DraggableCore</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#123;<span class="attr">...draggableCoreProps</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onStart</span>=<span class="string">&#123;this.onDragStart&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onDrag</span>=<span class="string">&#123;this.onDrag&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onStop</span>=<span class="string">&#123;this.onDragStop&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;React.cloneElement(React.Children.only(children), &#123;</span></span><br><span class="line"><span class="language-xml">          className: className,</span></span><br><span class="line"><span class="language-xml">          style: &#123; ...children.props.style, ...style &#125;,</span></span><br><span class="line"><span class="language-xml">          transform: svgTransform,</span></span><br><span class="line"><span class="language-xml">        &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">DraggableCore</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DraggableCore</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;</span><br><span class="line">  <span class="title class_">DraggableCoreProps</span>,</span><br><span class="line">  <span class="title class_">DraggableCoreState</span></span><br><span class="line">&gt; &#123;</span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mounted</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// ç»„ä»¶æŒ‚è½½æ—¶å»æŸ¥æ‰¾éœ€è¦æŒ‚è½½çš„å…ƒç´ ,å¹¶ç»‘å®šäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> thisNode = <span class="variable language_">this</span>.<span class="title function_">findDOMNode</span>();</span><br><span class="line">    <span class="comment">// å› ä¸ºç§»åŠ¨çŸ­çš„touch äº‹ä»¶å¯èƒ½ä¼šè®©å±å¹•å‘ç”Ÿæ»šåŠ¨,æ‰€ä»¥å¿…é¡»é€šè¿‡åŸç”Ÿäº‹ä»¶ç»‘å®šä¼ å…¥ passive å‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (thisNode) &#123;</span><br><span class="line">      <span class="title function_">addEvent</span>(thisNode, eventsFor.<span class="property">touch</span>.<span class="property">start</span>, <span class="variable language_">this</span>.<span class="property">onTouchStart</span>, &#123;</span><br><span class="line">        <span class="attr">passive</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">findDOMNode</span>(): ?<span class="title class_">HTMLElement</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>?.<span class="property">nodeRef</span></span><br><span class="line">      ? <span class="variable language_">this</span>.<span class="property">props</span>?.<span class="property">nodeRef</span>?.<span class="property">current</span></span><br><span class="line">      : <span class="title class_">ReactDOM</span>.<span class="title function_">findDOMNode</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleDragStart</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">handleDrag</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">handleDragStop</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// åœ¨ç»„ä»¶ä¸Šç»‘å®šä¸‹é¢å››ä¸ªæ–¹æ³•,å½“æ–¹æ³•è¢«è§¦å‘æ—¶,å¯ä»¥åŒºåˆ†æ˜¯å¦æ˜¯è§¦æ‘¸è®¾å¤‡</span></span><br><span class="line">  <span class="title function_">onMouseDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> eventsFor = &#123;</span><br><span class="line">      <span class="attr">touch</span>: &#123;</span><br><span class="line">        <span class="attr">start</span>: <span class="string">&quot;touchstart&quot;</span>,</span><br><span class="line">        <span class="attr">move</span>: <span class="string">&quot;touchmove&quot;</span>,</span><br><span class="line">        <span class="attr">stop</span>: <span class="string">&quot;touchend&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">mouse</span>: &#123;</span><br><span class="line">        <span class="attr">start</span>: <span class="string">&quot;mousedown&quot;</span>,</span><br><span class="line">        <span class="attr">move</span>: <span class="string">&quot;mousemove&quot;</span>,</span><br><span class="line">        <span class="attr">stop</span>: <span class="string">&quot;mouseup&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    dragEventFor = eventsFor.<span class="property">mouse</span>; <span class="comment">// on touchscreen laptops we could switch back to mouse</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">handleDragStart</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">onMouseUp</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">onTouchStart</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">onTouchEnd</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="getBoundPosition"><a href="#getBoundPosition" class="headerlink" title="getBoundPosition"></a>getBoundPosition</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getBoundPosition</span>(<span class="params"></span></span><br><span class="line"><span class="params">  draggable: Draggable,</span></span><br><span class="line"><span class="params">  x: number,</span></span><br><span class="line"><span class="params">  y: number</span></span><br><span class="line"><span class="params"></span>): [number, number] &#123;</span><br><span class="line">  <span class="comment">// If no bounds, short-circuit and move on</span></span><br><span class="line">  <span class="keyword">if</span> (!draggable.<span class="property">props</span>.<span class="property">bounds</span>) <span class="keyword">return</span> [x, y];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clone new bounds</span></span><br><span class="line">  <span class="keyword">let</span> &#123; bounds &#125; = draggable.<span class="property">props</span>;</span><br><span class="line">  bounds = <span class="keyword">typeof</span> bounds === <span class="string">&quot;string&quot;</span> ? bounds : <span class="title function_">cloneBounds</span>(bounds);</span><br><span class="line">  <span class="keyword">const</span> node = <span class="title function_">findDOMNode</span>(draggable);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> bounds === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; ownerDocument &#125; = node;</span><br><span class="line">    <span class="keyword">const</span> ownerWindow = ownerDocument.<span class="property">defaultView</span>;</span><br><span class="line">    <span class="keyword">let</span> boundNode;</span><br><span class="line">    <span class="keyword">if</span> (bounds === <span class="string">&quot;parent&quot;</span>) &#123;</span><br><span class="line">      boundNode = node.<span class="property">parentNode</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      boundNode = ownerDocument.<span class="title function_">querySelector</span>(bounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(boundNode <span class="keyword">instanceof</span> ownerWindow.<span class="property">HTMLElement</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">        <span class="string">&#x27;Bounds selector &quot;&#x27;</span> + bounds + <span class="string">&#x27;&quot; could not find an element.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">boundNodeEl</span>: <span class="title class_">HTMLElement</span> = boundNode; <span class="comment">// for Flow, can&#x27;t seem to refine correctly</span></span><br><span class="line">    <span class="keyword">const</span> nodeStyle = ownerWindow.<span class="title function_">getComputedStyle</span>(node);</span><br><span class="line">    <span class="keyword">const</span> boundNodeStyle = ownerWindow.<span class="title function_">getComputedStyle</span>(boundNodeEl);</span><br><span class="line">    <span class="comment">// Compute bounds. This is a pain with padding and offsets but this gets it exactly right.</span></span><br><span class="line">    bounds = &#123;</span><br><span class="line">      <span class="attr">left</span>:</span><br><span class="line">        -node.<span class="property">offsetLeft</span> +</span><br><span class="line">        <span class="title function_">int</span>(boundNodeStyle.<span class="property">paddingLeft</span>) +</span><br><span class="line">        <span class="title function_">int</span>(nodeStyle.<span class="property">marginLeft</span>),</span><br><span class="line">      <span class="attr">top</span>:</span><br><span class="line">        -node.<span class="property">offsetTop</span> +</span><br><span class="line">        <span class="title function_">int</span>(boundNodeStyle.<span class="property">paddingTop</span>) +</span><br><span class="line">        <span class="title function_">int</span>(nodeStyle.<span class="property">marginTop</span>),</span><br><span class="line">      <span class="attr">right</span>:</span><br><span class="line">        <span class="title function_">innerWidth</span>(boundNodeEl) -</span><br><span class="line">        <span class="title function_">outerWidth</span>(node) -</span><br><span class="line">        node.<span class="property">offsetLeft</span> +</span><br><span class="line">        <span class="title function_">int</span>(boundNodeStyle.<span class="property">paddingRight</span>) -</span><br><span class="line">        <span class="title function_">int</span>(nodeStyle.<span class="property">marginRight</span>),</span><br><span class="line">      <span class="attr">bottom</span>:</span><br><span class="line">        <span class="title function_">innerHeight</span>(boundNodeEl) -</span><br><span class="line">        <span class="title function_">outerHeight</span>(node) -</span><br><span class="line">        node.<span class="property">offsetTop</span> +</span><br><span class="line">        <span class="title function_">int</span>(boundNodeStyle.<span class="property">paddingBottom</span>) -</span><br><span class="line">        <span class="title function_">int</span>(nodeStyle.<span class="property">marginBottom</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Keep x and y below right and bottom limits...</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNum</span>(bounds.<span class="property">right</span>)) x = <span class="title class_">Math</span>.<span class="title function_">min</span>(x, bounds.<span class="property">right</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNum</span>(bounds.<span class="property">bottom</span>)) y = <span class="title class_">Math</span>.<span class="title function_">min</span>(y, bounds.<span class="property">bottom</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// But above left and top limits.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNum</span>(bounds.<span class="property">left</span>)) x = <span class="title class_">Math</span>.<span class="title function_">max</span>(x, bounds.<span class="property">left</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isNum</span>(bounds.<span class="property">top</span>)) y = <span class="title class_">Math</span>.<span class="title function_">max</span>(y, bounds.<span class="property">top</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [x, y];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="handleDragStart"><a href="#handleDragStart" class="headerlink" title="handleDragStart"></a>handleDragStart</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">handleDragStart</span>: <span class="title class_">EventHandler</span>&lt;<span class="title class_">MouseTouchEvent</span>&gt; = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç”¨äºè‡ªå®šä¹‰çš„ onMouseDown äº‹ä»¶</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onMouseDown</span>(e);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä»»æ„é¼ æ ‡æŒ‰é”®éƒ½ä¸€é¢—æ‹–åŠ¨,å¦åˆ™åªæœ‰é¼ æ ‡å·¦é”®å¯ä»¥æ‹–åŠ¨</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    !<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">allowAnyClick</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> e.<span class="property">button</span> === <span class="string">&quot;number&quot;</span> &amp;&amp;</span><br><span class="line">    e.<span class="property">button</span> !== <span class="number">0</span></span><br><span class="line">  )</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾åˆ°éœ€è¦æ‹–åŠ¨çš„å…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> thisNode = <span class="variable language_">this</span>.<span class="title function_">findDOMNode</span>();</span><br><span class="line">  <span class="keyword">if</span> (!thisNode || !thisNode.<span class="property">ownerDocument</span> || !thisNode.<span class="property">ownerDocument</span>.<span class="property">body</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;&lt;DraggableCore&gt; not mounted on DragStart!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> &#123; ownerDocument &#125; = thisNode;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ§åˆ¶å¯æ‹–åŠ¨åŒºåŸŸå’Œä¸å¯æ‹–åŠ¨åŒºåŸŸ</span></span><br><span class="line">  <span class="comment">// handle cancel å±æ€§ä¼ å…¥çš„æ˜¯æ§åˆ¶åŒºåŸŸçš„å…ƒç´ æ ‡ç­¾åç§°</span></span><br><span class="line">  <span class="comment">// ç”¨åŸç”Ÿçš„ matches æ–¹æ³•æ£€æŸ¥è¿™ä¸ªæ ‡ç­¾æ˜¯å¦åœ¨æ‹–åŠ¨å…ƒç´ çš„å†…éƒ¨,å¦‚æœæœ‰å°±åœæ­¢æ‰§è¡Œ  element.matches(&#x27;p&#x27;)</span></span><br><span class="line">  <span class="comment">// è¿™æ˜¯çœŸæ­£çš„ onStart æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œ,ä¸éœ€è¦é‡ç½®çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">disabled</span> ||</span><br><span class="line">    !(e.<span class="property">target</span> <span class="keyword">instanceof</span> ownerDocument.<span class="property">defaultView</span>.<span class="property">Node</span>) ||</span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">handle</span> &amp;&amp;</span><br><span class="line">      !<span class="title function_">matchesSelectorAndParentsTo</span>(e.<span class="property">target</span>, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">handle</span>, thisNode)) ||</span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">cancel</span> &amp;&amp;</span><br><span class="line">      <span class="title function_">matchesSelectorAndParentsTo</span>(e.<span class="property">target</span>, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">cancel</span>, thisNode))</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Prevent scrolling on mobile devices, like ipad/iphone.</span></span><br><span class="line">  <span class="comment">// Important that this is after handle/cancel.</span></span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="string">&quot;touchstart&quot;</span>) e.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set touch identifier in component state if this is a touch event. This allows us to</span></span><br><span class="line">  <span class="comment">// distinguish between individual touches on multitouch screens by identifying which</span></span><br><span class="line">  <span class="comment">// touchpoint was set to this element.</span></span><br><span class="line">  <span class="comment">// è®°å½•è§¦æ‘¸ç‚¹çš„ id</span></span><br><span class="line">  <span class="keyword">const</span> touchIdentifier = <span class="title function_">getTouchIdentifier</span>(e);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; touchIdentifier &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the current drag point from the event. This is used as the offset.</span></span><br><span class="line">  <span class="comment">// é¦–å…ˆå¦‚æœå­˜åœ¨è§¦æ‘¸ç‚¹,åˆ™å›å»touch äº‹ä»¶,å¦åˆ™è·å–åŸç”Ÿçš„ event</span></span><br><span class="line">  <span class="comment">// é€šè¿‡ findDOMNode æŸ¥æ‰¾éœ€è¦æ‹–åŠ¨çš„å…ƒç´ , è·å–ç”¨äºè®¡ç®—ç›¸å¯¹ä½ç½®çš„å…ƒç´  offsetParent å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§å°±ç”¨ä¸Šçº§ parentNode || document</span></span><br><span class="line">  <span class="comment">// const x = (evt.clientX + offsetParent.scrollLeft - offsetParentRect.left) / scale;</span></span><br><span class="line">  <span class="comment">// const y = (evt.clientY + offsetParent.scrollTop - offsetParentRect.top) / scale;</span></span><br><span class="line">  <span class="comment">// è·å–ç›¸å¯¹äºçˆ¶å…ƒç´ çš„é¼ æ ‡ä½ç½®</span></span><br><span class="line">  <span class="keyword">const</span> position = <span class="title function_">getControlPosition</span>(e, touchIdentifier, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (position == <span class="literal">null</span>) <span class="keyword">return</span>; <span class="comment">// not possible but satisfies flow</span></span><br><span class="line">  <span class="keyword">const</span> &#123; x, y &#125; = position;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create an event object with all the data parents need to make a decision here.</span></span><br><span class="line">  <span class="keyword">const</span> coreEvent = <span class="title function_">createCoreData</span>(<span class="variable language_">this</span>, x, y);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// çœŸæ­£æ‰§è¡Œ onStart æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">const</span> shouldUpdate = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onStart</span>(e, coreEvent);</span><br><span class="line">  <span class="comment">// å¦‚æœè¿”å›å€¼ä¸ºfalse åœæ­¢æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (shouldUpdate === <span class="literal">false</span> || <span class="variable language_">this</span>.<span class="property">mounted</span> === <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add a style to the body to disable user-select. This prevents text from</span></span><br><span class="line">  <span class="comment">// being selected all over the page.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">enableUserSelectHack</span>) <span class="title function_">addUserSelectStyles</span>(ownerDocument);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initiate dragging. Set the current x and y as offsets</span></span><br><span class="line">  <span class="comment">// so we know how much we&#x27;ve moved during the drag. This allows us</span></span><br><span class="line">  <span class="comment">// to drag elements around even if they have been moved, without issue.</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">    <span class="attr">dragging</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">lastX</span>: x,</span><br><span class="line">    <span class="attr">lastY</span>: y,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add events to the document directly so we catch when the user&#x27;s mouse/touch moves outside of</span></span><br><span class="line">  <span class="comment">// this element. We use different events depending on whether or not we have detected that this</span></span><br><span class="line">  <span class="comment">// is a touch-capable device.</span></span><br><span class="line">  <span class="title function_">addEvent</span>(ownerDocument, dragEventFor.<span class="property">move</span>, <span class="variable language_">this</span>.<span class="property">handleDrag</span>);</span><br><span class="line">  <span class="title function_">addEvent</span>(ownerDocument, dragEventFor.<span class="property">stop</span>, <span class="variable language_">this</span>.<span class="property">handleDragStop</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="handleDrag"><a href="#handleDrag" class="headerlink" title="handleDrag"></a>handleDrag</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">handleDrag</span>: <span class="title class_">EventHandler</span>&lt;<span class="title class_">MouseTouchEvent</span>&gt; = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Get the current drag point from the event. This is used as the offset.</span></span><br><span class="line">  <span class="keyword">const</span> position = <span class="title function_">getControlPosition</span>(e, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">touchIdentifier</span>, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (position == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">let</span> &#123; x, y &#125; = position;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°æŒ‰ç½‘æ ¼æ‹–åŠ¨</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>)) &#123;</span><br><span class="line">    <span class="keyword">let</span> deltaX = x - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastX</span>,</span><br><span class="line">      deltaY = y - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastY</span>;</span><br><span class="line">    <span class="keyword">const</span> deltaX = <span class="title class_">Math</span>.<span class="title function_">round</span>(deltaX / <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>[<span class="number">0</span>]) * <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> deltaY = <span class="title class_">Math</span>.<span class="title function_">round</span>(deltaY / <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>[<span class="number">0</span>]) * <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (!deltaX &amp;&amp; !deltaY) <span class="keyword">return</span>; <span class="comment">// skip useless drag</span></span><br><span class="line">    (x = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastX</span> + deltaX), (y = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastY</span> + deltaY);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> coreEvent = <span class="title function_">createCoreData</span>(<span class="variable language_">this</span>, x, y);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call event handler. If it returns explicit false, trigger end.</span></span><br><span class="line">  <span class="comment">// æŒ‡å®šè‡ªå®šä¹‰æ–¹æ³•,å¦‚æœè¿”å› false æ‰‹åŠ¨åœæ­¢æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">const</span> shouldUpdate = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onDrag</span>(e, coreEvent);</span><br><span class="line">  <span class="keyword">if</span> (shouldUpdate === <span class="literal">false</span> || <span class="variable language_">this</span>.<span class="property">mounted</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// $FlowIgnore</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">handleDragStop</span>(<span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&quot;mouseup&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">    <span class="attr">lastX</span>: x,</span><br><span class="line">    <span class="attr">lastY</span>: y,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="handleDragStop"><a href="#handleDragStop" class="headerlink" title="handleDragStop"></a>handleDragStop</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">handleDragStop</span>: <span class="title class_">EventHandler</span>&lt;<span class="title class_">MouseTouchEvent</span>&gt; = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">dragging</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> position = <span class="title function_">getControlPosition</span>(e, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">touchIdentifier</span>, <span class="variable language_">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (position == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">let</span> &#123; x, y &#125; = position;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Snap to grid if prop has been provided</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>)) &#123;</span><br><span class="line">    <span class="keyword">let</span> deltaX = x - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastX</span> || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> deltaY = y - <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastY</span> || <span class="number">0</span>;</span><br><span class="line">    [deltaX, deltaY] = <span class="title function_">snapToGrid</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">grid</span>, deltaX, deltaY);</span><br><span class="line">    (x = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastX</span> + deltaX), (y = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">lastY</span> + deltaY);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> coreEvent = <span class="title function_">createCoreData</span>(<span class="variable language_">this</span>, x, y);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Call event handler</span></span><br><span class="line">  <span class="keyword">const</span> shouldContinue = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onStop</span>(e, coreEvent);</span><br><span class="line">  <span class="keyword">if</span> (shouldContinue === <span class="literal">false</span> || <span class="variable language_">this</span>.<span class="property">mounted</span> === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> thisNode = <span class="variable language_">this</span>.<span class="title function_">findDOMNode</span>();</span><br><span class="line">  <span class="keyword">if</span> (thisNode) &#123;</span><br><span class="line">    <span class="comment">// Remove user-select hack</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">enableUserSelectHack</span>)</span><br><span class="line">      <span class="title function_">removeUserSelectStyles</span>(thisNode.<span class="property">ownerDocument</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡ç½®çŠ¶æ€å¹¶ç§»é™¤äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// Reset the el.</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">    <span class="attr">dragging</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">lastX</span>: <span class="title class_">NaN</span>,</span><br><span class="line">    <span class="attr">lastY</span>: <span class="title class_">NaN</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (thisNode) &#123;</span><br><span class="line">    <span class="comment">// Remove event handlers</span></span><br><span class="line">    <span class="title function_">removeEvent</span>(thisNode.<span class="property">ownerDocument</span>, dragEventFor.<span class="property">move</span>, <span class="variable language_">this</span>.<span class="property">handleDrag</span>);</span><br><span class="line">    <span class="title function_">removeEvent</span>(thisNode.<span class="property">ownerDocument</span>, dragEventFor.<span class="property">stop</span>, <span class="variable language_">this</span>.<span class="property">handleDragStop</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="posts-db/åˆ†æå‡½æ•°"
  class="article article-type-posts"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/posts/baf7f14e48f8/"
    >MySQl åˆ†æå‡½æ•°</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/posts/baf7f14e48f8/" class="article-date">
  <time datetime="2022-05-15T09:41:41.000Z" itemprop="datePublished">2022-05-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="ROW-NUMBER"><a href="#ROW-NUMBER" class="headerlink" title="ROW_NUMBER"></a>ROW_NUMBER</h4><p>è¡¨ç¤ºæ ¹æ® col1 åˆ†ç»„ï¼Œåœ¨åˆ†ç»„å†…éƒ¨æ ¹æ® col2 æ’åºï¼Œè€Œè¿™ä¸ªå€¼å°±è¡¨ç¤ºæ¯ç»„å†…éƒ¨æ’åºåçš„é¡ºåºç¼–ç </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">row_number</span>() <span class="keyword">over</span>( <span class="keyword">partition</span> <span class="keyword">by</span> col1 <span class="keyword">order</span> <span class="keyword">by</span> col2);</span><br></pre></td></tr></table></figure>

<p>ROW_NUMBER è¿”å›è¡Œä¿¡æ¯æ²¡æœ‰æ’å</p>
<h4 id="RANK-DENSE-RANK"><a href="#RANK-DENSE-RANK" class="headerlink" title="RANK DENSE_RANK"></a>RANK DENSE_RANK</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>,</span><br><span class="line"><span class="built_in">row_number</span> () <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> s.SId <span class="keyword">order</span> <span class="keyword">by</span> s.score) <span class="keyword">as</span> row_number1,</span><br><span class="line"><span class="built_in">rank</span> () <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> s.SId <span class="keyword">order</span> <span class="keyword">by</span> s.score) <span class="keyword">as</span> rank1,</span><br><span class="line"><span class="built_in">dense_rank</span> () <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> s.SId <span class="keyword">order</span> <span class="keyword">by</span> s.score) <span class="keyword">as</span> dense_rank1</span><br><span class="line"><span class="keyword">from</span> SC s ;</span><br></pre></td></tr></table></figure>

<p>ROW_NUMBER è¿ç»­æ’å<br>RANK å€¼ç›¸åŒæ’åç›¸åŒ,æ’åè·³è·ƒ<br>DENSE_RANK å€¼ç›¸åŒæ’åç›¸åŒ,æ’åè¿ç»­</p>
<p><img src="/posts/baf7f14e48f8/0001.png"></p>
<p><a href="">æŸ¥è¯¢æ‰€æœ‰åŒå­¦æœ€é«˜åˆ†å¯¹åº”çš„ç§‘ç›®åç§°</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">æ•°æ®åº“</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/7/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2025
        <i class="ri-heart-fill heart_icon"></i> SunZhiqi
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.png" alt="å››æœˆå…«æ—¥"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="æœç´¢">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>æ­¤æ—¶æ— å£°èƒœæœ‰å£°ï¼</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="/js/jquery.modal.min.js"></script>
<link rel="stylesheet" href="/css/jquery.modal.min.css" />
<script src="/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->

        <div class="pswp__counter"></div>

        <button
          class="pswp__button pswp__button--close"
          title="Close (Esc)"
        ></button>

        <button
          class="pswp__button pswp__button--share"
          style="display: none"
          title="Share"
        ></button>

        <button
          class="pswp__button pswp__button--fs"
          title="Toggle fullscreen"
        ></button>

        <button
          class="pswp__button pswp__button--zoom"
          title="Zoom in/out"
        ></button>

        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div>
      </div>

      <button
        class="pswp__button pswp__button--arrow--left"
        title="Previous (arrow left)"
      ></button>

      <button
        class="pswp__button pswp__button--arrow--right"
        title="Next (arrow right)"
      ></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/photoswipe.min.css" />
<link rel="stylesheet" href="/css/default-skin.min.css" />
<script src="/js/photoswipe.min.js"></script>
<script src="/js/photoswipe-ui-default.min.js"></script>

<script>
  function viewer_init() {
    let pswpElement = document.querySelectorAll(".pswp")[0];
    let $imgArr = document.querySelectorAll(
      ".article-entry img:not(.reward-img)"
    );

    $imgArr.forEach(($em, i) => {
      $em.onclick = () => {
        // sliderå±•å¼€çŠ¶æ€
        // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
        if (document.querySelector(".left-col.show")) return;
        let items = [];
        $imgArr.forEach(($em2, i2) => {
          let img = $em2.getAttribute("data-idx", i2);
          let src =
            $em2.getAttribute("data-target") || $em2.getAttribute("src");
          let title = $em2.getAttribute("alt");
          // è·å¾—åŸå›¾å°ºå¯¸
          const image = new Image();
          image.src = src;
          items.push({
            src: src,
            w: image.width || $em2.width,
            h: image.height || $em2.height,
            title: title,
          });
        });
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
          index: parseInt(i),
        });
        gallery.init();
      };
    });
  }
  viewer_init();
</script>
 
<!-- MathJax -->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="/js/MathJax.js"></script>
<script src="/js/TeX-AMS-MML_HTMLorMML-full.js"></script>

<script>
  var ayerConfig = {
    mathjax: true,
  };
</script>

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="/js/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !(function (e, t, a) {
    var initCopyCode = function () {
      var copyHtml = "";
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += "</button>";
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS(".btn-copy", {
        target: function (trigger) {
          return trigger.nextElementSibling;
        },
      });
      clipboard.on("success", function (e) {
        let $btn = $(e.trigger);
        $btn.addClass("copied");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-checkbox-circle-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPIED";

        wait(function () {
          // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass("ri-checkbox-circle-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
      clipboard.on("error", function (e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass("copy-failed");
        let $icon = $($btn.find("i"));
        $icon.removeClass("ri-file-copy-2-line");
        $icon.addClass("ri-time-line");
        let $span = $($btn.find("span"));
        $span[0].innerText = "COPY FAILED";

        wait(function () {
          // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass("ri-time-line");
          $icon.addClass("ri-file-copy-2-line");
          $span[0].innerText = "COPY";
        }, 2000);
      });
    };
    initCopyCode();
  })(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "default" });
  }
</script>


    
    

  </div>
</body>

</html>