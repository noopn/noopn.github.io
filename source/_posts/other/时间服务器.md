---
layout: posts
title: Debian 作为时间服务器
date: 2024-01-12 12:06:48
categories:
  - 其他
tags:
  - Debian
---

#### 配置权限

添加 sudo 命令

```bash
su # 切换到root用户

apt install sudo

# 添加用户到sudo组
vi /etc/sudoers
username ALL=(ALL) ALL

# 添加环境路径，防止找不到安装的软件
vi ~/.bashrc
export PATH=$PATH:/usr/sbin::/sbin
. ~/.bashrc

```

#### 安装 ntp

```bash
apt install ntp
```

配置 ntp

```bash
vi /etc/ntpsec/ntp.conf

server 127.127.1.0 prefer # 本地时间服务器

# 注释
# pool 0.debian.pool.ntp.org iburst
# pool 1.debian.pool.ntp.org iburst
# pool 2.debian.pool.ntp.org iburst
# pool 3.debian.pool.ntp.org iburst
```

启动服务

```bash
sudo systemctl start ntpsec
sudo systemctl enable ntpsec
```

#### 同步

在需要同步的服务器上安装

```bash
sudo apt install ntpdate

# 同步时间

sudo ntpdate <时间服务器ip>
```

crontab 定时同步

```bash
sudo apt install cron

# 编辑定时任务
crontab -e

# 添加定时任务，每天执行一次
0 0 * * * sudo /usr/sbin/ntpdate <时间服务器ip>
```
